{"version":3,"sources":["webpack://exports/webpack/bootstrap","webpack://exports/./node_modules/@skpm/promise/index.js","webpack://exports/./node_modules/mocha-js-delegate/index.js","webpack://exports/./node_modules/sketch-module-web-view/lib/browser-api.js","webpack://exports/./node_modules/sketch-module-web-view/lib/constants.js","webpack://exports/./node_modules/sketch-module-web-view/lib/dispatch-first-click.js","webpack://exports/./node_modules/sketch-module-web-view/lib/execute-javascript.js","webpack://exports/./node_modules/sketch-module-web-view/lib/fitSubview.js","webpack://exports/./node_modules/sketch-module-web-view/lib/index.js","webpack://exports/./node_modules/sketch-module-web-view/lib/inject-client-messaging.js","webpack://exports/./node_modules/sketch-module-web-view/lib/movable-area.js","webpack://exports/./node_modules/sketch-module-web-view/lib/parseWebArguments.js","webpack://exports/./node_modules/sketch-module-web-view/lib/set-delegates.js","webpack://exports/./node_modules/sketch-module-web-view/lib/webview-api.js","webpack://exports/./node_modules/sketch-module-web-view/remote.js","webpack://exports/./resources/webview.html","webpack://exports/./src/ddMath.js","webpack://exports/./src/ddSpiral.js","webpack://exports/external \"events\"","webpack://exports/external \"sketch\"","webpack://exports/external \"sketch/settings\"","webpack://exports/external \"sketch/ui\""],"names":["Math","rad","PI","degrees","deg","factorial","num","rval","i","triangle","decimal","round","pow","ease","timing","steps","transition","start","step","latter","factor","points","Array","cos","dif","abs","push","easePower","power","total","x","y","unshift","Vector2d","prototype","add","point","angle","atan2","multiplier","testAngle","radians","radius","sqrt","root","rotate","center","sin","substract","sketch","require","Settings","UI","uniqueCommIdentifier","uniqueSettingIdentifier","_openShapes","openShapes","shapeNames","settingIdentifiers","appcast","context","options","identifier","width","height","show","backgroundColor","alwaysOnTop","resizable","titleBarStyle","maximizable","minimizable","browserWindow","BrowserWindow","once","setSettingForKey","webContents","on","handleSelection","url","NSWorkspace","sharedWorkspace","openURL","NSURL","URLWithString","requestData","JSON","parse","action","spiral","clearSelection","loadURL","onShutdown","existingWebview","getWebview","close","respondToWebview","message","listener","stringify","isWebviewPresent","sendToWebview","onSelectionChanged","settingForKey","document","getSelectedDocument","selectedLayers","layers","collection","objects","shapes","rects","paths","parentObj","startObj","endObj","selection","theme","type","shape","clear","isSpiral","startID","endID","pathID","parentID","getSetting","start_val","w","h","worldDeg","end_val","firstObj","length","selectedLayer","typeName","shapeType","indexOf","closed","layerSettingForKey","parent","id","nativeLayer","sketchObject","path","NSBezierPath","bezierPathWithCGPath","pathInFrameWithTransforms","CGPath","defaultRadius","transform","rotation","frame","o","s","p","r","worldOrientation","getTheme","obj","coor","name","data","ret_start_val","ret_end_val","ret_settings","settings","target","array","rot","trans","loops","gap","first","squeeze","jsShape","getLayerWithID","nativeShape","pathInFrame","outl","top","bottom","j","pointOnPathAtLength","gapDistance","gapStep","d","xx","yy","high","ceil","low","floor","distanceY","radiusY","easeRadius","transTotal","radTotal","largestStep","transPoint","radPoint","a","clockwise","lookup","lookupCenter","jsPath","nativePath","pathStep","max","bezierPath","maxRadius","scale","vec","smooth","rotationDelta","tangent","tan","vTangent","newTangent","b","circumference","isNaN","tLength","degInLoops","rotationInDeg","absoluteRotation","rotationFactor","stepFactor","vTranslate","centerVector2d","radiusAngle","radiusTangent","mirror","t","tempTangent","oldTangent","moveToPoint","NSMakePoint","curveToPoint_controlPoint1_controlPoint2","MSShapePathLayer","layerWithPath","MSPath","pathWithBezierPath","border","style","addStylePartOfType","thickness","borderOptions","setLineCapStyle","setLayerSettingForKey","activeSpiral","spiralLayer","remove","objectID","addLayers","currentPage","pathId"],"mappings":";;;;;;;;QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;;AAEA;AACA;AACA,WAAW,SAAS;AACpB;AACA;AACA;AACA;AACA;AACA,aAAa,QAAQ;AACrB;AACA,aAAa,SAAS;AACtB;AACA,aAAa,kBAAkB;AAC/B;AACA,aAAa,kBAAkB;AAC/B;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA,+CAA+C,SAAS;AACxD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA,mBAAmB,iBAAiB;AACpC;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;;AAEA,qCAAqC,SAAS;AAC9C;AACA;AACA,GAAG;AACH;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;;;AC9QA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,cAAc,wDAAwD,EAAE;AACxE;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL,uCAAuC;AACvC;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;AC/FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,mBAAmB,OAAO;AAC1B;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,oCAAoC,+BAA+B;AACnE;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO,+BAA+B;AACtC;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA,OAAO;AACP;AACA;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,oCAAoC,aAAa;AACjD;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC5lBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACRA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,yCAAyC;AACzC,uDAAuD;AACvD,6DAA6D;AAC7D,+BAA+B;AAC/B,MAAM;AACN;AACA;AACA;AACA,QAAQ;AACR,gBAAgB;AAChB,MAAM,eAAe;AACrB,0CAA0C,cAAc;AACxD,MAAM;AACN;AACA;;;;;;;;;;;;ACzBA,+DAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,8BAA8B;AAC9B,YAAY;AACZ,gCAAgC;AAChC,wFAAwF;AACxF,qCAAqC;AACrC;AACA;AACA,mBAAmB;AACnB,YAAY;AACZ,kCAAkC;AAClC;AACA;AACA,kBAAkB;AAClB,YAAY;AACZ,UAAU,OAAO;AACjB;AACA;AACA,kBAAkB;AAClB,UAAU;AACV,QAAQ,cAAc;AACtB;AACA;AACA,kBAAkB;AAClB,QAAQ;AACR,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACpHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACrBA;AACA;AACA,mBAAmB,mBAAO,CAAC,sBAAQ;AACnC,sBAAsB,mBAAO,CAAC,+EAAe;AAC7C,kBAAkB,mBAAO,CAAC,+EAAe;AACzC,uBAAuB,mBAAO,CAAC,6EAAc;AAC7C,yBAAyB,mBAAO,CAAC,iGAAwB;AACzD,4BAA4B,mBAAO,CAAC,uGAA2B;AAC/D,kBAAkB,mBAAO,CAAC,iFAAgB;AAC1C,wBAAwB,mBAAO,CAAC,6FAAsB;AACtD,mBAAmB,mBAAO,CAAC,mFAAiB;;AAE5C;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA,KAAK;AACL;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB,qBAAqB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;;;;;;;;;;;;ACzWA,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA,qDAAqD;AACrD,gDAAgD;AAChD,yBAAyB;AACzB;AACA,QAAQ;AACR,uDAAuD;AACvD,6CAA6C;AAC7C,0BAA0B;AAC1B,sDAAsD;AACtD;AACA;AACA,uBAAuB;AACvB;AACA;AACA,sBAAsB;AACtB;AACA;AACA,wCAAwC;AACxC,QAAQ,EAAE;AACV,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;AC9BA,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA,mBAAmB;AACnB,yDAAyD;AACzD;AACA,kCAAkC;AAClC,2CAA2C,4BAA4B,eAAe;AACtF,gCAAgC,yBAAyB,cAAc;AACvE;AACA,OAAO;AACP;AACA,8BAA8B;AAC9B,qDAAqD,SAAS;AAC9D;AACA;AACA,QAAQ;AACR,OAAO;AACP,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAG;AACH;;;;;;;;;;;;AC5DA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;AClBA,+DAAgB,mBAAO,CAAC,oEAAmB;AAC3C,wBAAwB,mBAAO,CAAC,2FAAqB;AACrD,gBAAgB,mBAAO,CAAC,2EAAa;;AAErC;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAgB;AAChB;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA,WAAW;AACX,SAAS;AACT;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;;AAEP;AACA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA,2CAA2C;AAC3C,OAAO;;AAEP;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA;AACA;AACA;AACA;AACA,cAAc;AACd;AACA;AACA,UAAU;;AAEV;AACA;AACA;AACA;AACA;AACA,aAAa;;AAEb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;;AAEP;AACA;AACA;AACA,OAAO;;AAEP;AACA;;AAEA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,OAAO;AACP,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL,GAAG;;AAEH;AACA,+DAA+D;AAC/D;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA,KAAK;AACL,GAAG;;AAEH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,uBAAuB,sBAAsB;;AAE7C;;AAEA;AACA;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,OAAO;AACP;AACA,KAAK;AACL,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;;AAEH;AACA;;;;;;;;;;;;;ACtZA,mBAAmB,mBAAO,CAAC,sBAAQ;AACnC,wBAAwB,mBAAO,CAAC,6FAAsB;;AAEtD;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mDAAmD;AACnD;AACA,QAAQ,kCAAkC;AAC1C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;AC/NA;AACA;;AAEA;AACA,SAAS,mBAAO,CAAC,iEAAO;AACxB;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB,qBAAqB;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;;;;;;;;;;;AClCA,gM;;;;;;;;;;;;ACAA;AAAA;AAAA;;AAEAA,IAAI,CAACC,GAAG,GAAGD,IAAI,CAACE,EAAE,GAAG,GAAG;AAExBF,IAAI,CAACG,OAAO,GAAG,UAAUC,GAAG,EAAE;EAC7B,OAAO,CAACA,GAAG,GAAG,GAAG,IAAI,GAAG;AACzB,CAAC;AAEDJ,IAAI,CAACK,SAAS,GAAG,UAAUC,GAAG,EAAE;EAC/B,IAAIC,IAAI,GAAC,CAAC;EACV,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,IAAIF,GAAG,EAAEE,CAAC,EAAE,EAC5BD,IAAI,GAAGA,IAAI,GAAGC,CAAC;EAChB,OAAOD,IAAI;AACZ,CAAC;AAEDP,IAAI,CAACS,QAAQ,GAAG,UAAUH,GAAG,EAAE;EAC9B,OAAQA,GAAG,IAAEA,GAAG,GAAC,CAAC,CAAC,GAAE,CAAC;AACvB,CAAC;AAEDN,IAAI,CAACU,OAAO,GAAG,UAAUJ,GAAG,EAAe;EAAA,IAAbI,OAAO,uEAAG,CAAC;EACxC,OAAOV,IAAI,CAACW,KAAK,CAACL,GAAG,GAAIN,IAAI,CAACY,GAAG,CAAC,EAAE,EAAEF,OAAO,CAAE,CAAC,GAAGV,IAAI,CAACY,GAAG,CAAC,EAAE,EAAEF,OAAO,CAAC;AACzE,CAAC;AACD;AACAV,IAAI,CAACa,IAAI,GAAG,UAAUC,MAAM,EAAEC,KAAK,EAAE;EACpC,IAAIC,UAAU,GAAG;IAChBC,KAAK,EAAE,CAAC;IACRC,IAAI,EAAE,CAAC;IACPC,MAAM,EAAE,CAAC;IACTC,MAAM,EAAE,CAAC;IACTC,MAAM,EAAE,IAAIC,KAAK;EAClB,CAAC;EACD,QAAOR,MAAM;IACZ,KAAK,MAAM;MACVE,UAAU,CAACE,IAAI,GAAGlB,IAAI,CAACE,EAAE,GAAGa,KAAK;MACjCC,UAAU,CAACI,MAAM,GAAG,CAAC;MACrB;IACD,KAAK,SAAS;MACbJ,UAAU,CAACC,KAAK,GAAGjB,IAAI,CAACE,EAAE,GAAG,CAAC,EAC9Bc,UAAU,CAACE,IAAI,GAAGlB,IAAI,CAACE,EAAE,GAAG,CAAC,GAAGa,KAAK;MACrC;IACD,KAAK,UAAU;MACdC,UAAU,CAACE,IAAI,GAAGlB,IAAI,CAACE,EAAE,GAAG,CAAC,GAAGa,KAAK;MACrC;IACD;EAAQ;EAET,IAAGC,UAAU,CAACE,IAAI,EAAE;IACnBF,UAAU,CAACG,MAAM,GAAG,CAACnB,IAAI,CAACuB,GAAG,CAACP,UAAU,CAACC,KAAK,CAAC,GAAG,CAAC,IAAID,UAAU,CAACI,MAAM;IACxE,KAAI,IAAIZ,CAAC,GAAG,CAAC,EAAEA,CAAC,IAAIO,KAAK,EAAEP,CAAC,EAAE,EAAE;MAC/B,IAAIe,GAAG,GAAG,CAACvB,IAAI,CAACuB,GAAG,CAACP,UAAU,CAACC,KAAK,CAAC,GAAG,CAAC,IAAID,UAAU,CAACI,MAAM;MAC9D,IAAII,GAAG,GAAGhB,CAAC,IAAI,CAAC,GAAG,CAAC,GAAGR,IAAI,CAACyB,GAAG,CAACF,GAAG,GAAGP,UAAU,CAACG,MAAM,CAAC;MACxDH,UAAU,CAACC,KAAK,IAAID,UAAU,CAACE,IAAI;MACnCF,UAAU,CAACG,MAAM,GAAGI,GAAG;MACvB,IAAGf,CAAC,EAAE;QACLQ,UAAU,CAACK,MAAM,CAACK,IAAI,CAACF,GAAG,CAAC;MAC5B;IACD;IACAR,UAAU,CAACK,MAAM,CAACK,IAAI,CAAC,CAAC,CAAC;IACzB,OAAOV,UAAU,CAACK,MAAM;EACzB,CAAC,MAAM;IACN,OAAO,KAAK;EACb;AACD,CAAC;AACD;AACArB,IAAI,CAAC2B,SAAS,GAAG,UAAUb,MAAM,EAAEc,KAAK,EAAEb,KAAK,EAAE;EAChD,IAAGD,MAAM,IAAI,QAAQ,EAAE,OAAO,KAAK;EACnC,IAAIE,UAAU,GAAG,IAAIM,KAAK,EAAE;EAC5B,IAAIO,KAAK,GAAG,CAAC;EACb,KAAI,IAAIC,CAAC,GAAC,CAAC,EAAEA,CAAC,IAAEf,KAAK,EAAEe,CAAC,EAAE,EAAE;IAC3B,IAAIC,CAAC,GAAGjB,MAAM,IAAI,MAAM,IAAIgB,CAAC,GAAGf,KAAK,GAAG,CAAC,GAAGf,IAAI,CAACY,GAAG,CAAEG,KAAK,GAAG,CAAC,GAAGe,CAAC,EAAEF,KAAK,CAAE,GAAG5B,IAAI,CAACY,GAAG,CAAEkB,CAAC,EAAEF,KAAK,CAAE;IACnG,IAAGE,CAAC,EAAE;MACLD,KAAK,IAAIE,CAAC;MACV,IAAGjB,MAAM,IAAI,SAAS,EAAE;QACvBE,UAAU,CAACgB,OAAO,CAACD,CAAC,CAAC;MACtB,CAAC,MAAM;QACNf,UAAU,CAACU,IAAI,CAACK,CAAC,CAAC;MACnB;IACD;EACD;EACA,KAAI,IAAIvB,CAAC,GAAC,CAAC,EAAEA,CAAC,GAACO,KAAK,EAAEP,CAAC,EAAE,EAAE;IAC1BQ,UAAU,CAACR,CAAC,CAAC,GAAGR,IAAI,CAACU,OAAO,CAACM,UAAU,CAACR,CAAC,CAAC,IAAIqB,KAAK,EAAE,CAAC,CAAC;EACxD;EACAb,UAAU,CAACU,IAAI,CAAC,CAAC,CAAC;EAClB,OAAOV,UAAU;AAClB,CAAC;;AAED;;AAEe,SAASiB,QAAQ,CAACH,CAAC,EAACC,CAAC,EAAE;EACrC,IAAI,CAACD,CAAC,GAAGA,CAAC,IAAI,CAAC;EACf,IAAI,CAACC,CAAC,GAAGA,CAAC,IAAI,CAAC;AAChB;AAEAE,QAAQ,CAACC,SAAS,GAAG;EACpBC,GAAG,EAAE,aAASC,KAAK,EAAE;IACpB,IAAI,CAACN,CAAC,IAAIM,KAAK,CAACN,CAAC;IACjB,IAAI,CAACC,CAAC,IAAIK,KAAK,CAACL,CAAC;EAClB,CAAC;EACDM,KAAK,EAAE,iBAAW;IACjB,OAAOrC,IAAI,CAACG,OAAO,CAAC,GAAG,GAAKH,IAAI,CAACsC,KAAK,CAAC,IAAI,CAACP,CAAC,EAAE,CAAC,IAAI,CAACD,CAAC,CAAC,GAAG,GAAG,GAAI9B,IAAI,CAACE,EAAG,CAAC;EAC3E,CAAC;EACDqC,UAAU,EAAE,oBAASC,SAAS,EAAE;IAC/B,IAAIH,KAAK,GAAGrC,IAAI,CAACG,OAAO,CAAC,IAAI,CAACkC,KAAK,EAAE,GAAGG,SAAS,CAAC;IAClD,IAAIC,OAAO,GAAGzC,IAAI,CAACC,GAAG,GAAGoC,KAAK;IAE9B,IAAIE,UAAU,GAAGvC,IAAI,CAACU,OAAO,CAACV,IAAI,CAACuB,GAAG,CAACkB,OAAO,CAAC,EAAE,CAAC,CAAC;IACnD,OAAOF,UAAU;EAClB,CAAC;EACDG,MAAM,EAAE,kBAAW;IAClB,OAAO1C,IAAI,CAAC2C,IAAI,CAAI,IAAI,CAACb,CAAC,GAAG,IAAI,CAACA,CAAC,GAAO,IAAI,CAACC,CAAC,GAAG,IAAI,CAACA,CAAE,CAAE;EAC7D,CAAC;EACDa,IAAI,EAAE,gBAAW;IAChB,IAAG5C,IAAI,CAACyB,GAAG,CAAC,IAAI,CAACK,CAAC,CAAC,GAAG9B,IAAI,CAACyB,GAAG,CAAC,IAAI,CAACM,CAAC,CAAC,EAAE;MACvC,IAAI,CAACA,CAAC,GAAG,IAAI,CAACA,CAAC,GAAG/B,IAAI,CAACyB,GAAG,CAAC,IAAI,CAACK,CAAC,CAAC;MAClC,IAAI,CAACA,CAAC,GAAG,IAAI,CAACA,CAAC,GAAG9B,IAAI,CAACyB,GAAG,CAAC,IAAI,CAACK,CAAC,CAAC;IACnC,CAAC,MAAM;MACN,IAAI,CAACA,CAAC,GAAG,IAAI,CAACA,CAAC,GAAG9B,IAAI,CAACyB,GAAG,CAAC,IAAI,CAACM,CAAC,CAAC;MAClC,IAAI,CAACA,CAAC,GAAG,IAAI,CAACA,CAAC,GAAG/B,IAAI,CAACyB,GAAG,CAAC,IAAI,CAACM,CAAC,CAAC;IACnC;EACD,CAAC;EACDc,MAAM,EAAE,gBAASC,MAAM,EAAET,KAAK,EAAE;IAC/B,IAAII,OAAO,GAAGzC,IAAI,CAACC,GAAG,GAAGoC,KAAK;MAC7Bd,GAAG,GAAGvB,IAAI,CAACuB,GAAG,CAACkB,OAAO,CAAC;MACvBM,GAAG,GAAG/C,IAAI,CAAC+C,GAAG,CAACN,OAAO,CAAC;MACvBX,CAAC,GAAG,IAAI,CAACA,CAAC;MACVC,CAAC,GAAG,IAAI,CAACA,CAAC;IACX,IAAI,CAACD,CAAC,GAAIP,GAAG,IAAIO,CAAC,GAAGgB,MAAM,CAAChB,CAAC,CAAC,GAAKiB,GAAG,IAAIhB,CAAC,GAAGe,MAAM,CAACf,CAAC,CAAE,GAAGe,MAAM,CAAChB,CAAC;IACnE,IAAI,CAACC,CAAC,GAAIR,GAAG,IAAIQ,CAAC,GAAGe,MAAM,CAACf,CAAC,CAAC,GAAKgB,GAAG,IAAIjB,CAAC,GAAGgB,MAAM,CAAChB,CAAC,CAAE,GAAGgB,MAAM,CAACf,CAAC;EACpE,CAAC;EACDiB,SAAS,EAAE,mBAASZ,KAAK,EAAE;IAC1B,IAAI,CAACN,CAAC,IAAIM,KAAK,CAACN,CAAC;IACjB,IAAI,CAACC,CAAC,IAAIK,KAAK,CAACL,CAAC;EAClB;AACD,CAAC,C;;;;;;;;;;;;ACpID;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,IAAMkB,MAAM,GAAGC,mBAAO,CAAC,sBAAQ,CAAC;AAChC,IAAMC,QAAQ,GAAGD,mBAAO,CAAC,wCAAiB,CAAC;AAC3C,IAAME,EAAE,GAAGF,mBAAO,CAAC,4BAAW,CAAC;AACoB;AACyC;AAEzD;AACnC,IAAMG,oBAAoB,GAAG,uBAAuB;AACpD,IAAMC,uBAAuB,GAAG,YAAY;AAE5C,IAAMC,WAAW,GAAG,CAAC,kBAAkB,EAAC,kBAAkB,EAAC,aAAa,EAAC,iBAAiB,EAAC,gBAAgB,EAAC,aAAa,CAAC;AAC1H,IAAMC,UAAU,GAAG,CAAC,QAAQ,EAAC,WAAW,EAAC,MAAM,EAAC,UAAU,EAAC,SAAS,EAAC,MAAM,CAAC;AAC5E,IAAMC,UAAU,GAAG,CAAC,cAAc,EAAE,WAAW,EAAE,MAAM,EAAE,UAAU,EAAE,SAAS,EAAE,MAAM,CAAC;AAEvF,IAAMC,kBAAkB,GAAG,CAAC,OAAO,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,OAAO,EAAE,SAAS,EAAE,QAAQ,EAAE,WAAW,EAAE,MAAM,CAAC;AACrH,IAAMC,OAAO,GAAG,4EAA4E;;AAE5F;AACA;;AAEe,yEAAUC,OAAO,EAAE;EAEjC;EACA;EACA;EACA;EACA;EACA;EACA;;EAEA;EACA,IAAMC,OAAO,GAAG;IACfC,UAAU,EAAET,oBAAoB;IAChCU,KAAK,EAAE,GAAG;IACVC,MAAM,EAAE,GAAG;IACXC,IAAI,EAAE,KAAK;IACXC,eAAe,EAAE,WAAW;IAC5BC,WAAW,EAAE,IAAI;IACjBC,SAAS,EAAE,KAAK;IAChBC,aAAa,EAAE,SAAS;IACxBC,WAAW,EAAE,KAAK;IAClBC,WAAW,EAAE;EACd,CAAC;EACD,IAAMC,aAAa,GAAG,IAAIC,6DAAa,CAACZ,OAAO,CAAC;;EAEhD;EACAW,aAAa,CAACE,IAAI,CAAC,eAAe,EAAE,YAAM;IACzC;IACAvB,QAAQ,CAACwB,gBAAgB,CAACrB,uBAAuB,GAAC,QAAQ,EAAE,IAAI,CAAC;IACjE;IACAkB,aAAa,CAACP,IAAI,EAAE;EACrB,CAAC,CAAC;;EAEF;EACAO,aAAa,CAACE,IAAI,CAAC,OAAO,EAAE,YAAM;IACjC;IACAvB,QAAQ,CAACwB,gBAAgB,CAACrB,uBAAuB,GAAC,QAAQ,EAAE,KAAK,CAAC;EACnE,CAAC,CAAC;EAEF,IAAMsB,WAAW,GAAGJ,aAAa,CAACI,WAAW;;EAE7C;EACAA,WAAW,CAACC,EAAE,CAAC,iBAAiB,EAAE,YAAM;IACvC;IACAC,eAAe,EAAE;EAClB,CAAC,CAAC;;EAEF;EACAF,WAAW,CAACC,EAAE,CAAC,YAAY,EAAE,UAAAE,GAAG,EAAI;IACnCC,WAAW,CAACC,eAAe,EAAE,CAACC,OAAO,CAACC,KAAK,CAACC,aAAa,CAACL,GAAG,CAAC,CAAC;EAChE,CAAC,CAAC;;EAEF;EACAH,WAAW,CAACC,EAAE,CAAC,iBAAiB,EAAE,UAAAQ,WAAW,EAAI;IAChDA,WAAW,GAAGC,IAAI,CAACC,KAAK,CAACF,WAAW,CAAC;IACrC,IAAGA,WAAW,CAACG,MAAM,EAAE;MACtB,QAAOH,WAAW,CAACG,MAAM;QACxB,KAAK,cAAc;UAClB;UACAV,eAAe,EAAE;UACjB;QACD,KAAK,WAAW;UACf;UACAW,MAAM,CAACJ,WAAW,CAAC;UACnB;QACD,KAAK,OAAO;UACX;UACAK,cAAc,CAACL,WAAW,CAAC;UAC3B;MAAM;IAET;EACD,CAAC,CAAC;;EAEF;EACAb,aAAa,CAACmB,OAAO,CAACzC,mBAAO,CAAC,2DAA2B,CAAC,CAAC;AAC5D,CAAC;;AAED;AACO,SAAS0C,UAAU,GAAG;EAC3B,IAAMC,eAAe,GAAGC,gFAAU,CAACzC,oBAAoB,CAAC;EACxD,IAAIwC,eAAe,EAAE;IACnBA,eAAe,CAACE,KAAK,EAAE;EACzB;AACF;;AAEA;AACA,SAASC,gBAAgB,CAACC,OAAO,EAAiC;EAAA,IAA/BC,QAAQ,uEAAG,kBAAkB;EAC9DD,OAAO,GAAGX,IAAI,CAACa,SAAS,CAACF,OAAO,CAAC;EACjC,IAAIG,sFAAgB,CAAC/C,oBAAoB,CAAC,EAAE;IAC1CgD,mFAAa,CAAChD,oBAAoB,YAAK6C,QAAQ,cAAID,OAAO,OAAI;EAChE;AACF;;AAEA;AACO,SAASK,kBAAkB,CAAC1C,OAAO,EAAE;EAC3C;EACA;EACA,IAAGT,QAAQ,CAACoD,aAAa,CAACjD,uBAAuB,GAAC,QAAQ,CAAC,EAAE;IAC5DwB,eAAe,EAAE;EAClB;AACD;;AAEA;AACA,SAASA,eAAe,GAAG;EAE1B;EACA,IAAM0B,QAAQ,GAAGvD,MAAM,CAACwD,mBAAmB,EAAE;EAC7C,IAAMC,cAAc,GAAGF,QAAQ,CAACE,cAAc,CAACC,MAAM;;EAErD;EACAxD,QAAQ,CAACwB,gBAAgB,CAACrB,uBAAuB,EAAE,KAAK,CAAC;;EAEzD;EACA,IAAIsD,UAAU,GAAG;IAChBC,OAAO,EAAE,CAAC;IACVC,MAAM,EAAE,CAAC;IACTC,KAAK,EAAE,CAAC;IACRC,KAAK,EAAE,CAAC;IACRC,SAAS,EAAE,KAAK;IAChBC,QAAQ,EAAE,KAAK;IACfC,MAAM,EAAE;EACT,CAAC;;EAED;EACA,IAAIC,SAAS,GAAG;IACfC,KAAK,EAAE,OAAO;IACdC,IAAI,EAAE,CAAC;IACPC,KAAK,EAAE,EAAE;IACTC,KAAK,EAAE,KAAK;IACZC,QAAQ,EAAE,KAAK;IACfC,OAAO,EAAE,EAAE;IACXC,KAAK,EAAE,EAAE;IACTC,MAAM,EAAE,EAAE;IACVC,QAAQ,EAAE;EACX,CAAC;EACD,KAAI,IAAIrH,EAAC,IAAIkD,kBAAkB,EAAE;IAChC,IAAIoE,UAAU,GAAG3E,QAAQ,CAACoD,aAAa,CAACjD,uBAAuB,GAACI,kBAAkB,CAAClD,EAAC,CAAC,CAAC;IACtF4G,SAAS,CAAC1D,kBAAkB,CAAClD,EAAC,CAAC,CAAC,GAAGsH,UAAU,IAAIA,UAAU,KAAK,KAAK,GAAGA,UAAU,GAAG,WAAW;EACjG;EACA,IAAIC,SAAS,GAAG;IACfjG,CAAC,EAAC,CAAC;IACHC,CAAC,EAAC,CAAC;IACHiG,CAAC,EAAC,CAAC;IACHC,CAAC,EAAC,CAAC;IACH7H,GAAG,EAAC,CAAC;IACL8H,QAAQ,EAAE;EACX,CAAC;EACD,IAAIC,OAAO,GAAG;IACbrG,CAAC,EAAC,CAAC;IACHC,CAAC,EAAC,CAAC;IACHiG,CAAC,EAAC,CAAC;IACHC,CAAC,EAAC,CAAC;IACH7H,GAAG,EAAC,CAAC;IACL8H,QAAQ,EAAE;EACX,CAAC;;EAED;EACA,IAAIE,QAAQ,GAAG,IAAI;;EAEnB;EACA,KAAK,IAAI5H,CAAC,GAAC,CAAC,EAAEA,CAAC,GAACkG,cAAc,CAAC2B,MAAM,EAAE7H,CAAC,EAAE,EAAE;IAC3C;IACA,IAAI8H,aAAa,GAAG5B,cAAc,CAAClG,CAAC,CAAC;IACrC;IACA,IAAI+H,QAAQ,GAAGD,aAAa,CAACE,SAAS;;IAEtC;IACA,IAAGhF,UAAU,CAACiF,OAAO,CAACF,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAI,CAACD,aAAa,CAACI,MAAM,EAAE;MAC9D;MACA9B,UAAU,CAACI,KAAK,EAAG;MACnB,IAAGJ,UAAU,CAACI,KAAK,IAAI,CAAC,EAAE;QACzB;QACAI,SAAS,CAACK,QAAQ,GAAGtE,QAAQ,CAACwF,kBAAkB,CAACL,aAAa,EAAEhF,uBAAuB,CAAC;QACxF;QACAsD,UAAU,CAACK,SAAS,GAAGqB,aAAa,CAACM,MAAM;QAC3CxB,SAAS,CAACS,QAAQ,GAAGS,aAAa,CAACM,MAAM,CAACC,EAAE;QAC5C;QACA,IAAIC,WAAW,GAAGR,aAAa,CAACS,YAAY;QAC5C;QACA,IAAIC,IAAI,GAAGC,YAAY,CAACC,oBAAoB,CAACJ,WAAW,CAACK,yBAAyB,EAAE,CAACC,MAAM,EAAE,CAAC;QAC9F;QACA,IAAIC,aAAa,GAAGL,IAAI,CAACX,MAAM,EAAE,GAAG,EAAE;QACtCgB,aAAa,GAAGA,aAAa,GAAG,EAAE,GAAG,EAAE,GAAGA,aAAa;QACvD;QACAjC,SAAS,CAACQ,MAAM,GAAGU,aAAa,CAACO,EAAE;QACnC;QACA,IAAGT,QAAQ,EAAE;UACZL,SAAS,CAACC,CAAC,GAAGqB,aAAa;UAC3BtB,SAAS,CAACE,CAAC,GAAGoB,aAAa;UAC3BtB,SAAS,CAAC3H,GAAG,GAAGJ,IAAI,CAACG,OAAO,CAAEmI,aAAa,CAACgB,SAAS,CAACC,QAAQ,GAAG,CAAC,CAAE;UACpEpB,OAAO,CAACH,CAAC,GAAGqB,aAAa;UACzBlB,OAAO,CAACF,CAAC,GAAGoB,aAAa;UACzBlB,OAAO,CAAC/H,GAAG,GAAGJ,IAAI,CAACG,OAAO,CAAEmI,aAAa,CAACgB,SAAS,CAACC,QAAQ,GAAG,CAAC,CAAE;QACnE;MACD;IAED,CAAC,MAAM;MACN;MACA,IAAG/F,UAAU,CAACiF,OAAO,CAACF,QAAQ,CAAC,GAAG,CAAC,CAAC,EAAE;QACrC3B,UAAU,CAACE,MAAM,EAAG;QACpB;QACAM,SAAS,CAACG,KAAK,GAAG9D,UAAU,CAACD,UAAU,CAACiF,OAAO,CAAEF,QAAQ,CAAE,CAAC;QAC5D,IAAGA,QAAQ,IAAI,WAAW,EAAE3B,UAAU,CAACG,KAAK,EAAG;MAChD,CAAC,MAAM;QACN;QACAH,UAAU,CAACC,OAAO,EAAG;MACtB;MACA,IAAG,CAACD,UAAU,CAACI,KAAK,EAAE;QACrB;QACAJ,UAAU,CAACK,SAAS,GAAGqB,aAAa,CAACM,MAAM;QAC3CxB,SAAS,CAACS,QAAQ,GAAGS,aAAa,CAACM,MAAM,CAACC,EAAE;MAC7C;MACA,IAAGT,QAAQ,EAAE;QAAE;QACdA,QAAQ,GAAG,KAAK;QAChB;QACAxB,UAAU,CAACM,QAAQ,GAAGoB,aAAa,CAACM,MAAM;QAC1CxB,SAAS,CAACM,OAAO,GAAGY,aAAa,CAACO,EAAE;QACpC;QACAd,SAAS,CAACjG,CAAC,GAAGwG,aAAa,CAACkB,KAAK,CAAC1H,CAAC,GAAIwG,aAAa,CAACkB,KAAK,CAACzF,KAAK,GAAG,CAAE;QACrEgE,SAAS,CAAChG,CAAC,GAAGuG,aAAa,CAACkB,KAAK,CAACzH,CAAC,GAAIuG,aAAa,CAACkB,KAAK,CAACxF,MAAM,GAAG,CAAE;QACtE+D,SAAS,CAACC,CAAC,GAAGM,aAAa,CAACkB,KAAK,CAACzF,KAAK,GAAG,GAAG;QAC7CgE,SAAS,CAACE,CAAC,GAAGK,aAAa,CAACkB,KAAK,CAACxF,MAAM,GAAG,GAAG;QAC9C+D,SAAS,CAAC3H,GAAG,GAAGJ,IAAI,CAACG,OAAO,CAAEmI,aAAa,CAACgB,SAAS,CAACC,QAAQ,GAAG,CAAC,CAAE;QACpE;QACApB,OAAO,CAACrG,CAAC,GAAGwG,aAAa,CAACkB,KAAK,CAAC1H,CAAC,GAAIwG,aAAa,CAACkB,KAAK,CAACzF,KAAK,GAAG,CAAE;QACnEoE,OAAO,CAACpG,CAAC,GAAGuG,aAAa,CAACkB,KAAK,CAACzH,CAAC,GAAIuG,aAAa,CAACkB,KAAK,CAACxF,MAAM,GAAG,CAAE;QACpEmE,OAAO,CAACH,CAAC,GAAG,CAAC;QACbG,OAAO,CAACF,CAAC,GAAG,CAAC;QACbE,OAAO,CAAC/H,GAAG,GAAGJ,IAAI,CAACG,OAAO,CAAEmI,aAAa,CAACgB,SAAS,CAACC,QAAQ,GAAG,CAAC,CAAE;MAEnE,CAAC,MAAM;QAAE;QACR;QACA3C,UAAU,CAACO,MAAM,GAAGmB,aAAa,CAACM,MAAM;QACxCxB,SAAS,CAACO,KAAK,GAAGW,aAAa,CAACO,EAAE;QAClC;QACAV,OAAO,CAACrG,CAAC,GAAGwG,aAAa,CAACkB,KAAK,CAAC1H,CAAC,GAAIwG,aAAa,CAACkB,KAAK,CAACzF,KAAK,GAAG,CAAE;QACnEoE,OAAO,CAACpG,CAAC,GAAGuG,aAAa,CAACkB,KAAK,CAACzH,CAAC,GAAIuG,aAAa,CAACkB,KAAK,CAACxF,MAAM,GAAG,CAAE;QACpEmE,OAAO,CAACH,CAAC,GAAGM,aAAa,CAACkB,KAAK,CAACzF,KAAK,GAAG,GAAG;QAC3CoE,OAAO,CAACF,CAAC,GAAGK,aAAa,CAACkB,KAAK,CAACxF,MAAM,GAAG,GAAG;QAC5CmE,OAAO,CAAC/H,GAAG,GAAGJ,IAAI,CAACG,OAAO,CAAEmI,aAAa,CAACgB,SAAS,CAACC,QAAQ,GAAG,CAAC,CAAE;MAEnE;IACD;EACD;;EAEA;EACA,IAAIE,CAAC,GAAG7C,UAAU,CAACC,OAAO;EAC1B,IAAI6C,CAAC,GAAG9C,UAAU,CAACE,MAAM;EACzB,IAAI6C,CAAC,GAAG/C,UAAU,CAACI,KAAK;EACxB,IAAI4C,CAAC,GAAGhD,UAAU,CAACG,KAAK;EACxBK,SAAS,CAACE,IAAI,GAAG,CAAC;EAClB,IAAImC,CAAC,IAAE,CAAC,IAAI,CAACC,CAAC,IAAI,CAACC,CAAC,EAAG;IACtBvC,SAAS,CAACE,IAAI,GAAG,CAAC,CAAC,CAAC;EACrB,CAAC,MAAM,IAAI,CAACmC,CAAC,IAAIC,CAAC,IAAE,CAAC,IAAI,CAACE,CAAC,IAAI,CAACD,CAAC,EAAG;IACnCvC,SAAS,CAACE,IAAI,GAAG,CAAC,CAAC,CAAC;EACrB,CAAC,MAAM,IAAI,CAACmC,CAAC,IAAIC,CAAC,IAAE,CAAC,IAAIE,CAAC,IAAI,CAACD,CAAC,EAAG;IAClCvC,SAAS,CAACE,IAAI,GAAG,CAAC,CAAC,CAAC;IACpB;EACD,CAAC,MAAM,IAAImC,CAAC,GAACC,CAAC,GAAC,CAAC,IAAIC,CAAC,IAAE,CAAC,EAAG;IAC1BvC,SAAS,CAACE,IAAI,GAAG,CAAC,CAAC,CAAC;EACrB,CAAC,MAAM,IAAImC,CAAC,GAACC,CAAC,IAAE,CAAC,IAAI,CAACC,CAAC,EAAG;IACzBvC,SAAS,CAACE,IAAI,GAAG,CAAC,CAAC,CAAC;EACrB,CAAC,MAAM,IAAImC,CAAC,GAACC,CAAC,GAACC,CAAC,IAAE,CAAC,IAAIA,CAAC,IAAE,CAAC,EAAG;IAC7BvC,SAAS,CAACE,IAAI,GAAG,CAAC,CAAC,CAAC;EACrB;;EAEA;EACAV,UAAU,CAACK,SAAS,GAAG4C,gBAAgB,CAACjD,UAAU,CAACK,SAAS,CAAC;EAC7DL,UAAU,CAACM,QAAQ,GAAG2C,gBAAgB,CAACjD,UAAU,CAACM,QAAQ,CAAC;EAC3DN,UAAU,CAACO,MAAM,GAAG0C,gBAAgB,CAACjD,UAAU,CAACO,MAAM,CAAC;;EAEvD;EACAY,SAAS,CAACG,QAAQ,GAAGtB,UAAU,CAACM,QAAQ,CAAC0C,CAAC;EAC1CzB,OAAO,CAACD,QAAQ,GAAGtB,UAAU,CAACM,QAAQ,CAAC0C,CAAC;;EAExC;EACA,IAAGxC,SAAS,CAACE,IAAI,IAAI,CAAC,IAAIV,UAAU,CAACM,QAAQ,IAAIN,UAAU,CAACO,MAAM,IAAIP,UAAU,CAACM,QAAQ,CAAC2B,EAAE,IAAIjC,UAAU,CAACO,MAAM,CAAC0B,EAAE,EAAE;IACrHd,SAAS,CAACjG,CAAC,IAAI8E,UAAU,CAACM,QAAQ,CAACpF,CAAC;IACpCiG,SAAS,CAAChG,CAAC,IAAI6E,UAAU,CAACM,QAAQ,CAACnF,CAAC;IACpCgG,SAAS,CAAC3H,GAAG,GAAGJ,IAAI,CAACG,OAAO,CAAC4H,SAAS,CAAC3H,GAAG,GAAGwG,UAAU,CAACM,QAAQ,CAAC0C,CAAC,CAAC;IACnE7B,SAAS,CAACG,QAAQ,GAAG,CAAC;IACtBC,OAAO,CAACrG,CAAC,IAAI8E,UAAU,CAACO,MAAM,CAACrF,CAAC;IAChCqG,OAAO,CAACpG,CAAC,IAAI6E,UAAU,CAACO,MAAM,CAACpF,CAAC;IAChCoG,OAAO,CAAC/H,GAAG,GAAGJ,IAAI,CAACG,OAAO,CAACgI,OAAO,CAAC/H,GAAG,GAAGwG,UAAU,CAACO,MAAM,CAACyC,CAAC,CAAC;IAC7DzB,OAAO,CAACD,QAAQ,GAAG,CAAC;IACpBd,SAAS,CAACS,QAAQ,GAAG,EAAE,CAAC,CAAC;EAC1B;EACA;EACA,IAAGT,SAAS,CAACE,IAAI,IAAI,CAAC,IAAIV,UAAU,CAACM,QAAQ,CAAC2B,EAAE,IAAIjC,UAAU,CAACM,QAAQ,CAAC2B,EAAE,IAAIjC,UAAU,CAACK,SAAS,CAAC4B,EAAE,EAAE;IACtGd,SAAS,CAACjG,CAAC,IAAI8E,UAAU,CAACM,QAAQ,CAACpF,CAAC,GAAG8E,UAAU,CAACK,SAAS,CAACnF,CAAC;IAC7DiG,SAAS,CAAChG,CAAC,IAAI6E,UAAU,CAACM,QAAQ,CAACnF,CAAC,GAAG6E,UAAU,CAACK,SAAS,CAAClF,CAAC;IAC7DgG,SAAS,CAAC3H,GAAG,GAAGJ,IAAI,CAACG,OAAO,CAAC4H,SAAS,CAAC3H,GAAG,GAAGwG,UAAU,CAACM,QAAQ,CAAC0C,CAAC,GAAGhD,UAAU,CAACK,SAAS,CAAC2C,CAAC,CAAC;IAC5F7B,SAAS,CAACG,QAAQ,GAAGtB,UAAU,CAACK,SAAS,CAAC2C,CAAC;IAC3C,IAAGxC,SAAS,CAACE,IAAI,IAAI,CAAC,IAAIV,UAAU,CAACO,MAAM,CAAC0B,EAAE,IAAIjC,UAAU,CAACO,MAAM,CAAC0B,EAAE,IAAIjC,UAAU,CAACK,SAAS,CAAC4B,EAAE,EAAE;MAClGV,OAAO,CAACrG,CAAC,IAAI8E,UAAU,CAACO,MAAM,CAACrF,CAAC,GAAG8E,UAAU,CAACK,SAAS,CAACnF,CAAC;MACzDqG,OAAO,CAACpG,CAAC,IAAI6E,UAAU,CAACO,MAAM,CAACpF,CAAC,GAAG6E,UAAU,CAACK,SAAS,CAAClF,CAAC;MACzDoG,OAAO,CAAC/H,GAAG,GAAGJ,IAAI,CAACG,OAAO,CAACgI,OAAO,CAAC/H,GAAG,GAAGwG,UAAU,CAACO,MAAM,CAACyC,CAAC,GAAGhD,UAAU,CAACK,SAAS,CAAC2C,CAAC,CAAC;IACvF,CAAC,MAAM;MACNzB,OAAO,CAAC/H,GAAG,GAAG2H,SAAS,CAAC3H,GAAG;IAC5B;IACA+H,OAAO,CAACD,QAAQ,GAAGtB,UAAU,CAACK,SAAS,CAAC2C,CAAC;EAC1C;;EAEA;EACAxC,SAAS,CAACC,KAAK,GAAGjE,EAAE,CAAC0G,QAAQ,EAAE;;EAE/B;EACA,IAAI7D,OAAO,GAAG;IAAEmB,SAAS,EAATA,SAAS;IAAEW,SAAS,EAATA,SAAS;IAAEI,OAAO,EAAPA;EAAQ,CAAC;;EAE/C;EACAnC,gBAAgB,CAACC,OAAO,EAAE,cAAc,CAAC;AAE1C;;AAEA;AACA,SAAS4D,gBAAgB,CAACE,GAAG,EAAE;EAC9B,IAAIC,IAAI,GAAG;IACVnB,EAAE,EAAEkB,GAAG,CAAClB,EAAE,GAAGkB,GAAG,CAAClB,EAAE,GAAG,KAAK;IAC3B/G,CAAC,EAAE,CAAC;IACJC,CAAC,EAAE,CAAC;IACJ6H,CAAC,EAAE;EACJ,CAAC;EACD,OAAMG,GAAG,IAAIA,GAAG,CAACE,IAAI,EAAE;IACtBD,IAAI,CAAClI,CAAC,IAAIiI,GAAG,CAACP,KAAK,CAAC1H,CAAC;IACrBkI,IAAI,CAACjI,CAAC,IAAIgI,GAAG,CAACP,KAAK,CAACzH,CAAC;IACrBiI,IAAI,CAACJ,CAAC,IAAIG,GAAG,CAACT,SAAS,CAACC,QAAQ;IAChCQ,GAAG,GAAGA,GAAG,CAACnB,MAAM;EACjB;EAAC;EACD,OAAOoB,IAAI;AACZ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASvE,MAAM,CAACyE,IAAI,EAAE;EAErB;EACA,IAAI1D,QAAQ,GAAGvD,MAAM,CAACwD,mBAAmB,EAAE;;EAE3C;EACA,IAAI0D,aAAa,GAAGD,IAAI,CAACnC,SAAS;EAClC,IAAIqC,WAAW,GAAGF,IAAI,CAAC/B,OAAO;EAC9B,IAAIkC,YAAY,GAAGH,IAAI,CAACI,QAAQ;;EAEhC;EACA,KAAI,IAAI9J,CAAC,IAAIkD,kBAAkB,EAAE;IAChCP,QAAQ,CAACwB,gBAAgB,CAACrB,uBAAuB,GAACI,kBAAkB,CAAClD,CAAC,CAAC,EAAE6J,YAAY,CAAC3G,kBAAkB,CAAClD,CAAC,CAAC,CAAC,CAAC;EAC9G;;EAEA;EACA,IAAIP,GAAG,GAAG;IACToI,MAAM,EAAE,IAAIpG,kDAAQ,CACnBkI,aAAa,CAACnC,CAAC,EACfmC,aAAa,CAAClC,CAAC,CACf;IACD/G,IAAI,EAAE,IAAIe,kDAAQ,EAAE;IACpBsI,MAAM,EAAE,IAAItI,kDAAQ,CACnBmI,WAAW,CAACpC,CAAC,EACboC,WAAW,CAACnC,CAAC,CACb;IACDpG,KAAK,EAAE,CAAC;IACR2I,KAAK,EAAE;EACR,CAAC;EACD;EACA,IAAGvK,GAAG,CAACoI,MAAM,CAACvG,CAAC,IAAI,CAAC,IAAI7B,GAAG,CAACoI,MAAM,CAACtG,CAAC,IAAI,CAAC,EAAE;IAC1C9B,GAAG,CAACoI,MAAM,CAACvG,CAAC,GAAG,MAAM;IACrB7B,GAAG,CAACoI,MAAM,CAACtG,CAAC,GAAG,MAAM;EACtB;EACA,IAAG9B,GAAG,CAACsK,MAAM,CAACzI,CAAC,IAAI,CAAC,IAAI7B,GAAG,CAACsK,MAAM,CAACxI,CAAC,IAAI,CAAC,EAAE;IAC1C9B,GAAG,CAACsK,MAAM,CAACzI,CAAC,GAAG,MAAM;IACrB7B,GAAG,CAACsK,MAAM,CAACxI,CAAC,GAAG,MAAM;EACtB;EACA;EACA,IAAI0I,GAAG,GAAG;IACTpI,KAAK,EAAErC,IAAI,CAACG,OAAO,CAAEgK,aAAa,CAAC/J,GAAG,CAAE;IACxCc,IAAI,EAAE,CAAC;IACPqJ,MAAM,EAAEvK,IAAI,CAACG,OAAO,CAAEiK,WAAW,CAAChK,GAAG;EACtC,CAAC;EACD;EACA,IAAIsK,KAAK,GAAG;IACX5H,MAAM,EAAE,IAAIb,kDAAQ,CACnBkI,aAAa,CAACrI,CAAC,EACfqI,aAAa,CAACpI,CAAC,CACf;IACDb,IAAI,EAAE,CAAC;IACPqJ,MAAM,EAAE,IAAItI,kDAAQ,CACnBmI,WAAW,CAACtI,CAAC,EACbsI,WAAW,CAACrI,CAAC,CACb;IACDF,KAAK,EAAE,CAAC;IACR2I,KAAK,EAAE;EACR,CAAC;;EAED;EACA,IAAIzJ,KAAK,GAAGsJ,YAAY,CAACM,KAAK,GAAGN,YAAY,CAAChJ,MAAM;;EAEpD;EACA,IAAIL,UAAU,GAAGhB,IAAI,CAAC2B,SAAS,CAAC0I,YAAY,CAACvJ,MAAM,EAAEuJ,YAAY,CAACzI,KAAK,GAAG,IAAI,EAAEb,KAAK,CAAC;;EAEtF;EACA,IAAI6J,GAAG,GAAG;IACTC,KAAK,EAAE,KAAK;IACZ5J,KAAK,EAAE,IAAIgB,kDAAQ,EAAE;IACrBoG,MAAM,EAAE;EACT,CAAC;;EAED;EACA,IAAGgC,YAAY,CAACS,OAAO,EAAE;IAExB;IACAT,YAAY,CAACM,KAAK,GAAG3K,IAAI,CAACW,KAAK,CAAC0J,YAAY,CAACM,KAAK,CAAC,GAAG,GAAG;IACzD5J,KAAK,GAAGsJ,YAAY,CAACM,KAAK,GAAGN,YAAY,CAAChJ,MAAM;IAChDL,UAAU,GAAGhB,IAAI,CAAC2B,SAAS,CAAC0I,YAAY,CAACvJ,MAAM,EAAEuJ,YAAY,CAACzI,KAAK,GAAG,IAAI,EAAEb,KAAK,CAAC;;IAGlF;IACA,IAAMgK,OAAO,GAAGvE,QAAQ,CAACwE,cAAc,CAACX,YAAY,CAAC3C,OAAO,CAAC;IAC7D,IAAMuD,WAAW,GAAGF,OAAO,CAAChC,YAAY;IACxC;IACA,IAAMmC,WAAW,GAAGD,WAAW,CAAC9B,yBAAyB,EAAE;IAC3D;IACA,IAAIgC,IAAI,GAAG;MACVC,GAAG,EAAE,KAAK;MACVC,MAAM,EAAE,KAAK;MACbb,KAAK,EAAE;IACR,CAAC;IACD;IACA,KAAI,IAAIc,CAAC,GAAC,CAAC,EAAEA,CAAC,IAAEtL,IAAI,CAACW,KAAK,CAACuK,WAAW,CAAC7C,MAAM,EAAE,CAAC,EAAEiD,CAAC,EAAE,EAAE;MACtD,IAAIlJ,KAAK,GAAG8I,WAAW,CAACK,mBAAmB,CAAED,CAAC,CAAE;MAChD,IAAIxJ,CAAC,GAAG9B,IAAI,CAACW,KAAK,CAACyB,KAAK,CAACN,CAAC,CAAC;MAC3B,IAAIC,CAAC,GAAG/B,IAAI,CAACW,KAAK,CAACyB,KAAK,CAACL,CAAC,CAAC;;MAE3B;MACA,IAAG,CAAC6I,GAAG,CAACC,KAAK,EAAE;QACdD,GAAG,CAACC,KAAK,GAAG,IAAI5I,kDAAQ,CAAEH,CAAC,EAAEC,CAAC,CAAE;MACjC;MACA,IAAGD,CAAC,IAAI8I,GAAG,CAAC3J,KAAK,CAACa,CAAC,IAAIC,CAAC,IAAI6I,GAAG,CAAC3J,KAAK,CAACc,CAAC,IAAIuJ,CAAC,IAAItL,IAAI,CAACW,KAAK,CAACuK,WAAW,CAAC7C,MAAM,EAAE,CAAC,EAAE;QACjFuC,GAAG,CAACvC,MAAM,EAAE;MACb,CAAC,MAAM,IAAGuC,GAAG,CAACvC,MAAM,GAAG,CAAC,IAAIiD,CAAC,IAAItL,IAAI,CAACW,KAAK,CAACuK,WAAW,CAAC7C,MAAM,EAAE,CAAC,EAAE;QAClE,IAAMmD,WAAW,GAAGxL,IAAI,CAAC2C,IAAI,CAAE,CAACiI,GAAG,CAACC,KAAK,CAAC/I,CAAC,GAAG8I,GAAG,CAAC3J,KAAK,CAACa,CAAC,KAAG8I,GAAG,CAACC,KAAK,CAAC/I,CAAC,GAAG8I,GAAG,CAAC3J,KAAK,CAACa,CAAC,CAAC,GAAG,CAAC8I,GAAG,CAACC,KAAK,CAAC9I,CAAC,GAAG6I,GAAG,CAAC3J,KAAK,CAACc,CAAC,KAAG6I,GAAG,CAACC,KAAK,CAAC9I,CAAC,GAAG6I,GAAG,CAAC3J,KAAK,CAACc,CAAC,CAAC,CAAE;QAClJ,IAAM0J,OAAO,GAAG,IAAIxJ,kDAAQ,CAC3B,CAAC2I,GAAG,CAACC,KAAK,CAAC/I,CAAC,GAAG8I,GAAG,CAAC3J,KAAK,CAACa,CAAC,IAAI0J,WAAW,EACzC,CAACZ,GAAG,CAACC,KAAK,CAAC9I,CAAC,GAAG6I,GAAG,CAAC3J,KAAK,CAACc,CAAC,IAAIyJ,WAAW,CACzC;QACD,KAAI,IAAIE,CAAC,GAAC,CAAC,EAAEA,CAAC,GAACF,WAAW,EAAEE,CAAC,EAAE,EAAE;UAChC,IAAMC,EAAE,GAAG3L,IAAI,CAACW,KAAK,CAAEiK,GAAG,CAAC3J,KAAK,CAACa,CAAC,GAAG4J,CAAC,GAAGD,OAAO,CAAC3J,CAAC,CAAE;UACpD,IAAM8J,EAAE,GAAG5L,IAAI,CAACW,KAAK,CAAEiK,GAAG,CAAC3J,KAAK,CAACc,CAAC,GAAG2J,CAAC,GAAGD,OAAO,CAAC1J,CAAC,CAAE;UACpD,IAAM8J,IAAI,GAAG7L,IAAI,CAAC8L,IAAI,CAAEX,IAAI,CAACX,KAAK,CAACoB,EAAE,CAAC,GAAGD,EAAE,GAAGR,IAAI,CAACX,KAAK,CAACoB,EAAE,CAAC,CAACC,IAAI,GAAGF,EAAE,GAAGR,IAAI,CAACX,KAAK,CAACoB,EAAE,CAAC,CAACC,IAAI,GAAGF,EAAE,CAAE;UACnG,IAAMI,GAAG,GAAG/L,IAAI,CAACgM,KAAK,CAAEb,IAAI,CAACX,KAAK,CAACoB,EAAE,CAAC,GAAGD,EAAE,GAAGR,IAAI,CAACX,KAAK,CAACoB,EAAE,CAAC,CAACG,GAAG,GAAGJ,EAAE,GAAGR,IAAI,CAACX,KAAK,CAACoB,EAAE,CAAC,CAACG,GAAG,GAAGJ,EAAE,CAAE;UACjG,IAAMjJ,MAAM,GAAG,CAACmJ,IAAI,GAAGE,GAAG,IAAI,CAAC;UAC/B,IAAMjJ,MAAM,GAAGiJ,GAAG,GAAGrJ,MAAM;UAC3ByI,IAAI,CAACX,KAAK,CAACoB,EAAE,CAAC,GAAG;YAChBC,IAAI,EAAEA,IAAI;YACVE,GAAG,EAAEA,GAAG;YACRjJ,MAAM,EAAEA,MAAM;YACdJ,MAAM,EAAEA;UACT,CAAC;QACF;QACAkI,GAAG,CAAC3J,KAAK,GAAG,IAAIgB,kDAAQ,CAAEH,CAAC,EAAEC,CAAC,CAAE;QAChC6I,GAAG,CAACvC,MAAM,GAAG,CAAC;MACf,CAAC,MAAM;QACNuC,GAAG,CAAC3J,KAAK,GAAG,IAAIgB,kDAAQ,CAAEH,CAAC,EAAEC,CAAC,CAAE;QAChC6I,GAAG,CAACvC,MAAM,GAAG,CAAC;QACd,IAAMwD,KAAI,GAAG7L,IAAI,CAAC8L,IAAI,CAAEX,IAAI,CAACX,KAAK,CAACzI,CAAC,CAAC,GAAGD,CAAC,GAAGqJ,IAAI,CAACX,KAAK,CAACzI,CAAC,CAAC,CAAC8J,IAAI,GAAG/J,CAAC,GAAGqJ,IAAI,CAACX,KAAK,CAACzI,CAAC,CAAC,CAAC8J,IAAI,GAAG/J,CAAC,CAAE;QAC7F,IAAMiK,IAAG,GAAG/L,IAAI,CAACgM,KAAK,CAAEb,IAAI,CAACX,KAAK,CAACzI,CAAC,CAAC,GAAGD,CAAC,GAAGqJ,IAAI,CAACX,KAAK,CAACzI,CAAC,CAAC,CAACgK,GAAG,GAAGjK,CAAC,GAAGqJ,IAAI,CAACX,KAAK,CAACzI,CAAC,CAAC,CAACgK,GAAG,GAAGjK,CAAC,CAAE;QAC3F,IAAMY,OAAM,GAAG,CAACmJ,KAAI,GAAGE,IAAG,IAAI,CAAC;QAC/B,IAAMjJ,OAAM,GAAGiJ,IAAG,GAAGrJ,OAAM;QAC3ByI,IAAI,CAACC,GAAG,GAAGrJ,CAAC,GAAGoJ,IAAI,CAACC,GAAG,IAAID,IAAI,CAACC,GAAG,KAAK,KAAK,GAAGrJ,CAAC,GAAGoJ,IAAI,CAACC,GAAG;QAC5DD,IAAI,CAACE,MAAM,GAAGtJ,CAAC,GAAGoJ,IAAI,CAACE,MAAM,IAAIF,IAAI,CAACE,MAAM,KAAK,KAAK,GAAGtJ,CAAC,GAAGoJ,IAAI,CAACE,MAAM;QACxEF,IAAI,CAACX,KAAK,CAACzI,CAAC,CAAC,GAAG;UACf8J,IAAI,EAAEA,KAAI;UACVE,GAAG,EAAEA,IAAG;UACRjJ,MAAM,EAAEA,OAAM;UACdJ,MAAM,EAAEA;QACT,CAAC;MAEF;IACD;IAAC;;IAED;IACA+H,GAAG,CAACpI,KAAK,GAAG,CAAC;IACboI,GAAG,CAACF,MAAM,GAAG,CAAC;;IAEd;IACA,IAAI0B,SAAS,GAAGhM,GAAG,CAACoI,MAAM,CAACtG,CAAC;IAC5B,IAAImK,OAAO,GAAID,SAAS,IAAI5B,YAAY,CAACM,KAAK,GAAG,CAAC,CAAE;;IAEpD;IACA,IAAMwB,UAAU,GAAG9B,YAAY,CAACvJ,MAAM,IAAI,QAAQ,GAAG,KAAK,GAAG,IAAI;IAEjE4J,KAAK,GAAG;MACP5H,MAAM,EAAE,IAAIb,kDAAQ,CACnBkJ,IAAI,CAACX,KAAK,CAACW,IAAI,CAACC,GAAG,CAAC,CAACtI,MAAM,EAC3BqI,IAAI,CAACC,GAAG,IAAIe,UAAU,GAAI9B,YAAY,CAACvJ,MAAM,IAAI,MAAM,IAAIuJ,YAAY,CAACvJ,MAAM,IAAI,UAAU,GAAG,CAAC,GAAGoL,OAAO,GAAIA,OAAO,CAAC,CACtH;MACDhL,IAAI,EAAE,CAAC;MACPqJ,MAAM,EAAE,IAAItI,kDAAQ,CACnBkJ,IAAI,CAACX,KAAK,CAACW,IAAI,CAACE,MAAM,CAAC,CAACvI,MAAM,EAC9BqI,IAAI,CAACE,MAAM,IAAIc,UAAU,GAAI9B,YAAY,CAACvJ,MAAM,IAAI,MAAM,IAAIuJ,YAAY,CAACvJ,MAAM,IAAI,SAAS,GAAG,CAAC,GAAGoL,OAAO,GAAIA,OAAO,CAAC,CACxH;MACDrK,KAAK,EAAE,CAAC;MACR2I,KAAK,EAAE;IACR,CAAC;IACDE,KAAK,CAAC7I,KAAK,GAAG,IAAII,kDAAQ,CACzByI,KAAK,CAACH,MAAM,CAACzI,CAAC,GAAG4I,KAAK,CAAC5H,MAAM,CAAChB,CAAC,EAC/B4I,KAAK,CAACH,MAAM,CAACxI,CAAC,GAAG2I,KAAK,CAAC5H,MAAM,CAACf,CAAC,CAC/B;IACD2I,KAAK,CAACxJ,IAAI,GAAG,IAAIe,kDAAQ,CACxByI,KAAK,CAAC7I,KAAK,CAACC,CAAC,GAAGf,KAAK,EACrB2J,KAAK,CAAC7I,KAAK,CAACE,CAAC,GAAGhB,KAAK,CACrB;;IAED;IACAd,GAAG,GAAG;MACLoI,MAAM,EAAE,IAAIpG,kDAAQ,CACnBkJ,IAAI,CAACX,KAAK,CAACW,IAAI,CAACC,GAAG,CAAC,CAAC1I,MAAM,EAC3ByJ,UAAU,GAAI9B,YAAY,CAACvJ,MAAM,IAAI,MAAM,IAAIuJ,YAAY,CAACvJ,MAAM,IAAI,UAAU,GAAG,CAAC,GAAGoL,OAAO,GAAIA,OAAO,CACzG;MACDhL,IAAI,EAAE,IAAIe,kDAAQ,EAAE;MACpBsI,MAAM,EAAE,IAAItI,kDAAQ,CACnBkJ,IAAI,CAACX,KAAK,CAACW,IAAI,CAACE,MAAM,CAAC,CAAC3I,MAAM,EAC9ByJ,UAAU,GAAI9B,YAAY,CAACvJ,MAAM,IAAI,MAAM,IAAIuJ,YAAY,CAACvJ,MAAM,IAAI,SAAS,GAAG,CAAC,GAAGoL,OAAO,GAAIA,OAAO,CACxG;MACDrK,KAAK,EAAE,CAAC;MACR2I,KAAK,EAAE;IACR,CAAC;;IAED;IACA,IAAI4B,UAAU,GAAG,CAAC;IAClB,IAAIC,QAAQ,GAAG,CAAC;IAChB,IAAIC,WAAW,GAAG,CAAC;IAEnB,KAAI,IAAIhB,CAAC,GAAC,CAAC,EAAEA,CAAC,IAAEvK,KAAK,EAAEuK,CAAC,EAAE,EAAE;MAC3B,IAAGtK,UAAU,EAAE;QACdoL,UAAU,IAAIpL,UAAU,CAACsK,CAAC,CAAC,GAAGZ,KAAK,CAAC7I,KAAK,CAACE,CAAC;QAC3C,IAAIwK,UAAU,GAAG,IAAItK,kDAAQ,CAC5BkI,aAAa,CAACrI,CAAC,EACf4I,KAAK,CAAC5H,MAAM,CAACf,CAAC,GAAGqK,UAAU,CAC3B;QACDC,QAAQ,IAAIrL,UAAU,CAACsK,CAAC,CAAC;QACzB,IAAIkB,QAAQ,GAAG,IAAIvK,kDAAQ,CAC1BhC,GAAG,CAACoI,MAAM,CAACvG,CAAC,EACZoK,OAAO,CACP;QACD,IAAGC,UAAU,EAAE;UACdG,WAAW,GAAGtL,UAAU,CAACsK,CAAC,CAAC,GAAGgB,WAAW,GAAGtL,UAAU,CAACsK,CAAC,CAAC,GAAGgB,WAAW;UACvEE,QAAQ,CAACzK,CAAC,GAAGf,UAAU,CAACsK,CAAC,CAAC;QAC3B;MACD,CAAC,MAAM,IAAGA,CAAC,GAAGvK,KAAK,EAAE;QACpB,IAAIwL,UAAU,GAAG,IAAItK,kDAAQ,CAC5BkI,aAAa,CAACrI,CAAC,EACf4I,KAAK,CAAC5H,MAAM,CAACf,CAAC,GAAG,CAACuJ,CAAC,GAAC,CAAC,IAAIZ,KAAK,CAACxJ,IAAI,CAACa,CAAC,CACrC;QACD,IAAIyK,QAAQ,GAAG,IAAIvK,kDAAQ,CAC1BhC,GAAG,CAACoI,MAAM,CAACvG,CAAC,EACZoK,OAAO,CACP;MACF;MACA;MACA,IAAIO,CAAC,GAAGzM,IAAI,CAACuB,GAAG,CAAEvB,IAAI,CAACC,GAAG,GAAGD,IAAI,CAACG,OAAO,CAAEkK,YAAY,CAACM,KAAK,GAAG,GAAG,GAAG5J,KAAK,GAAIuK,CAAC,IAAIjB,YAAY,CAACqC,SAAS,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAE;MACvH,IAAIC,MAAM,GAAG3M,IAAI,CAACW,KAAK,CAAC4L,UAAU,CAACxK,CAAC,GAAGyK,QAAQ,CAACzK,CAAC,GAAG,CAAC0K,CAAC,CAAC;MACvD,IAAIG,YAAY,GAAG5M,IAAI,CAACW,KAAK,CAAC4L,UAAU,CAACxK,CAAC,CAAC;MAE3C,IAAGoJ,IAAI,CAACX,KAAK,CAACoC,YAAY,CAAC,EAAE;QAC5BL,UAAU,CAACzK,CAAC,GAAGqJ,IAAI,CAACX,KAAK,CAACmC,MAAM,CAAC,CAAC7J,MAAM;QACxC0J,QAAQ,CAAC1K,CAAC,GAAGqJ,IAAI,CAACX,KAAK,CAACmC,MAAM,CAAC,CAACjK,MAAM;MACvC;MACA;MACAgI,KAAK,CAACF,KAAK,CAAC9I,IAAI,CAAE6K,UAAU,CAAE;MAC9BtM,GAAG,CAACuK,KAAK,CAAC9I,IAAI,CAAE8K,QAAQ,CAAE;IAE3B;IAAC;;IAED;IACA,IAAGL,UAAU,EAAE;MACd,KAAI,IAAI3L,GAAC,GAAC,CAAC,EAAEA,GAAC,GAACP,GAAG,CAACuK,KAAK,CAACnC,MAAM,EAAE7H,GAAC,EAAE,EAAE;QACrC;QACA;QACA;QACAP,GAAG,CAACuK,KAAK,CAAChK,GAAC,CAAC,CAACuB,CAAC,IAAKmK,OAAO,GAAGI,WAAY;MAC1C;IACD;EACD;;EAEA;EACA,IAAIjK,KAAK,GAAG,CAACgI,YAAY,CAACqC,SAAS,GAAG,CAAC,GAAG,CAAC,CAAC,IAAIrC,YAAY,CAACM,KAAK,GAAG,GAAG,GAAG5J,KAAK,CAAC,CAAC;;EAElF;EACA0J,GAAG,CAACvJ,IAAI,GAAKlB,IAAI,CAACG,OAAO,CAAC,GAAG,GAAGsK,GAAG,CAACF,MAAM,CAAC,GAAGvK,IAAI,CAACG,OAAO,CAAC,GAAG,GAAGsK,GAAG,CAACpI,KAAK,CAAG,CAAC,CAAC;EAC/E,IAAIoI,GAAG,CAACvJ,IAAI,GAAG,GAAG,EAAE;IACnBuJ,GAAG,CAACvJ,IAAI,GAAG,EAAE,GAAG,GAAGuJ,GAAG,CAACvJ,IAAI,CAAC;EAC7B,CAAC,MAAM,IAAIuJ,GAAG,CAACvJ,IAAI,GAAG,CAAC,GAAG,EAAE;IAC3BuJ,GAAG,CAACvJ,IAAI,GAAG,GAAG,GAAGuJ,GAAG,CAACvJ,IAAI;EAC1B;EACA,IAAGuJ,GAAG,CAACvJ,IAAI,GAAG,CAAC,IAAI,CAACmJ,YAAY,CAACqC,SAAS,EAAE;IAC3CjC,GAAG,CAACvJ,IAAI,IAAI,GAAG;EAChB;EACA,IAAGuJ,GAAG,CAACvJ,IAAI,GAAG,CAAC,IAAImJ,YAAY,CAACqC,SAAS,EAAE;IAC1CjC,GAAG,CAACvJ,IAAI,IAAI,GAAG;EAChB;EACAuJ,GAAG,CAACvJ,IAAI,IAAIH,KAAK;EACjB;EACA2J,KAAK,CAAC7I,KAAK,GAAG,IAAII,kDAAQ,CACzByI,KAAK,CAACH,MAAM,CAACzI,CAAC,GAAG4I,KAAK,CAAC5H,MAAM,CAAChB,CAAC,EAC/B4I,KAAK,CAACH,MAAM,CAACxI,CAAC,GAAG2I,KAAK,CAAC5H,MAAM,CAACf,CAAC,CAC/B;EACD2I,KAAK,CAACxJ,IAAI,GAAG,IAAIe,kDAAQ,CACxByI,KAAK,CAAC7I,KAAK,CAACC,CAAC,GAAGf,KAAK,EACrB2J,KAAK,CAAC7I,KAAK,CAACE,CAAC,GAAGhB,KAAK,CACrB;;EAED;EACA,IAAGsJ,YAAY,CAACzC,MAAM,IAAI,EAAE,EAAE;IAC7B;IACA,IAAMiF,MAAM,GAAGrG,QAAQ,CAACwE,cAAc,CAACX,YAAY,CAACzC,MAAM,CAAC;IAC3D,IAAMkF,UAAU,GAAGD,MAAM,CAAC9D,YAAY;IACtC;IACA,IAAMmC,YAAW,GAAG4B,UAAU,CAAC3D,yBAAyB,EAAE;IAC1D;IACA,IAAM4D,QAAQ,GAAG7B,YAAW,CAAC7C,MAAM,EAAE,GAAItH,KAAM;;IAE/C;IACAqB,KAAK,GAAG8I,YAAW,CAACK,mBAAmB,CAAE,CAAC,CAAE;IAC5Cb,KAAK,CAAC5H,MAAM,GAAG,IAAIb,kDAAQ,CAC1BG,KAAK,CAACN,CAAC,EACPM,KAAK,CAACL,CAAC,CACP;IACD,IAAGf,UAAU,EAAE;MACd0J,KAAK,CAACF,KAAK,CAAC9I,IAAI,CAAC,IAAIO,kDAAQ,CAC5BG,KAAK,CAACN,CAAC,EACPM,KAAK,CAACL,CAAC,CACP,CAAC;IACH;IAEA,IAAIF,KAAK,GAAG,CAAC;IACb,KAAI,IAAIyJ,CAAC,GAAC,CAAC,EAAEA,CAAC,IAAEvK,KAAK,EAAEuK,CAAC,EAAE,EAAE;MAE3B,IAAGtK,UAAU,EAAE;QACda,KAAK,IAAIb,UAAU,CAACsK,CAAC,CAAC,GAAGJ,YAAW,CAAC7C,MAAM,EAAE;QAC7C,IAAIjG,KAAK,GAAG8I,YAAW,CAACK,mBAAmB,CAAE1J,KAAK,CAAE;MACrD,CAAC,MAAM;QACN,IAAIO,KAAK,GAAG8I,YAAW,CAACK,mBAAmB,CAAEwB,QAAQ,GAAGzB,CAAC,CAAE;MAE5D;MACAZ,KAAK,CAACF,KAAK,CAAC9I,IAAI,CAAC,IAAIO,kDAAQ,CAC5BG,KAAK,CAACN,CAAC,EACPM,KAAK,CAACL,CAAC,CACP,CAAC;IACH;IAAC;EACF;;EAEA;EACA9B,GAAG,CAAC4B,KAAK,GAAG,IAAII,kDAAQ,CACvBhC,GAAG,CAACsK,MAAM,CAACzI,CAAC,GAAG7B,GAAG,CAACoI,MAAM,CAACvG,CAAC,EAC3B7B,GAAG,CAACsK,MAAM,CAACxI,CAAC,GAAG9B,GAAG,CAACoI,MAAM,CAACtG,CAAC,CAC3B;EACD9B,GAAG,CAACiB,IAAI,GAAG,IAAIe,kDAAQ,CACtBhC,GAAG,CAAC4B,KAAK,CAACC,CAAC,GAAGf,KAAK,EACnBd,GAAG,CAAC4B,KAAK,CAACE,CAAC,GAAGhB,KAAK,CACnB;EACDd,GAAG,CAAC+M,GAAG,GAAG,IAAI/K,kDAAQ,CACrBhC,GAAG,CAACoI,MAAM,CAACvG,CAAC,EACZ7B,GAAG,CAACoI,MAAM,CAACtG,CAAC,CACZ;;EAED;EACA,IAAIiH,IAAI,GAAGC,YAAY,CAACgE,UAAU,EAAE;;EAEpC;EACA,KAAI,IAAIvD,CAAC,GAAG,CAAC,EAAEA,CAAC,IAAI3I,KAAK,EAAE2I,CAAC,EAAE,EAAE;IAE/B;IACA,IAAIwD,SAAS,GAAGjN,GAAG,CAACoI,MAAM,CAACvG,CAAC,GAAG7B,GAAG,CAACoI,MAAM,CAACtG,CAAC,GAAG9B,GAAG,CAACoI,MAAM,CAACvG,CAAC,GAAG7B,GAAG,CAACoI,MAAM,CAACtG,CAAC;IACzE,IAAIoL,KAAK,GAAG,IAAIlL,kDAAQ,CACvBhC,GAAG,CAACoI,MAAM,CAACvG,CAAC,GAAGoL,SAAS,EACxBjN,GAAG,CAACoI,MAAM,CAACtG,CAAC,GAAGmL,SAAS,CACxB;;IAED;IACA,IAAI9M,GAAG,GAAGsJ,CAAC,GAAGrH,KAAK;IACnB,IAAI+K,GAAG,GAAG,IAAInL,kDAAQ,CACrBjC,IAAI,CAAC+C,GAAG,CAAE/C,IAAI,CAACC,GAAG,GAAGG,GAAG,CAAE,GAAGH,GAAG,CAACoI,MAAM,CAACvG,CAAC,EACzC9B,IAAI,CAACuB,GAAG,CAAEvB,IAAI,CAACC,GAAG,GAAGG,GAAG,CAAE,GAAG,CAACH,GAAG,CAACoI,MAAM,CAACtG,CAAC,CAC1C;;IAED;IACAqL,GAAG,CAACjL,GAAG,CAACuI,KAAK,CAAC5H,MAAM,CAAC;IACrBsK,GAAG,CAACvK,MAAM,CAAC6H,KAAK,CAAC5H,MAAM,EAAE,CAAC2H,GAAG,CAACpI,KAAK,CAAC;;IAEpC;IACA,IAAGgI,YAAY,CAACgD,MAAM,EAAE;MACvB;MACA,IAAMC,aAAa,GAAG7C,GAAG,CAACvJ,IAAI,GAAGmB,KAAK;MACtC,IAAIkL,OAAO,GAAGvN,IAAI,CAACwN,GAAG,CAAExN,IAAI,CAACE,EAAE,IAAK,CAAC,IAAI,GAAG,GAAGoN,aAAa,CAAC,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC;MACvE;MACA,IAAIG,QAAQ,GAAGrN,GAAG,GAAG,EAAE;MACvBqN,QAAQ,GAAGzN,IAAI,CAACG,OAAO,CAAEsN,QAAQ,CAAE;MACnC,IAAIC,UAAU,GAAG,IAAIzL,kDAAQ,CAC5BjC,IAAI,CAAC+C,GAAG,CAAE/C,IAAI,CAACC,GAAG,GAAGwN,QAAQ,CAAE,GAAIxN,GAAG,CAACoI,MAAM,CAACvG,CAAE,GAAGyL,OAAO,EAC1DvN,IAAI,CAACuB,GAAG,CAAEvB,IAAI,CAACC,GAAG,GAAGwN,QAAQ,CAAE,GAAI,CAACxN,GAAG,CAACoI,MAAM,CAACtG,CAAE,GAAGwL,OAAO,CAC3D;MACD;MACA,IAAMd,EAAC,GAAGxM,GAAG,CAACoI,MAAM,CAACvG,CAAC;MACtB,IAAM6L,CAAC,GAAG1N,GAAG,CAACoI,MAAM,CAACtG,CAAC;MACtB,IAAMkG,CAAC,GAAM,CAACwE,EAAC,GAAGkB,CAAC,KAAKlB,EAAC,GAAGkB,CAAC,CAAC,IAAK,CAAClB,EAAC,GAAGkB,CAAC,KAAKlB,EAAC,GAAGkB,CAAC,CAAC,CAAC,GAAK,CAAC;MAC3D,IAAIC,aAAa,GAAG5N,IAAI,CAACE,EAAE,IAAIuM,EAAC,GAAGkB,CAAC,CAAC,IAAK,CAAC,GAAK1F,CAAC,IAAK,EAAE,GAAGjI,IAAI,CAAC2C,IAAI,CAAE,CAAC,GAAGsF,CAAC,CAAE,CAAG,CAAE;MAClF,IAAG4F,KAAK,CAACD,aAAa,CAAC,EAAEA,aAAa,GAAG,CAAC;MAC1C,IAAME,OAAO,GAAG9N,IAAI,CAAC2C,IAAI,CAAG+K,UAAU,CAAC5L,CAAC,GAAG4L,UAAU,CAAC5L,CAAC,GAAK4L,UAAU,CAAC3L,CAAC,GAAG2L,UAAU,CAAC3L,CAAE,CAAE;MAC1F,IAAMgM,UAAU,GAAG1D,YAAY,CAACM,KAAK,GAAGN,YAAY,CAACqC,SAAS,GAAG,GAAG,GAAG,CAAC,GAAG;MAC3E,IAAMsB,aAAa,GAAGjN,KAAK,GAAG0J,GAAG,CAACvJ,IAAI;MACtC,IAAM+M,gBAAgB,GAAGF,UAAU,GAAGC,aAAa;MACnD,IAAME,cAAc,GAAGH,UAAU,GAAGE,gBAAgB;MACpD,IAAME,UAAU,GAAGP,aAAa,GAAGE,OAAO,IAAIF,aAAa,GAAGvD,YAAY,CAAChJ,MAAM,CAAC,GAAG6M,cAAc,GAAG,CAAC;;MAEvG;MACA,IAAIE,UAAU,GAAG,IAAInM,kDAAQ,CAAC,CAAC,EAAC,CAAC,CAAC;MAClC,IAAGyI,KAAK,CAACF,KAAK,CAACnC,MAAM,EAAE;QACtB,IAAIqB,CAAC,IAAI1J,IAAI,CAACgM,KAAK,CAACjL,KAAK,CAAC,EAAG;UAC5BqN,UAAU,GAAG,IAAInM,kDAAQ,CACxB,CAACyI,KAAK,CAACF,KAAK,CAACd,CAAC,GAAC,CAAC,CAAC,CAAC5H,CAAC,GAAG4I,KAAK,CAACF,KAAK,CAACd,CAAC,CAAC,CAAC5H,CAAC,IAAIqM,UAAU,EACpD,CAACzD,KAAK,CAACF,KAAK,CAACd,CAAC,GAAC,CAAC,CAAC,CAAC3H,CAAC,GAAG2I,KAAK,CAACF,KAAK,CAACd,CAAC,CAAC,CAAC3H,CAAC,IAAIoM,UAAU,CACpD;QACF,CAAC,MAAM;UAAE;UACRC,UAAU,GAAG,IAAInM,kDAAQ,CACxB,CAACyI,KAAK,CAACF,KAAK,CAACd,CAAC,CAAC,CAAC5H,CAAC,GAAG4I,KAAK,CAACF,KAAK,CAACd,CAAC,GAAC,CAAC,CAAC,CAAC5H,CAAC,IAAIqM,UAAU,EACpD,CAACzD,KAAK,CAACF,KAAK,CAACd,CAAC,CAAC,CAAC3H,CAAC,GAAG2I,KAAK,CAACF,KAAK,CAACd,CAAC,GAAC,CAAC,CAAC,CAAC3H,CAAC,IAAIoM,UAAU,CACpD;QACF;MACD,CAAC,MAAM;QACN,IAAGnN,UAAU,EAAE;UACdoN,UAAU,GAAG,IAAInM,kDAAQ,CACxBjB,UAAU,CAAC0I,CAAC,CAAC,GAAGgB,KAAK,CAAC7I,KAAK,CAACC,CAAC,GAAGqM,UAAU,EAC1CnN,UAAU,CAAC0I,CAAC,CAAC,GAAGgB,KAAK,CAAC7I,KAAK,CAACE,CAAC,GAAGoM,UAAU,CAC1C;QACF,CAAC,MAAM;UACNC,UAAU,GAAG,IAAInM,kDAAQ,CACxByI,KAAK,CAACxJ,IAAI,CAACY,CAAC,GAAGqM,UAAU,EACzBzD,KAAK,CAACxJ,IAAI,CAACa,CAAC,GAAGoM,UAAU,CACzB;QACF;MACD;MACAC,UAAU,CAACvL,MAAM,CAAC,IAAIZ,kDAAQ,EAAE,EAAEwI,GAAG,CAACpI,KAAK,CAAC;MAC5C;MACAqL,UAAU,CAACvL,GAAG,CAACiM,UAAU,CAAC;;MAE1B;MACA,IAAIC,cAAc,GAAG,IAAIpM,kDAAQ,CAChCmL,GAAG,CAACtL,CAAC;MAAC;MACNsL,GAAG,CAACrL,CAAC;MAAA,CACL;;MACDsM,cAAc,CAACrL,SAAS,CAAC0H,KAAK,CAAC5H,MAAM,CAAC;MACtCuL,cAAc,CAACxL,MAAM,CAAC,IAAIZ,kDAAQ,EAAE,EAAEwI,GAAG,CAACpI,KAAK,CAAC;MAChD,IAAMiM,WAAW,GAAGD,cAAc,CAAChM,KAAK,EAAE,CAAC,CAAC;MAC5C;MACA,IAAGpC,GAAG,CAACuK,KAAK,CAACnC,MAAM,EAAE;QACpB,IAAIqB,CAAC,IAAI1J,IAAI,CAACgM,KAAK,CAACjL,KAAK,CAAC,EAAG;UAC5BwN,aAAa,GAAG,IAAItM,kDAAQ,CAC3B,CAAChC,GAAG,CAACuK,KAAK,CAACd,CAAC,CAAC,CAAC5H,CAAC,GAAG7B,GAAG,CAACuK,KAAK,CAACd,CAAC,CAAC,CAAC5H,CAAC,IAAIqM,UAAU,EAC9C,CAAClO,GAAG,CAACuK,KAAK,CAACd,CAAC,CAAC,CAAC3H,CAAC,GAAG9B,GAAG,CAACuK,KAAK,CAACd,CAAC,CAAC,CAAC3H,CAAC,IAAIoM,UAAU,CAC9C;QACF,CAAC,MAAM;UAAE;UACRI,aAAa,GAAG,IAAItM,kDAAQ,CAC3B,CAAChC,GAAG,CAACuK,KAAK,CAACd,CAAC,CAAC,CAAC5H,CAAC,GAAG7B,GAAG,CAACuK,KAAK,CAACd,CAAC,GAAC,CAAC,CAAC,CAAC5H,CAAC,IAAIqM,UAAU,EAChD,CAAClO,GAAG,CAACuK,KAAK,CAACd,CAAC,CAAC,CAAC3H,CAAC,GAAG9B,GAAG,CAACuK,KAAK,CAACd,CAAC,GAAC,CAAC,CAAC,CAAC3H,CAAC,IAAIoM,UAAU,CAChD;QACF;MAED,CAAC,MAAM,IAAGnN,UAAU,EAAE;QACrB,IAAGqJ,YAAY,CAAC/C,IAAI,IAAI,CAAC,IAAI+C,YAAY,CAACmE,MAAM,EAAE;UACjD,IAAG9E,CAAC,GAAI1I,UAAU,CAACqH,MAAM,GAAI,CAAC,EAAE;YAC/B,IAAIoG,CAAC,GAAGzN,UAAU,CAAC0I,CAAC,GAAG,CAAC,CAAC;YACzB,IAAI6E,aAAa,GAAG,IAAItM,kDAAQ,CAC/BjC,IAAI,CAAC+C,GAAG,CAAE/C,IAAI,CAACC,GAAG,GAAGqO,WAAW,CAAE,GAAGG,CAAC,GAAGxO,GAAG,CAAC4B,KAAK,CAACC,CAAC,GAAG,CAAC,GAAGqM,UAAU,EACrEnO,IAAI,CAACuB,GAAG,CAAEvB,IAAI,CAACC,GAAG,GAAGqO,WAAW,CAAE,GAAGG,CAAC,GAAG,CAACxO,GAAG,CAAC4B,KAAK,CAACE,CAAC,GAAG,CAAC,GAAGoM,UAAU,CACtE;UACF,CAAC,MAAM;YACN,IAAIM,EAAC,GAAGzN,UAAU,CAAC,CAACA,UAAU,CAACqH,MAAM,GAAG,CAAC,GAAGqB,CAAC,IAAI,CAAC,CAAC;YACnD,IAAI6E,aAAa,GAAG,IAAItM,kDAAQ,CAC/BjC,IAAI,CAAC+C,GAAG,CAAE/C,IAAI,CAACC,GAAG,GAAGqO,WAAW,CAAE,GAAG,EAAEG,EAAC,GAAGxO,GAAG,CAAC4B,KAAK,CAACC,CAAC,GAAG,CAAC,CAAC,GAAGqM,UAAU,EACxEnO,IAAI,CAACuB,GAAG,CAAEvB,IAAI,CAACC,GAAG,GAAGqO,WAAW,CAAE,GAAG,EAAEG,EAAC,GAAG,CAACxO,GAAG,CAAC4B,KAAK,CAACE,CAAC,GAAG,CAAC,CAAC,GAAGoM,UAAU,CACzE;UACF;QACD,CAAC,MAAM;UACN,IAAIM,GAAC,GAAGzN,UAAU,CAAC0I,CAAC,CAAC;UACrB,IAAG,CAAC+E,GAAC,EAAEA,GAAC,GAAGzN,UAAU,CAAC0I,CAAC,GAAC,CAAC,CAAC;UAC1B,IAAI6E,aAAa,GAAG,IAAItM,kDAAQ,CAC/BjC,IAAI,CAAC+C,GAAG,CAAE/C,IAAI,CAACC,GAAG,GAAGqO,WAAW,CAAE,GAAGG,GAAC,GAAGxO,GAAG,CAAC4B,KAAK,CAACC,CAAC,GAAGqM,UAAU,EACjEnO,IAAI,CAACuB,GAAG,CAAEvB,IAAI,CAACC,GAAG,GAAGqO,WAAW,CAAE,GAAGG,GAAC,GAAG,CAACxO,GAAG,CAAC4B,KAAK,CAACE,CAAC,GAAGoM,UAAU,CAClE;QACF;MAED,CAAC,MAAM;QACN,IAAG9D,YAAY,CAACmE,MAAM,EAAE;UACvB,IAAG9E,CAAC,GAAG3I,KAAK,GAAG,CAAC,EAAE;YACjB,IAAIwN,aAAa,GAAG,IAAItM,kDAAQ,CAC/BjC,IAAI,CAAC+C,GAAG,CAAE/C,IAAI,CAACC,GAAG,GAAGqO,WAAW,CAAE,GAAGrO,GAAG,CAACiB,IAAI,CAACY,CAAC,GAAG,CAAC,GAAGqM,UAAU,EAChEnO,IAAI,CAACuB,GAAG,CAAEvB,IAAI,CAACC,GAAG,GAAGqO,WAAW,CAAE,GAAG,CAACrO,GAAG,CAACiB,IAAI,CAACa,CAAC,GAAG,CAAC,GAAGoM,UAAU,CACjE;UACF,CAAC,MAAM;YACN,IAAII,aAAa,GAAG,IAAItM,kDAAQ,CAC/BjC,IAAI,CAAC+C,GAAG,CAAE/C,IAAI,CAACC,GAAG,GAAGqO,WAAW,CAAE,GAAGrO,GAAG,CAACiB,IAAI,CAACY,CAAC,GAAG,CAAC,CAAC,GAAGqM,UAAU,EACjEnO,IAAI,CAACuB,GAAG,CAAEvB,IAAI,CAACC,GAAG,GAAGqO,WAAW,CAAE,GAAG,CAACrO,GAAG,CAACiB,IAAI,CAACa,CAAC,GAAG,CAAC,CAAC,GAAGoM,UAAU,CAClE;UACF;QACD,CAAC,MAAM;UACN,IAAII,aAAa,GAAG,IAAItM,kDAAQ,CAC/BjC,IAAI,CAAC+C,GAAG,CAAE/C,IAAI,CAACC,GAAG,GAAGqO,WAAW,CAAE,GAAGrO,GAAG,CAACiB,IAAI,CAACY,CAAC,GAAGqM,UAAU,EAC5DnO,IAAI,CAACuB,GAAG,CAAEvB,IAAI,CAACC,GAAG,GAAGqO,WAAW,CAAE,GAAG,CAACrO,GAAG,CAACiB,IAAI,CAACa,CAAC,GAAGoM,UAAU,CAC7D;QACF;MAED;MACA;MACAT,UAAU,CAACvL,GAAG,CAACoM,aAAa,CAAC;;MAE7B;MACAb,UAAU,CAAC5L,CAAC,IAAIuI,YAAY,CAACgD,MAAM;MACnCK,UAAU,CAAC3L,CAAC,IAAIsI,YAAY,CAACgD,MAAM;;MAEnC;MACA,IAAIqB,WAAW,GAAG,IAAIzM,kDAAQ,CAC7ByL,UAAU,CAAC5L,CAAC,EACZ4L,UAAU,CAAC3L,CAAC,CACZ;;MAED;MACA2L,UAAU,CAACvL,GAAG,CAACiL,GAAG,CAAC;MACnBM,UAAU,CAAC7K,MAAM,CAACuK,GAAG,EAAE,CAAC3C,GAAG,CAACpI,KAAK,GAAG,GAAG,CAAC;IAEzC,CAAC,MAAM;MACNsM,UAAU,GAAGvB,GAAG;MAChBM,UAAU,GAAGN,GAAG;MAChBsB,WAAW,GAAGtB,GAAG;IAClB;;IAEA;IACA,IAAG,CAAC1D,CAAC,EAAE;MACN;MACAV,IAAI,CAAC4F,WAAW,CAACC,WAAW,CAACzB,GAAG,CAACtL,CAAC,EAAEsL,GAAG,CAACrL,CAAC,CAAC,CAAC;IAE5C,CAAC,MAAM;MACN;MACA;MACAiH,IAAI,CAAC8F,wCAAwC,CAACD,WAAW,CAAEzB,GAAG,CAACtL,CAAC,EAAEsL,GAAG,CAACrL,CAAC,CAAE,EAAE8M,WAAW,CAAEF,UAAU,CAAC7M,CAAC,EAAE6M,UAAU,CAAC5M,CAAC,CAAE,EAAE8M,WAAW,CAAEnB,UAAU,CAAC5L,CAAC,EAAE4L,UAAU,CAAC3L,CAAC,CAAE,CAAC;IACjK;;IAEA;IACA,IAAI4M,UAAU,GAAG,IAAI1M,kDAAQ,CAC5ByM,WAAW,CAAC5M,CAAC,EACb4M,WAAW,CAAC3M,CAAC,CACb;IAED,IAAI2I,KAAK,CAACF,KAAK,CAACnC,MAAM,IAAI,CAACqB,CAAC,EAAG,CAAE;MAChC;IAAA;IAGDiF,UAAU,CAACxM,GAAG,CAACiL,GAAG,CAAC;IACnBuB,UAAU,CAAC9L,MAAM,CAACuK,GAAG,EAAE,CAAC3C,GAAG,CAACpI,KAAK,CAAC,CAAC,CAAC;;IAEpC;IACAoI,GAAG,CAACpI,KAAK,IAAIoI,GAAG,CAACvJ,IAAI;IACrB,IAAGwJ,KAAK,CAACF,KAAK,CAACnC,MAAM,EAAE;MACtB,IAAIqB,CAAC,IAAI1J,IAAI,CAACgM,KAAK,CAACjL,KAAK,CAAC,EAAG;QAC5B2J,KAAK,CAAC5H,MAAM,GAAG,IAAIb,kDAAQ,CAC1ByI,KAAK,CAACF,KAAK,CAACd,CAAC,GAAC,CAAC,CAAC,CAAC5H,CAAC,EAClB4I,KAAK,CAACF,KAAK,CAACd,CAAC,GAAC,CAAC,CAAC,CAAC3H,CAAC,CAClB;MACF;IACD,CAAC,MAAM;MACN,IAAGf,UAAU,EAAE;QACd,IAAGqJ,YAAY,CAAC/C,IAAI,IAAI,CAAC,IAAI+C,YAAY,CAACmE,MAAM,EAAE;UACjD9D,KAAK,CAAC5H,MAAM,CAAChB,CAAC,IAAId,UAAU,CAAC0I,CAAC,CAAC,GAAGgB,KAAK,CAAC7I,KAAK,CAACC,CAAC;UAC/C4I,KAAK,CAAC5H,MAAM,CAACf,CAAC,IAAIf,UAAU,CAAC0I,CAAC,CAAC,GAAGgB,KAAK,CAAC7I,KAAK,CAACE,CAAC;QAChD,CAAC,MAAM;UACN2I,KAAK,CAAC5H,MAAM,CAAChB,CAAC,IAAId,UAAU,CAAC0I,CAAC,CAAC,GAAGgB,KAAK,CAAC7I,KAAK,CAACC,CAAC;UAC/C4I,KAAK,CAAC5H,MAAM,CAACf,CAAC,IAAIf,UAAU,CAAC0I,CAAC,CAAC,GAAGgB,KAAK,CAAC7I,KAAK,CAACE,CAAC;QAChD;MACD,CAAC,MAAM;QACN2I,KAAK,CAAC5H,MAAM,CAACX,GAAG,CAACuI,KAAK,CAACxJ,IAAI,CAAC;MAC7B;IACD;IACA,IAAGjB,GAAG,CAACuK,KAAK,CAACnC,MAAM,EAAE;MACpB,IAAIqB,CAAC,IAAI1J,IAAI,CAACgM,KAAK,CAACjL,KAAK,CAAC,EAAG;QAC5Bd,GAAG,CAACoI,MAAM,GAAG,IAAIpG,kDAAQ,CACxBhC,GAAG,CAACuK,KAAK,CAACd,CAAC,GAAC,CAAC,CAAC,CAAC5H,CAAC,EAChB7B,GAAG,CAACuK,KAAK,CAACd,CAAC,GAAC,CAAC,CAAC,CAAC3H,CAAC,CAChB;MACF;IACD,CAAC,MAAM;MACN,IAAGf,UAAU,EAAE;QACd,IAAGqJ,YAAY,CAAC/C,IAAI,IAAI,CAAC,IAAI+C,YAAY,CAACmE,MAAM,EAAE;UAAC;UAClD,IAAG9E,CAAC,GAAI1I,UAAU,CAACqH,MAAM,GAAI,CAAC,EAAE;YAC/B,IAAIoG,GAAC,GAAGzN,UAAU,CAAC0I,CAAC,GAAG,CAAC,CAAC;YACzBzJ,GAAG,CAACoI,MAAM,CAACvG,CAAC,IAAI2M,GAAC,GAAGxO,GAAG,CAAC4B,KAAK,CAACC,CAAC,GAAG,CAAC;YACnC7B,GAAG,CAACoI,MAAM,CAACtG,CAAC,IAAI0M,GAAC,GAAGxO,GAAG,CAAC4B,KAAK,CAACE,CAAC,GAAG,CAAC;UACpC,CAAC,MAAM;YACN,IAAI0M,GAAC,GAAGzN,UAAU,CAAC,CAACA,UAAU,CAACqH,MAAM,GAAG,CAAC,GAAGqB,CAAC,IAAI,CAAC,CAAC;YACnDzJ,GAAG,CAACoI,MAAM,CAACvG,CAAC,IAAI2M,GAAC,GAAGxO,GAAG,CAAC4B,KAAK,CAACC,CAAC,GAAG,CAAC;YACnC7B,GAAG,CAACoI,MAAM,CAACtG,CAAC,IAAI0M,GAAC,GAAGxO,GAAG,CAAC4B,KAAK,CAACE,CAAC,GAAG,CAAC;UACpC;QACD,CAAC,MAAM;UACN,IAAI0M,GAAC,GAAGzN,UAAU,CAAC0I,CAAC,CAAC;UACrBzJ,GAAG,CAACoI,MAAM,CAACvG,CAAC,IAAI2M,GAAC,GAAGxO,GAAG,CAAC4B,KAAK,CAACC,CAAC;UAC/B7B,GAAG,CAACoI,MAAM,CAACtG,CAAC,IAAI0M,GAAC,GAAGxO,GAAG,CAAC4B,KAAK,CAACE,CAAC;QAChC;MACD,CAAC,MAAM;QACN,IAAGsI,YAAY,CAACmE,MAAM,EAAE;UACvB,IAAG9E,CAAC,GAAG3I,KAAK,GAAG,CAAC,EAAE;YACjBd,GAAG,CAACoI,MAAM,CAACvG,CAAC,IAAI7B,GAAG,CAACiB,IAAI,CAACY,CAAC,GAAG,CAAC;YAC9B7B,GAAG,CAACoI,MAAM,CAACtG,CAAC,IAAI9B,GAAG,CAACiB,IAAI,CAACa,CAAC,GAAG,CAAC;UAC/B,CAAC,MAAM;YACN9B,GAAG,CAACoI,MAAM,CAACvG,CAAC,IAAI7B,GAAG,CAACiB,IAAI,CAACY,CAAC,GAAG,CAAC;YAC9B7B,GAAG,CAACoI,MAAM,CAACtG,CAAC,IAAI9B,GAAG,CAACiB,IAAI,CAACa,CAAC,GAAG,CAAC;UAC/B;QACD,CAAC,MAAM;UACN9B,GAAG,CAACoI,MAAM,CAACvG,CAAC,IAAI7B,GAAG,CAACiB,IAAI,CAACY,CAAC;UAC1B7B,GAAG,CAACoI,MAAM,CAACtG,CAAC,IAAI9B,GAAG,CAACiB,IAAI,CAACa,CAAC;QAC3B;MACD;IACD;IACA,IAAG9B,GAAG,CAACoI,MAAM,CAACvG,CAAC,IAAI,CAAC,IAAI7B,GAAG,CAACoI,MAAM,CAACtG,CAAC,IAAI,CAAC,EAAE;MAC1C9B,GAAG,CAACoI,MAAM,CAACvG,CAAC,GAAG,MAAM;MACrB7B,GAAG,CAACoI,MAAM,CAACtG,CAAC,GAAG,MAAM;IACtB;EAED;;EAEA;EACA,IAAIwF,KAAK,GAAGwH,gBAAgB,CAACC,aAAa,CAACC,MAAM,CAACC,kBAAkB,CAAClG,IAAI,CAAC,CAAC;EAC3E,IAAImG,MAAM,GAAG5H,KAAK,CAAC6H,KAAK,EAAE,CAACC,kBAAkB,CAAC,CAAC,CAAC;EAChD;EACAF,MAAM,CAACG,SAAS,GAAG,CAAC;EACpB/H,KAAK,CAAC6H,KAAK,EAAE,CAACG,aAAa,EAAE,CAACC,eAAe,CAAC,CAAC,CAAC;EAChD;EACArM,QAAQ,CAACsM,qBAAqB,CAAClI,KAAK,EAAEjE,uBAAuB,EAAE,QAAQ,CAAC;;EAExE;EACA,IAAIoM,YAAY,GAAGvM,QAAQ,CAACoD,aAAa,CAACjD,uBAAuB,CAAC;EAClE,IAAGoM,YAAY,EAAE;IAChB,IAAIC,WAAW,GAAGnJ,QAAQ,CAACwE,cAAc,CAAC0E,YAAY,CAAC;IACvDC,WAAW,CAACC,MAAM,EAAE;EACrB;;EAEA;EACAzM,QAAQ,CAACwB,gBAAgB,CAACrB,uBAAuB,EAAEiE,KAAK,CAACsI,QAAQ,EAAE,CAAC;EAEpE,IAAGxF,YAAY,CAACxC,QAAQ,IAAI,EAAE,EAAE;IAC/B;IACA,IAAIe,MAAM,GAAGpC,QAAQ,CAACwE,cAAc,CAACX,YAAY,CAACxC,QAAQ,CAAC;IAC3D;IACAe,MAAM,GAAGA,MAAM,CAACG,YAAY;IAC5BH,MAAM,CAACkH,SAAS,CAAC,CAACvI,KAAK,CAAC,CAAC;EAC1B,CAAC,MAAM;IACN;IACAf,QAAQ,GAAGA,QAAQ,CAACuC,YAAY;IAChCvC,QAAQ,CAACuJ,WAAW,EAAE,CAACD,SAAS,CAAC,CAACvI,KAAK,CAAC,CAAC;EAC1C;AACD;;AAEA;AACA;AACA;AACA;AACA;;AAEA,SAAS7B,cAAc,CAACwE,IAAI,EAAE;EAE7B;EACA,IAAI1D,QAAQ,GAAGvD,MAAM,CAACwD,mBAAmB,EAAE;;EAE3C;EACA,IAAI4D,YAAY,GAAGH,IAAI,CAACI,QAAQ;;EAEhC;EACA,IAAGD,YAAY,CAACzC,MAAM,IAAI,EAAE,EAAE;IAC7B,IAAIoI,MAAM,GAAGxJ,QAAQ,CAACwE,cAAc,CAACX,YAAY,CAACzC,MAAM,CAAC;IACzDoI,MAAM,CAACJ,MAAM,EAAE;EAChB;EACA,IAAGvF,YAAY,CAAC3C,OAAO,IAAI,EAAE,EAAE;IAC9B,IAAIA,OAAO,GAAGlB,QAAQ,CAACwE,cAAc,CAACX,YAAY,CAAC3C,OAAO,CAAC;IAC3DA,OAAO,CAACkI,MAAM,EAAE;EACjB;EACA,IAAGvF,YAAY,CAAC1C,KAAK,IAAI,EAAE,EAAE;IAC5B,IAAIA,KAAK,GAAGnB,QAAQ,CAACwE,cAAc,CAACX,YAAY,CAAC1C,KAAK,CAAC;IACvDA,KAAK,CAACiI,MAAM,EAAE;EACf;AACD,C;;;;;;;;;;;ACp/BA,mC;;;;;;;;;;;ACAA,mC;;;;;;;;;;;ACAA,4C;;;;;;;;;;;ACAA,sC","file":"__ddSpiral.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/ddSpiral.js\");\n","/* from https://github.com/taylorhakes/promise-polyfill */\n\nfunction promiseFinally(callback) {\n  var constructor = this.constructor;\n  return this.then(\n    function(value) {\n      return constructor.resolve(callback()).then(function() {\n        return value;\n      });\n    },\n    function(reason) {\n      return constructor.resolve(callback()).then(function() {\n        return constructor.reject(reason);\n      });\n    }\n  );\n}\n\nfunction noop() {}\n\n/**\n * @constructor\n * @param {Function} fn\n */\nfunction Promise(fn) {\n  if (!(this instanceof Promise))\n    throw new TypeError(\"Promises must be constructed via new\");\n  if (typeof fn !== \"function\") throw new TypeError(\"not a function\");\n  /** @type {!number} */\n  this._state = 0;\n  /** @type {!boolean} */\n  this._handled = false;\n  /** @type {Promise|undefined} */\n  this._value = undefined;\n  /** @type {!Array<!Function>} */\n  this._deferreds = [];\n\n  doResolve(fn, this);\n}\n\nfunction handle(self, deferred) {\n  while (self._state === 3) {\n    self = self._value;\n  }\n  if (self._state === 0) {\n    self._deferreds.push(deferred);\n    return;\n  }\n  self._handled = true;\n  Promise._immediateFn(function() {\n    var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n    if (cb === null) {\n      (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n      return;\n    }\n    var ret;\n    try {\n      ret = cb(self._value);\n    } catch (e) {\n      reject(deferred.promise, e);\n      return;\n    }\n    resolve(deferred.promise, ret);\n  });\n}\n\nfunction resolve(self, newValue) {\n  try {\n    // Promise Resolution Procedure: https://github.com/promises-aplus/promises-spec#the-promise-resolution-procedure\n    if (newValue === self)\n      throw new TypeError(\"A promise cannot be resolved with itself.\");\n    if (\n      newValue &&\n      (typeof newValue === \"object\" || typeof newValue === \"function\")\n    ) {\n      var then = newValue.then;\n      if (newValue instanceof Promise) {\n        self._state = 3;\n        self._value = newValue;\n        finale(self);\n        return;\n      } else if (typeof then === \"function\") {\n        doResolve(then.bind(newValue), self);\n        return;\n      }\n    }\n    self._state = 1;\n    self._value = newValue;\n    finale(self);\n  } catch (e) {\n    reject(self, e);\n  }\n}\n\nfunction reject(self, newValue) {\n  self._state = 2;\n  self._value = newValue;\n  finale(self);\n}\n\nfunction finale(self) {\n  if (self._state === 2 && self._deferreds.length === 0) {\n    Promise._immediateFn(function() {\n      if (!self._handled) {\n        Promise._unhandledRejectionFn(self._value, self);\n      }\n    });\n  }\n\n  for (var i = 0, len = self._deferreds.length; i < len; i++) {\n    handle(self, self._deferreds[i]);\n  }\n  self._deferreds = null;\n}\n\n/**\n * @constructor\n */\nfunction Handler(onFulfilled, onRejected, promise) {\n  this.onFulfilled = typeof onFulfilled === \"function\" ? onFulfilled : null;\n  this.onRejected = typeof onRejected === \"function\" ? onRejected : null;\n  this.promise = promise;\n}\n\n/**\n * Take a potentially misbehaving resolver function and make sure\n * onFulfilled and onRejected are only called once.\n *\n * Makes no guarantees about asynchrony.\n */\nfunction doResolve(fn, self) {\n  var done = false;\n  try {\n    fn(\n      function(value) {\n        if (done) {\n          Promise._multipleResolvesFn(\"resolve\", self, value);\n          return;\n        }\n        done = true;\n        resolve(self, value);\n      },\n      function(reason) {\n        if (done) {\n          Promise._multipleResolvesFn(\"reject\", self, reason);\n          return;\n        }\n        done = true;\n        reject(self, reason);\n      }\n    );\n  } catch (ex) {\n    if (done) {\n      Promise._multipleResolvesFn(\"reject\", self, ex);\n      return;\n    }\n    done = true;\n    reject(self, ex);\n  }\n}\n\nPromise.prototype[\"catch\"] = function(onRejected) {\n  return this.then(null, onRejected);\n};\n\nPromise.prototype.then = function(onFulfilled, onRejected) {\n  // @ts-ignore\n  var prom = new this.constructor(noop);\n\n  handle(this, new Handler(onFulfilled, onRejected, prom));\n  return prom;\n};\n\nPromise.prototype[\"finally\"] = promiseFinally;\n\nPromise.all = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!Array.isArray(arr)) {\n      return reject(new TypeError(\"Promise.all accepts an array\"));\n    }\n\n    var args = Array.prototype.slice.call(arr);\n    if (args.length === 0) return resolve([]);\n    var remaining = args.length;\n\n    function res(i, val) {\n      try {\n        if (val && (typeof val === \"object\" || typeof val === \"function\")) {\n          var then = val.then;\n          if (typeof then === \"function\") {\n            then.call(\n              val,\n              function(val) {\n                res(i, val);\n              },\n              reject\n            );\n            return;\n          }\n        }\n        args[i] = val;\n        if (--remaining === 0) {\n          resolve(args);\n        }\n      } catch (ex) {\n        reject(ex);\n      }\n    }\n\n    for (var i = 0; i < args.length; i++) {\n      res(i, args[i]);\n    }\n  });\n};\n\nPromise.resolve = function(value) {\n  if (value && typeof value === \"object\" && value.constructor === Promise) {\n    return value;\n  }\n\n  return new Promise(function(resolve) {\n    resolve(value);\n  });\n};\n\nPromise.reject = function(value) {\n  return new Promise(function(resolve, reject) {\n    reject(value);\n  });\n};\n\nPromise.race = function(arr) {\n  return new Promise(function(resolve, reject) {\n    if (!Array.isArray(arr)) {\n      return reject(new TypeError(\"Promise.race accepts an array\"));\n    }\n\n    for (var i = 0, len = arr.length; i < len; i++) {\n      Promise.resolve(arr[i]).then(resolve, reject);\n    }\n  });\n};\n\n// Use polyfill for setImmediate for performance gains\nPromise._immediateFn = setImmediate;\n\nPromise._unhandledRejectionFn = function _unhandledRejectionFn(err, promise) {\n  if (\n    typeof process !== \"undefined\" &&\n    process.listenerCount &&\n    (process.listenerCount(\"unhandledRejection\") ||\n      process.listenerCount(\"uncaughtException\"))\n  ) {\n    process.emit(\"unhandledRejection\", err, promise);\n    process.emit(\"uncaughtException\", err, \"unhandledRejection\");\n  } else if (typeof console !== \"undefined\" && console) {\n    console.warn(\"Possible Unhandled Promise Rejection:\", err);\n  }\n};\n\nPromise._multipleResolvesFn = function _multipleResolvesFn(\n  type,\n  promise,\n  value\n) {\n  if (typeof process !== \"undefined\" && process.emit) {\n    process.emit(\"multipleResolves\", type, promise, value);\n  }\n};\n\nmodule.exports = Promise;\n","/* globals MOClassDescription, NSObject, NSSelectorFromString, NSClassFromString, MOPropertyDescription */\n\nmodule.exports = function MochaDelegate(definition, superclass) {\n  var uniqueClassName =\n    'MochaJSDelegate_DynamicClass_' + NSUUID.UUID().UUIDString()\n\n  var delegateClassDesc = MOClassDescription.allocateDescriptionForClassWithName_superclass_(\n    uniqueClassName,\n    superclass || NSObject\n  )\n\n  // Storage\n  var handlers = {}\n  var ivars = {}\n\n  // Define an instance method\n  function setHandlerForSelector(selectorString, func) {\n    var handlerHasBeenSet = selectorString in handlers\n    var selector = NSSelectorFromString(selectorString)\n\n    handlers[selectorString] = func\n\n    /*\n      For some reason, Mocha acts weird about arguments: https://github.com/logancollins/Mocha/issues/28\n      We have to basically create a dynamic handler with a likewise dynamic number of predefined arguments.\n    */\n    if (!handlerHasBeenSet) {\n      var args = []\n      var regex = /:/g\n      while (regex.exec(selectorString)) {\n        args.push('arg' + args.length)\n      }\n\n      // eslint-disable-next-line no-eval\n      var dynamicFunction = eval(\n        '(function (' +\n          args.join(', ') +\n          ') { return handlers[selectorString].apply(this, arguments); })'\n      )\n\n      delegateClassDesc.addInstanceMethodWithSelector_function(\n        selector,\n        dynamicFunction\n      )\n    }\n  }\n\n  // define a property\n  function setIvar(key, value) {\n    var ivarHasBeenSet = key in handlers\n\n    ivars[key] = value\n\n    if (!ivarHasBeenSet) {\n      delegateClassDesc.addInstanceVariableWithName_typeEncoding(key, '@')\n      var description = MOPropertyDescription.new()\n      description.name = key\n      description.typeEncoding = '@'\n      description.weak = true\n      description.ivarName = key\n      delegateClassDesc.addProperty(description)\n    }\n  }\n\n  this.getClass = function() {\n    return NSClassFromString(uniqueClassName)\n  }\n\n  this.getClassInstance = function(instanceVariables) {\n    var instance = NSClassFromString(uniqueClassName).new()\n    Object.keys(ivars).forEach(function(key) {\n      instance[key] = ivars[key]\n    })\n    Object.keys(instanceVariables || {}).forEach(function(key) {\n      instance[key] = instanceVariables[key]\n    })\n    return instance\n  }\n  // alias\n  this.new = this.getClassInstance\n\n  // Convenience\n  if (typeof definition === 'object') {\n    Object.keys(definition).forEach(\n      function(key) {\n        if (typeof definition[key] === 'function') {\n          setHandlerForSelector(key, definition[key])\n        } else {\n          setIvar(key, definition[key])\n        }\n      }\n    )\n  }\n\n  delegateClassDesc.registerClass()\n}\n","function parseHexColor(color) {\n  // Check the string for incorrect formatting.\n  if (!color || color[0] !== '#') {\n    if (\n      color &&\n      typeof color.isKindOfClass === 'function' &&\n      color.isKindOfClass(NSColor)\n    ) {\n      return color\n    }\n    throw new Error(\n      'Incorrect color formating. It should be an hex color: #RRGGBBAA'\n    )\n  }\n\n  // append FF if alpha channel is not specified.\n  var source = color.substr(1)\n  if (source.length === 3) {\n    source += 'F'\n  } else if (source.length === 6) {\n    source += 'FF'\n  }\n  // Convert the string from #FFF format to #FFFFFF format.\n  var hex\n  if (source.length === 4) {\n    for (var i = 0; i < 4; i += 1) {\n      hex += source[i]\n      hex += source[i]\n    }\n  } else if (source.length === 8) {\n    hex = source\n  } else {\n    return NSColor.whiteColor()\n  }\n\n  var r = parseInt(hex.slice(0, 2), 16) / 255\n  var g = parseInt(hex.slice(2, 4), 16) / 255\n  var b = parseInt(hex.slice(4, 6), 16) / 255\n  var a = parseInt(hex.slice(6, 8), 16) / 255\n\n  return NSColor.colorWithSRGBRed_green_blue_alpha(r, g, b, a)\n}\n\nmodule.exports = function (browserWindow, panel, webview) {\n  // keep reference to the subviews\n  browserWindow._panel = panel\n  browserWindow._webview = webview\n  browserWindow._destroyed = false\n\n  browserWindow.destroy = function () {\n    return panel.close()\n  }\n\n  browserWindow.close = function () {\n    if (panel.delegate().utils && panel.delegate().utils.parentWindow) {\n      var shouldClose = true\n      browserWindow.emit('close', {\n        get defaultPrevented() {\n          return !shouldClose\n        },\n        preventDefault: function () {\n          shouldClose = false\n        },\n      })\n      if (shouldClose) {\n        panel.delegate().utils.parentWindow.endSheet(panel)\n      }\n      return\n    }\n\n    if (!browserWindow.isClosable()) {\n      return\n    }\n\n    panel.performClose(null)\n  }\n\n  function focus(focused) {\n    if (!browserWindow.isVisible()) {\n      return\n    }\n    if (focused) {\n      NSApplication.sharedApplication().activateIgnoringOtherApps(true)\n      panel.makeKeyAndOrderFront(null)\n    } else {\n      panel.orderBack(null)\n      NSApp.mainWindow().makeKeyAndOrderFront(null)\n    }\n  }\n\n  browserWindow.focus = focus.bind(this, true)\n  browserWindow.blur = focus.bind(this, false)\n\n  browserWindow.isFocused = function () {\n    return panel.isKeyWindow()\n  }\n\n  browserWindow.isDestroyed = function () {\n    return browserWindow._destroyed\n  }\n\n  browserWindow.show = function () {\n    // This method is supposed to put focus on window, however if the app does not\n    // have focus then \"makeKeyAndOrderFront\" will only show the window.\n    NSApp.activateIgnoringOtherApps(true)\n\n    if (panel.delegate().utils && panel.delegate().utils.parentWindow) {\n      return panel.delegate().utils.parentWindow.beginSheet_completionHandler(\n        panel,\n        __mocha__.createBlock_function('v16@?0q8', function () {\n          browserWindow.emit('closed')\n        })\n      )\n    }\n\n    return panel.makeKeyAndOrderFront(null)\n  }\n\n  browserWindow.showInactive = function () {\n    return panel.orderFrontRegardless()\n  }\n\n  browserWindow.hide = function () {\n    return panel.orderOut(null)\n  }\n\n  browserWindow.isVisible = function () {\n    return panel.isVisible()\n  }\n\n  browserWindow.isModal = function () {\n    return false\n  }\n\n  browserWindow.maximize = function () {\n    if (!browserWindow.isMaximized()) {\n      panel.zoom(null)\n    }\n  }\n  browserWindow.unmaximize = function () {\n    if (browserWindow.isMaximized()) {\n      panel.zoom(null)\n    }\n  }\n\n  browserWindow.isMaximized = function () {\n    if ((panel.styleMask() & NSResizableWindowMask) !== 0) {\n      return panel.isZoomed()\n    }\n    var rectScreen = NSScreen.mainScreen().visibleFrame()\n    var rectWindow = panel.frame()\n    return (\n      rectScreen.origin.x == rectWindow.origin.x &&\n      rectScreen.origin.y == rectWindow.origin.y &&\n      rectScreen.size.width == rectWindow.size.width &&\n      rectScreen.size.height == rectWindow.size.height\n    )\n  }\n\n  browserWindow.minimize = function () {\n    return panel.miniaturize(null)\n  }\n\n  browserWindow.restore = function () {\n    return panel.deminiaturize(null)\n  }\n\n  browserWindow.isMinimized = function () {\n    return panel.isMiniaturized()\n  }\n\n  browserWindow.setFullScreen = function (fullscreen) {\n    if (fullscreen !== browserWindow.isFullscreen()) {\n      panel.toggleFullScreen(null)\n    }\n  }\n\n  browserWindow.isFullscreen = function () {\n    return panel.styleMask() & NSFullScreenWindowMask\n  }\n\n  browserWindow.setAspectRatio = function (aspectRatio /* , extraSize */) {\n    // Reset the behaviour to default if aspect_ratio is set to 0 or less.\n    if (aspectRatio > 0.0) {\n      panel.setAspectRatio(NSMakeSize(aspectRatio, 1.0))\n    } else {\n      panel.setResizeIncrements(NSMakeSize(1.0, 1.0))\n    }\n  }\n\n  browserWindow.setBounds = function (bounds, animate) {\n    if (!bounds) {\n      return\n    }\n\n    // Do nothing if in fullscreen mode.\n    if (browserWindow.isFullscreen()) {\n      return\n    }\n\n    const newBounds = Object.assign(browserWindow.getBounds(), bounds)\n\n    // TODO: Check size constraints since setFrame does not check it.\n    // var size = bounds.size\n    // size.SetToMax(GetMinimumSize());\n    // gfx::Size max_size = GetMaximumSize();\n    // if (!max_size.IsEmpty())\n    //   size.SetToMin(max_size);\n\n    var cocoaBounds = NSMakeRect(\n      newBounds.x,\n      0,\n      newBounds.width,\n      newBounds.height\n    )\n    // Flip Y coordinates based on the primary screen\n    var screen = NSScreen.screens().firstObject()\n    cocoaBounds.origin.y = NSHeight(screen.frame()) - newBounds.y\n\n    panel.setFrame_display_animate(cocoaBounds, true, animate)\n  }\n\n  browserWindow.getBounds = function () {\n    const cocoaBounds = panel.frame()\n    var mainScreenRect = NSScreen.screens().firstObject().frame()\n    return {\n      x: cocoaBounds.origin.x,\n      y: Math.round(NSHeight(mainScreenRect) - cocoaBounds.origin.y),\n      width: cocoaBounds.size.width,\n      height: cocoaBounds.size.height,\n    }\n  }\n\n  browserWindow.setContentBounds = function (bounds, animate) {\n    // TODO:\n    browserWindow.setBounds(bounds, animate)\n  }\n\n  browserWindow.getContentBounds = function () {\n    // TODO:\n    return browserWindow.getBounds()\n  }\n\n  browserWindow.setSize = function (width, height, animate) {\n    // TODO: handle resizing around center\n    return browserWindow.setBounds({ width: width, height: height }, animate)\n  }\n\n  browserWindow.getSize = function () {\n    var bounds = browserWindow.getBounds()\n    return [bounds.width, bounds.height]\n  }\n\n  browserWindow.setContentSize = function (width, height, animate) {\n    // TODO: handle resizing around center\n    return browserWindow.setContentBounds(\n      { width: width, height: height },\n      animate\n    )\n  }\n\n  browserWindow.getContentSize = function () {\n    var bounds = browserWindow.getContentBounds()\n    return [bounds.width, bounds.height]\n  }\n\n  browserWindow.setMinimumSize = function (width, height) {\n    const minSize = CGSizeMake(width, height)\n    panel.setContentMinSize(minSize)\n  }\n\n  browserWindow.getMinimumSize = function () {\n    const size = panel.contentMinSize()\n    return [size.width, size.height]\n  }\n\n  browserWindow.setMaximumSize = function (width, height) {\n    const maxSize = CGSizeMake(width, height)\n    panel.setContentMaxSize(maxSize)\n  }\n\n  browserWindow.getMaximumSize = function () {\n    const size = panel.contentMaxSize()\n    return [size.width, size.height]\n  }\n\n  browserWindow.setResizable = function (resizable) {\n    return browserWindow._setStyleMask(resizable, NSResizableWindowMask)\n  }\n\n  browserWindow.isResizable = function () {\n    return panel.styleMask() & NSResizableWindowMask\n  }\n\n  browserWindow.setMovable = function (movable) {\n    return panel.setMovable(movable)\n  }\n  browserWindow.isMovable = function () {\n    return panel.isMovable()\n  }\n\n  browserWindow.setMinimizable = function (minimizable) {\n    return browserWindow._setStyleMask(minimizable, NSMiniaturizableWindowMask)\n  }\n\n  browserWindow.isMinimizable = function () {\n    return panel.styleMask() & NSMiniaturizableWindowMask\n  }\n\n  browserWindow.setMaximizable = function (maximizable) {\n    if (panel.standardWindowButton(NSWindowZoomButton)) {\n      panel.standardWindowButton(NSWindowZoomButton).setEnabled(maximizable)\n    }\n  }\n\n  browserWindow.isMaximizable = function () {\n    return (\n      panel.standardWindowButton(NSWindowZoomButton) &&\n      panel.standardWindowButton(NSWindowZoomButton).isEnabled()\n    )\n  }\n\n  browserWindow.setFullScreenable = function (fullscreenable) {\n    browserWindow._setCollectionBehavior(\n      fullscreenable,\n      NSWindowCollectionBehaviorFullScreenPrimary\n    )\n    // On EL Capitan this flag is required to hide fullscreen button.\n    browserWindow._setCollectionBehavior(\n      !fullscreenable,\n      NSWindowCollectionBehaviorFullScreenAuxiliary\n    )\n  }\n\n  browserWindow.isFullScreenable = function () {\n    var collectionBehavior = panel.collectionBehavior()\n    return collectionBehavior & NSWindowCollectionBehaviorFullScreenPrimary\n  }\n\n  browserWindow.setClosable = function (closable) {\n    browserWindow._setStyleMask(closable, NSClosableWindowMask)\n  }\n\n  browserWindow.isClosable = function () {\n    return panel.styleMask() & NSClosableWindowMask\n  }\n\n  browserWindow.setAlwaysOnTop = function (top, level, relativeLevel) {\n    var windowLevel = NSNormalWindowLevel\n    var maxWindowLevel = CGWindowLevelForKey(kCGMaximumWindowLevelKey)\n    var minWindowLevel = CGWindowLevelForKey(kCGMinimumWindowLevelKey)\n\n    if (top) {\n      if (level === 'normal') {\n        windowLevel = NSNormalWindowLevel\n      } else if (level === 'torn-off-menu') {\n        windowLevel = NSTornOffMenuWindowLevel\n      } else if (level === 'modal-panel') {\n        windowLevel = NSModalPanelWindowLevel\n      } else if (level === 'main-menu') {\n        windowLevel = NSMainMenuWindowLevel\n      } else if (level === 'status') {\n        windowLevel = NSStatusWindowLevel\n      } else if (level === 'pop-up-menu') {\n        windowLevel = NSPopUpMenuWindowLevel\n      } else if (level === 'screen-saver') {\n        windowLevel = NSScreenSaverWindowLevel\n      } else if (level === 'dock') {\n        // Deprecated by macOS, but kept for backwards compatibility\n        windowLevel = NSDockWindowLevel\n      } else {\n        windowLevel = NSFloatingWindowLevel\n      }\n    }\n\n    var newLevel = windowLevel + (relativeLevel || 0)\n    if (newLevel >= minWindowLevel && newLevel <= maxWindowLevel) {\n      panel.setLevel(newLevel)\n    } else {\n      throw new Error(\n        'relativeLevel must be between ' +\n          minWindowLevel +\n          ' and ' +\n          maxWindowLevel\n      )\n    }\n  }\n\n  browserWindow.isAlwaysOnTop = function () {\n    return panel.level() !== NSNormalWindowLevel\n  }\n\n  browserWindow.moveTop = function () {\n    return panel.orderFrontRegardless()\n  }\n\n  browserWindow.center = function () {\n    panel.center()\n  }\n\n  browserWindow.setPosition = function (x, y, animate) {\n    return browserWindow.setBounds({ x: x, y: y }, animate)\n  }\n\n  browserWindow.getPosition = function () {\n    var bounds = browserWindow.getBounds()\n    return [bounds.x, bounds.y]\n  }\n\n  browserWindow.setTitle = function (title) {\n    panel.setTitle(title)\n  }\n\n  browserWindow.getTitle = function () {\n    return String(panel.title())\n  }\n\n  var attentionRequestId = 0\n  browserWindow.flashFrame = function (flash) {\n    if (flash) {\n      attentionRequestId = NSApp.requestUserAttention(NSInformationalRequest)\n    } else {\n      NSApp.cancelUserAttentionRequest(attentionRequestId)\n      attentionRequestId = 0\n    }\n  }\n\n  browserWindow.getNativeWindowHandle = function () {\n    return panel\n  }\n\n  browserWindow.getNativeWebViewHandle = function () {\n    return webview\n  }\n\n  browserWindow.loadURL = function (url) {\n    // When frameLocation is a file, prefix it with the Sketch Resources path\n    if (/^(?!https?|file).*\\.html?$/.test(url)) {\n      if (typeof __command !== 'undefined' && __command.pluginBundle()) {\n        url =\n          'file://' + __command.pluginBundle().urlForResourceNamed(url).path()\n      }\n    }\n\n    if (/^file:\\/\\/.*\\.html?$/.test(url)) {\n      // ensure URLs containing spaces are properly handled\n      url = NSString.alloc().initWithString(url)\n      url = url.stringByAddingPercentEncodingWithAllowedCharacters(\n        NSCharacterSet.URLQueryAllowedCharacterSet()\n      )\n      webview.loadFileURL_allowingReadAccessToURL(\n        NSURL.URLWithString(url),\n        NSURL.URLWithString('file:///')\n      )\n      return\n    }\n\n    const properURL = NSURL.URLWithString(url)\n    const urlRequest = NSURLRequest.requestWithURL(properURL)\n\n    webview.loadRequest(urlRequest)\n  }\n\n  browserWindow.reload = function () {\n    webview.reload()\n  }\n\n  browserWindow.setHasShadow = function (hasShadow) {\n    return panel.setHasShadow(hasShadow)\n  }\n\n  browserWindow.hasShadow = function () {\n    return panel.hasShadow()\n  }\n\n  browserWindow.setOpacity = function (opacity) {\n    return panel.setAlphaValue(opacity)\n  }\n\n  browserWindow.getOpacity = function () {\n    return panel.alphaValue()\n  }\n\n  browserWindow.setVisibleOnAllWorkspaces = function (visible) {\n    return browserWindow._setCollectionBehavior(\n      visible,\n      NSWindowCollectionBehaviorCanJoinAllSpaces\n    )\n  }\n\n  browserWindow.isVisibleOnAllWorkspaces = function () {\n    var collectionBehavior = panel.collectionBehavior()\n    return collectionBehavior & NSWindowCollectionBehaviorCanJoinAllSpaces\n  }\n\n  browserWindow.setIgnoreMouseEvents = function (ignore) {\n    return panel.setIgnoresMouseEvents(ignore)\n  }\n\n  browserWindow.setContentProtection = function (enable) {\n    panel.setSharingType(enable ? NSWindowSharingNone : NSWindowSharingReadOnly)\n  }\n\n  browserWindow.setAutoHideCursor = function (autoHide) {\n    panel.setDisableAutoHideCursor(autoHide)\n  }\n\n  browserWindow.setVibrancy = function (type) {\n    var effectView = browserWindow._vibrantView\n\n    if (!type) {\n      if (effectView == null) {\n        return\n      }\n\n      effectView.removeFromSuperview()\n      panel.setVibrantView(null)\n      return\n    }\n\n    if (effectView == null) {\n      var contentView = panel.contentView()\n      effectView = NSVisualEffectView.alloc().initWithFrame(\n        contentView.bounds()\n      )\n      browserWindow._vibrantView = effectView\n\n      effectView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n      effectView.setBlendingMode(NSVisualEffectBlendingModeBehindWindow)\n      effectView.setState(NSVisualEffectStateActive)\n      effectView.setFrame(contentView.bounds())\n      contentView.addSubview_positioned_relativeTo(\n        effectView,\n        NSWindowBelow,\n        null\n      )\n    }\n\n    var vibrancyType = NSVisualEffectMaterialLight\n\n    if (type === 'appearance-based') {\n      vibrancyType = NSVisualEffectMaterialAppearanceBased\n    } else if (type === 'light') {\n      vibrancyType = NSVisualEffectMaterialLight\n    } else if (type === 'dark') {\n      vibrancyType = NSVisualEffectMaterialDark\n    } else if (type === 'titlebar') {\n      vibrancyType = NSVisualEffectMaterialTitlebar\n    } else if (type === 'selection') {\n      vibrancyType = NSVisualEffectMaterialSelection\n    } else if (type === 'menu') {\n      vibrancyType = NSVisualEffectMaterialMenu\n    } else if (type === 'popover') {\n      vibrancyType = NSVisualEffectMaterialPopover\n    } else if (type === 'sidebar') {\n      vibrancyType = NSVisualEffectMaterialSidebar\n    } else if (type === 'medium-light') {\n      vibrancyType = NSVisualEffectMaterialMediumLight\n    } else if (type === 'ultra-dark') {\n      vibrancyType = NSVisualEffectMaterialUltraDark\n    }\n\n    effectView.setMaterial(vibrancyType)\n  }\n\n  browserWindow._setBackgroundColor = function (colorName) {\n    var color = parseHexColor(colorName)\n    webview.setValue_forKey(false, 'drawsBackground')\n    panel.backgroundColor = color\n  }\n\n  browserWindow._invalidate = function () {\n    panel.flushWindow()\n    panel.contentView().setNeedsDisplay(true)\n  }\n\n  browserWindow._setStyleMask = function (on, flag) {\n    var wasMaximizable = browserWindow.isMaximizable()\n    if (on) {\n      panel.setStyleMask(panel.styleMask() | flag)\n    } else {\n      panel.setStyleMask(panel.styleMask() & ~flag)\n    }\n    // Change style mask will make the zoom button revert to default, probably\n    // a bug of Cocoa or macOS.\n    browserWindow.setMaximizable(wasMaximizable)\n  }\n\n  browserWindow._setCollectionBehavior = function (on, flag) {\n    var wasMaximizable = browserWindow.isMaximizable()\n    if (on) {\n      panel.setCollectionBehavior(panel.collectionBehavior() | flag)\n    } else {\n      panel.setCollectionBehavior(panel.collectionBehavior() & ~flag)\n    }\n    // Change collectionBehavior will make the zoom button revert to default,\n    // probably a bug of Cocoa or macOS.\n    browserWindow.setMaximizable(wasMaximizable)\n  }\n\n  browserWindow._showWindowButton = function (button) {\n    var view = panel.standardWindowButton(button)\n    view.superview().addSubview_positioned_relative(view, NSWindowAbove, null)\n  }\n}\n","module.exports = {\n  JS_BRIDGE: '__skpm_sketchBridge',\n  JS_BRIDGE_RESULT_SUCCESS: '__skpm_sketchBridge_success',\n  JS_BRIDGE_RESULT_ERROR: '__skpm_sketchBridge_error',\n  START_MOVING_WINDOW: '__skpm_startMovingWindow',\n  EXECUTE_JAVASCRIPT: '__skpm_executeJS',\n  EXECUTE_JAVASCRIPT_SUCCESS: '__skpm_executeJS_success_',\n  EXECUTE_JAVASCRIPT_ERROR: '__skpm_executeJS_error_',\n}\n","var tagsToFocus =\n  '[\"text\", \"textarea\", \"date\", \"datetime-local\", \"email\", \"number\", \"month\", \"password\", \"search\", \"tel\", \"time\", \"url\", \"week\" ]'\n\nmodule.exports = function (webView, event) {\n  var point = webView.convertPoint_fromView(event.locationInWindow(), null)\n  return (\n    'var el = document.elementFromPoint(' + // get the DOM element that match the event\n    point.x +\n    ', ' +\n    point.y +\n    '); ' +\n    'if (el && el.tagName === \"SELECT\") {' + // select needs special handling\n    '  var event = document.createEvent(\"MouseEvents\");' +\n    '  event.initMouseEvent(\"mousedown\", true, true, window);' +\n    '  el.dispatchEvent(event);' +\n    '} else if (el && ' + // some tags need to be focused instead of clicked\n    tagsToFocus +\n    '.indexOf(el.type) >= 0 && ' +\n    'el.focus' +\n    ') {' +\n    'el.focus();' + // so focus them\n    '} else if (el) {' +\n    'el.dispatchEvent(new Event(\"click\", {bubbles: true}))' + // click the others\n    '}'\n  )\n}\n","var CONSTANTS = require('./constants')\n\nmodule.exports = function (webview, browserWindow) {\n  function executeJavaScript(script, userGesture, callback) {\n    if (typeof userGesture === 'function') {\n      callback = userGesture\n      userGesture = false\n    }\n    var fiber = coscript.createFiber()\n\n    // if the webview is not ready yet, defer the execution until it is\n    if (\n      webview.navigationDelegate().state &&\n      webview.navigationDelegate().state.wasReady == 0\n    ) {\n      return new Promise(function (resolve, reject) {\n        browserWindow.once('ready-to-show', function () {\n          executeJavaScript(script, userGesture, callback)\n            .then(resolve)\n            .catch(reject)\n          fiber.cleanup()\n        })\n      })\n    }\n\n    return new Promise(function (resolve, reject) {\n      var requestId = Math.random()\n\n      browserWindow.webContents.on(\n        CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS + requestId,\n        function (res) {\n          try {\n            if (callback) {\n              callback(null, res)\n            }\n            resolve(res)\n          } catch (err) {\n            reject(err)\n          }\n          fiber.cleanup()\n        }\n      )\n      browserWindow.webContents.on(\n        CONSTANTS.EXECUTE_JAVASCRIPT_ERROR + requestId,\n        function (err) {\n          try {\n            if (callback) {\n              callback(err)\n              resolve()\n            } else {\n              reject(err)\n            }\n          } catch (err2) {\n            reject(err2)\n          }\n          fiber.cleanup()\n        }\n      )\n\n      webview.evaluateJavaScript_completionHandler(\n        module.exports.wrapScript(script, requestId),\n        null\n      )\n    })\n  }\n\n  return executeJavaScript\n}\n\nmodule.exports.wrapScript = function (script, requestId) {\n  return (\n    'window.' +\n    CONSTANTS.EXECUTE_JAVASCRIPT +\n    '(' +\n    requestId +\n    ', ' +\n    JSON.stringify(script) +\n    ')'\n  )\n}\n\nmodule.exports.injectScript = function (webView) {\n  var source =\n    'window.' +\n    CONSTANTS.EXECUTE_JAVASCRIPT +\n    ' = function(id, script) {' +\n    '  try {' +\n    '    var res = eval(script);' +\n    '    if (res && typeof res.then === \"function\" && typeof res.catch === \"function\") {' +\n    '      res.then(function (res2) {' +\n    '        window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS +\n    '\" + id, res2);' +\n    '      })' +\n    '      .catch(function (err) {' +\n    '        window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_ERROR +\n    '\" + id, err);' +\n    '      })' +\n    '    } else {' +\n    '      window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_SUCCESS +\n    '\" + id, res);' +\n    '    }' +\n    '  } catch (err) {' +\n    '    window.postMessage(\"' +\n    CONSTANTS.EXECUTE_JAVASCRIPT_ERROR +\n    '\" + id, err);' +\n    '  }' +\n    '}'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView.configuration().userContentController().addUserScript(script)\n}\n","function addEdgeConstraint(edge, subview, view, constant) {\n  view.addConstraint(\n    NSLayoutConstraint.constraintWithItem_attribute_relatedBy_toItem_attribute_multiplier_constant(\n      subview,\n      edge,\n      NSLayoutRelationEqual,\n      view,\n      edge,\n      1,\n      constant\n    )\n  )\n}\nmodule.exports = function fitSubviewToView(subview, view, constants) {\n  constants = constants || []\n  subview.setTranslatesAutoresizingMaskIntoConstraints(false)\n\n  addEdgeConstraint(NSLayoutAttributeLeft, subview, view, constants[0] || 0)\n  addEdgeConstraint(NSLayoutAttributeTop, subview, view, constants[1] || 0)\n  addEdgeConstraint(NSLayoutAttributeRight, subview, view, constants[2] || 0)\n  addEdgeConstraint(NSLayoutAttributeBottom, subview, view, constants[3] || 0)\n}\n","/* let's try to match the API from Electron's Browser window\n(https://github.com/electron/electron/blob/master/docs/api/browser-window.md) */\nvar EventEmitter = require('events')\nvar buildBrowserAPI = require('./browser-api')\nvar buildWebAPI = require('./webview-api')\nvar fitSubviewToView = require('./fitSubview')\nvar dispatchFirstClick = require('./dispatch-first-click')\nvar injectClientMessaging = require('./inject-client-messaging')\nvar movableArea = require('./movable-area')\nvar executeJavaScript = require('./execute-javascript')\nvar setDelegates = require('./set-delegates')\n\nfunction BrowserWindow(options) {\n  options = options || {}\n\n  var identifier = options.identifier || String(NSUUID.UUID().UUIDString())\n  var threadDictionary = NSThread.mainThread().threadDictionary()\n\n  var existingBrowserWindow = BrowserWindow.fromId(identifier)\n\n  // if we already have a window opened, reuse it\n  if (existingBrowserWindow) {\n    return existingBrowserWindow\n  }\n\n  var browserWindow = new EventEmitter()\n  browserWindow.id = identifier\n\n  if (options.modal && !options.parent) {\n    throw new Error('A modal needs to have a parent.')\n  }\n\n  // Long-running script\n  var fiber = coscript.createFiber()\n\n  // Window size\n  var width = options.width || 800\n  var height = options.height || 600\n  var mainScreenRect = NSScreen.screens().firstObject().frame()\n  var cocoaBounds = NSMakeRect(\n    typeof options.x !== 'undefined'\n      ? options.x\n      : Math.round((NSWidth(mainScreenRect) - width) / 2),\n    typeof options.y !== 'undefined'\n      ? NSHeight(mainScreenRect) - options.y\n      : Math.round((NSHeight(mainScreenRect) - height) / 2),\n    width,\n    height\n  )\n\n  if (options.titleBarStyle && options.titleBarStyle !== 'default') {\n    options.frame = false\n  }\n\n  var useStandardWindow = options.windowType !== 'textured'\n  var styleMask = NSTitledWindowMask\n\n  // this is commented out because the toolbar doesn't appear otherwise :thinking-face:\n  // if (!useStandardWindow || options.frame === false) {\n  //   styleMask = NSFullSizeContentViewWindowMask\n  // }\n  if (options.minimizable !== false) {\n    styleMask |= NSMiniaturizableWindowMask\n  }\n  if (options.closable !== false) {\n    styleMask |= NSClosableWindowMask\n  }\n  if (options.resizable !== false) {\n    styleMask |= NSResizableWindowMask\n  }\n  if (!useStandardWindow || options.transparent || options.frame === false) {\n    styleMask |= NSTexturedBackgroundWindowMask\n  }\n\n  var panel = NSPanel.alloc().initWithContentRect_styleMask_backing_defer(\n    cocoaBounds,\n    styleMask,\n    NSBackingStoreBuffered,\n    true\n  )\n\n  // this would be nice but it's crashing on macOS 11.0\n  // panel.releasedWhenClosed = true\n\n  var wkwebviewConfig = WKWebViewConfiguration.alloc().init()\n  var webView = WKWebView.alloc().initWithFrame_configuration(\n    CGRectMake(0, 0, options.width || 800, options.height || 600),\n    wkwebviewConfig\n  )\n  injectClientMessaging(webView)\n  webView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n\n  buildBrowserAPI(browserWindow, panel, webView)\n  buildWebAPI(browserWindow, panel, webView)\n  setDelegates(browserWindow, panel, webView, options)\n\n  if (options.windowType === 'desktop') {\n    panel.setLevel(kCGDesktopWindowLevel - 1)\n    // panel.setCanBecomeKeyWindow(false)\n    panel.setCollectionBehavior(\n      NSWindowCollectionBehaviorCanJoinAllSpaces |\n        NSWindowCollectionBehaviorStationary |\n        NSWindowCollectionBehaviorIgnoresCycle\n    )\n  }\n\n  if (\n    typeof options.minWidth !== 'undefined' ||\n    typeof options.minHeight !== 'undefined'\n  ) {\n    browserWindow.setMinimumSize(options.minWidth || 0, options.minHeight || 0)\n  }\n\n  if (\n    typeof options.maxWidth !== 'undefined' ||\n    typeof options.maxHeight !== 'undefined'\n  ) {\n    browserWindow.setMaximumSize(\n      options.maxWidth || 10000,\n      options.maxHeight || 10000\n    )\n  }\n\n  // if (options.focusable === false) {\n  //   panel.setCanBecomeKeyWindow(false)\n  // }\n\n  if (options.transparent || options.frame === false) {\n    panel.titlebarAppearsTransparent = true\n    panel.titleVisibility = NSWindowTitleHidden\n    panel.setOpaque(0)\n    panel.isMovableByWindowBackground = true\n    var toolbar2 = NSToolbar.alloc().initWithIdentifier(\n      'titlebarStylingToolbar'\n    )\n    toolbar2.setShowsBaselineSeparator(false)\n    panel.setToolbar(toolbar2)\n  }\n\n  if (options.titleBarStyle === 'hiddenInset') {\n    var toolbar = NSToolbar.alloc().initWithIdentifier('titlebarStylingToolbar')\n    toolbar.setShowsBaselineSeparator(false)\n    panel.setToolbar(toolbar)\n  }\n\n  if (options.frame === false || !options.useContentSize) {\n    browserWindow.setSize(width, height)\n  }\n\n  if (options.center) {\n    browserWindow.center()\n  }\n\n  if (options.alwaysOnTop) {\n    browserWindow.setAlwaysOnTop(true)\n  }\n\n  if (options.fullscreen) {\n    browserWindow.setFullScreen(true)\n  }\n  browserWindow.setFullScreenable(!!options.fullscreenable)\n\n  let title = options.title\n  if (options.frame === false) {\n    title = undefined\n  } else if (\n    typeof title === 'undefined' &&\n    typeof __command !== 'undefined' &&\n    __command.pluginBundle()\n  ) {\n    title = __command.pluginBundle().name()\n  }\n\n  if (title) {\n    browserWindow.setTitle(title)\n  }\n\n  var backgroundColor = options.backgroundColor\n  if (options.transparent) {\n    backgroundColor = NSColor.clearColor()\n  }\n  if (!backgroundColor && options.frame === false && options.vibrancy) {\n    backgroundColor = NSColor.clearColor()\n  }\n\n  browserWindow._setBackgroundColor(\n    backgroundColor || NSColor.windowBackgroundColor()\n  )\n\n  if (options.hasShadow === false) {\n    browserWindow.setHasShadow(false)\n  }\n\n  if (typeof options.opacity !== 'undefined') {\n    browserWindow.setOpacity(options.opacity)\n  }\n\n  options.webPreferences = options.webPreferences || {}\n\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.devTools !== false,\n      'developerExtrasEnabled'\n    )\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.javascript !== false,\n      'javaScriptEnabled'\n    )\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(!!options.webPreferences.plugins, 'plugInsEnabled')\n  webView\n    .configuration()\n    .preferences()\n    .setValue_forKey(\n      options.webPreferences.minimumFontSize || 0,\n      'minimumFontSize'\n    )\n\n  if (options.webPreferences.zoomFactor) {\n    webView.setMagnification(options.webPreferences.zoomFactor)\n  }\n\n  var contentView = panel.contentView()\n\n  if (options.frame !== false) {\n    webView.setFrame(contentView.bounds())\n    contentView.addSubview(webView)\n  } else {\n    // In OSX 10.10, adding subviews to the root view for the NSView hierarchy\n    // produces warnings. To eliminate the warnings, we resize the contentView\n    // to fill the window, and add subviews to that.\n    // http://crbug.com/380412\n    contentView.setAutoresizingMask(NSViewWidthSizable | NSViewHeightSizable)\n    fitSubviewToView(contentView, contentView.superview())\n\n    webView.setFrame(contentView.bounds())\n    contentView.addSubview(webView)\n\n    // The fullscreen button should always be hidden for frameless window.\n    if (panel.standardWindowButton(NSWindowFullScreenButton)) {\n      panel.standardWindowButton(NSWindowFullScreenButton).setHidden(true)\n    }\n\n    if (!options.titleBarStyle || options.titleBarStyle === 'default') {\n      // Hide the window buttons.\n      panel.standardWindowButton(NSWindowZoomButton).setHidden(true)\n      panel.standardWindowButton(NSWindowMiniaturizeButton).setHidden(true)\n      panel.standardWindowButton(NSWindowCloseButton).setHidden(true)\n\n      // Some third-party macOS utilities check the zoom button's enabled state to\n      // determine whether to show custom UI on hover, so we disable it here to\n      // prevent them from doing so in a frameless app window.\n      panel.standardWindowButton(NSWindowZoomButton).setEnabled(false)\n    }\n  }\n\n  if (options.vibrancy) {\n    browserWindow.setVibrancy(options.vibrancy)\n  }\n\n  // Set maximizable state last to ensure zoom button does not get reset\n  // by calls to other APIs.\n  browserWindow.setMaximizable(options.maximizable !== false)\n\n  panel.setHidesOnDeactivate(options.hidesOnDeactivate !== false)\n\n  if (options.remembersWindowFrame) {\n    panel.setFrameAutosaveName(identifier)\n    panel.setFrameUsingName_force(panel.frameAutosaveName(), false)\n  }\n\n  if (options.acceptsFirstMouse) {\n    browserWindow.on('focus', function (event) {\n      if (event.type() === NSEventTypeLeftMouseDown) {\n        browserWindow.webContents\n          .executeJavaScript(dispatchFirstClick(webView, event))\n          .catch(() => {})\n      }\n    })\n  }\n\n  executeJavaScript.injectScript(webView)\n  movableArea.injectScript(webView)\n  movableArea.setupHandler(browserWindow)\n\n  if (options.show !== false) {\n    browserWindow.show()\n  }\n\n  browserWindow.on('closed', function () {\n    browserWindow._destroyed = true\n    threadDictionary.removeObjectForKey(identifier)\n    var observer = threadDictionary[identifier + '.themeObserver']\n    if (observer) {\n      NSApplication.sharedApplication().removeObserver_forKeyPath(\n        observer,\n        'effectiveAppearance'\n      )\n      threadDictionary.removeObjectForKey(identifier + '.themeObserver')\n    }\n    fiber.cleanup()\n  })\n\n  threadDictionary[identifier] = panel\n\n  fiber.onCleanup(function () {\n    if (!browserWindow._destroyed) {\n      browserWindow.destroy()\n    }\n  })\n\n  return browserWindow\n}\n\nBrowserWindow.fromId = function (identifier) {\n  var threadDictionary = NSThread.mainThread().threadDictionary()\n\n  if (threadDictionary[identifier]) {\n    return BrowserWindow.fromPanel(threadDictionary[identifier], identifier)\n  }\n\n  return undefined\n}\n\nBrowserWindow.fromPanel = function (panel, identifier) {\n  var browserWindow = new EventEmitter()\n  browserWindow.id = identifier\n\n  if (!panel || !panel.contentView) {\n    throw new Error('needs to pass an NSPanel')\n  }\n\n  var webView = null\n  var subviews = panel.contentView().subviews()\n  for (var i = 0; i < subviews.length; i += 1) {\n    if (\n      !webView &&\n      !subviews[i].isKindOfClass(WKInspectorWKWebView) &&\n      subviews[i].isKindOfClass(WKWebView)\n    ) {\n      webView = subviews[i]\n    }\n  }\n\n  if (!webView) {\n    throw new Error('The panel needs to have a webview')\n  }\n\n  buildBrowserAPI(browserWindow, panel, webView)\n  buildWebAPI(browserWindow, panel, webView)\n\n  return browserWindow\n}\n\nmodule.exports = BrowserWindow\n","var CONSTANTS = require('./constants')\n\nmodule.exports = function (webView) {\n  var source =\n    'window.originalPostMessage = window.postMessage;' +\n    'window.postMessage = function(actionName) {' +\n    '  if (!actionName) {' +\n    \"    throw new Error('missing action name')\" +\n    '  }' +\n    '  var id = String(Math.random()).replace(\".\", \"\");' +\n    '    var args = [].slice.call(arguments);' +\n    '    args.unshift(id);' +\n    '  return new Promise(function (resolve, reject) {' +\n    '    window[\"' +\n    CONSTANTS.JS_BRIDGE_RESULT_SUCCESS +\n    '\" + id] = resolve;' +\n    '    window[\"' +\n    CONSTANTS.JS_BRIDGE_RESULT_ERROR +\n    '\" + id] = reject;' +\n    '    window.webkit.messageHandlers.' +\n    CONSTANTS.JS_BRIDGE +\n    '.postMessage(JSON.stringify(args));' +\n    '  });' +\n    '}'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView.configuration().userContentController().addUserScript(script)\n}\n","var CONSTANTS = require('./constants')\n\nmodule.exports.injectScript = function (webView) {\n  var source =\n    '(function () {' +\n    \"document.addEventListener('mousedown', onMouseDown);\" +\n    '' +\n    'function shouldDrag(target) {' +\n    '  if (!target || (target.dataset || {}).appRegion === \"no-drag\") { return false }' +\n    '  if ((target.dataset || {}).appRegion === \"drag\") { return true }' +\n    '  return shouldDrag(target.parentElement)' +\n    '};' +\n    '' +\n    'function onMouseDown(e) {' +\n    '  if (e.button !== 0 || !shouldDrag(e.target)) { return }' +\n    '  window.postMessage(\"' +\n    CONSTANTS.START_MOVING_WINDOW +\n    '\");' +\n    '};' +\n    '})()'\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    source,\n    0,\n    true\n  )\n  webView.configuration().userContentController().addUserScript(script)\n}\n\nmodule.exports.setupHandler = function (browserWindow) {\n  var initialMouseLocation = null\n  var initialWindowPosition = null\n  var interval = null\n\n  function moveWindow() {\n    // if the user released the button, stop moving the window\n    if (!initialWindowPosition || NSEvent.pressedMouseButtons() !== 1) {\n      clearInterval(interval)\n      initialMouseLocation = null\n      initialWindowPosition = null\n      return\n    }\n\n    var mouse = NSEvent.mouseLocation()\n    browserWindow.setPosition(\n      initialWindowPosition.x + (mouse.x - initialMouseLocation.x),\n      initialWindowPosition.y + (initialMouseLocation.y - mouse.y), // y is inverted\n      false\n    )\n  }\n\n  browserWindow.webContents.on(CONSTANTS.START_MOVING_WINDOW, function () {\n    initialMouseLocation = NSEvent.mouseLocation()\n    var position = browserWindow.getPosition()\n    initialWindowPosition = {\n      x: position[0],\n      y: position[1],\n    }\n\n    interval = setInterval(moveWindow, 1000 / 60) // 60 fps\n  })\n}\n","module.exports = function (webArguments) {\n  var args = null\n  try {\n    args = JSON.parse(webArguments)\n  } catch (e) {\n    // malformed arguments\n  }\n\n  if (\n    !args ||\n    !args.constructor ||\n    args.constructor !== Array ||\n    args.length == 0\n  ) {\n    return null\n  }\n\n  return args\n}\n","var ObjCClass = require('mocha-js-delegate')\nvar parseWebArguments = require('./parseWebArguments')\nvar CONSTANTS = require('./constants')\n\n// We create one ObjC class for ourselves here\nvar WindowDelegateClass\nvar NavigationDelegateClass\nvar WebScriptHandlerClass\nvar ThemeObserverClass\n\n// TODO: events\n// - 'page-favicon-updated'\n// - 'new-window'\n// - 'did-navigate-in-page'\n// - 'will-prevent-unload'\n// - 'crashed'\n// - 'unresponsive'\n// - 'responsive'\n// - 'destroyed'\n// - 'before-input-event'\n// - 'certificate-error'\n// - 'found-in-page'\n// - 'media-started-playing'\n// - 'media-paused'\n// - 'did-change-theme-color'\n// - 'update-target-url'\n// - 'cursor-changed'\n// - 'context-menu'\n// - 'select-bluetooth-device'\n// - 'paint'\n// - 'console-message'\n\nmodule.exports = function (browserWindow, panel, webview, options) {\n  if (!ThemeObserverClass) {\n    ThemeObserverClass = new ObjCClass({\n      utils: null,\n\n      'observeValueForKeyPath:ofObject:change:context:': function (\n        keyPath,\n        object,\n        change\n      ) {\n        const newAppearance = change[NSKeyValueChangeNewKey]\n        const isDark =\n          String(\n            newAppearance.bestMatchFromAppearancesWithNames([\n              'NSAppearanceNameAqua',\n              'NSAppearanceNameDarkAqua',\n            ])\n          ) === 'NSAppearanceNameDarkAqua'\n\n        this.utils.executeJavaScript(\n          \"document.body.classList.remove('__skpm-\" +\n            (isDark ? 'light' : 'dark') +\n            \"'); document.body.classList.add('__skpm-\" +\n            (isDark ? 'dark' : 'light') +\n            \"')\"\n        )\n      },\n    })\n  }\n\n  if (!WindowDelegateClass) {\n    WindowDelegateClass = new ObjCClass({\n      utils: null,\n      panel: null,\n\n      'windowDidResize:': function () {\n        this.utils.emit('resize')\n      },\n\n      'windowDidMiniaturize:': function () {\n        this.utils.emit('minimize')\n      },\n\n      'windowDidDeminiaturize:': function () {\n        this.utils.emit('restore')\n      },\n\n      'windowDidEnterFullScreen:': function () {\n        this.utils.emit('enter-full-screen')\n      },\n\n      'windowDidExitFullScreen:': function () {\n        this.utils.emit('leave-full-screen')\n      },\n\n      'windowDidMove:': function () {\n        this.utils.emit('move')\n        this.utils.emit('moved')\n      },\n\n      'windowShouldClose:': function () {\n        var shouldClose = 1\n        this.utils.emit('close', {\n          get defaultPrevented() {\n            return !shouldClose\n          },\n          preventDefault: function () {\n            shouldClose = 0\n          },\n        })\n        return shouldClose\n      },\n\n      'windowWillClose:': function () {\n        this.utils.emit('closed')\n      },\n\n      'windowDidBecomeKey:': function () {\n        this.utils.emit('focus', this.panel.currentEvent())\n      },\n\n      'windowDidResignKey:': function () {\n        this.utils.emit('blur')\n      },\n    })\n  }\n\n  if (!NavigationDelegateClass) {\n    NavigationDelegateClass = new ObjCClass({\n      state: {\n        wasReady: 0,\n      },\n      utils: null,\n\n      // // Called when the web view begins to receive web content.\n      'webView:didCommitNavigation:': function (webView) {\n        this.utils.emit('will-navigate', {}, String(String(webView.URL())))\n      },\n\n      // // Called when web content begins to load in a web view.\n      'webView:didStartProvisionalNavigation:': function () {\n        this.utils.emit('did-start-navigation')\n        this.utils.emit('did-start-loading')\n      },\n\n      // Called when a web view receives a server redirect.\n      'webView:didReceiveServerRedirectForProvisionalNavigation:': function () {\n        this.utils.emit('did-get-redirect-request')\n      },\n\n      // // Called when the web view needs to respond to an authentication challenge.\n      // 'webView:didReceiveAuthenticationChallenge:completionHandler:': function(\n      //   webView,\n      //   challenge,\n      //   completionHandler\n      // ) {\n      //   function callback(username, password) {\n      //     completionHandler(\n      //       0,\n      //       NSURLCredential.credentialWithUser_password_persistence(\n      //         username,\n      //         password,\n      //         1\n      //       )\n      //     )\n      //   }\n      //   var protectionSpace = challenge.protectionSpace()\n      //   this.utils.emit(\n      //     'login',\n      //     {},\n      //     {\n      //       method: String(protectionSpace.authenticationMethod()),\n      //       url: 'not implemented', // TODO:\n      //       referrer: 'not implemented', // TODO:\n      //     },\n      //     {\n      //       isProxy: !!protectionSpace.isProxy(),\n      //       scheme: String(protectionSpace.protocol()),\n      //       host: String(protectionSpace.host()),\n      //       port: Number(protectionSpace.port()),\n      //       realm: String(protectionSpace.realm()),\n      //     },\n      //     callback\n      //   )\n      // },\n\n      // Called when an error occurs during navigation.\n      // 'webView:didFailNavigation:withError:': function(\n      //   webView,\n      //   navigation,\n      //   error\n      // ) {},\n\n      // Called when an error occurs while the web view is loading content.\n      'webView:didFailProvisionalNavigation:withError:': function (\n        webView,\n        navigation,\n        error\n      ) {\n        this.utils.emit('did-fail-load', error)\n      },\n\n      // Called when the navigation is complete.\n      'webView:didFinishNavigation:': function () {\n        if (this.state.wasReady == 0) {\n          this.state.wasReady = 1\n          this.utils.emitBrowserEvent('ready-to-show')\n        }\n        this.utils.emit('did-navigate')\n        this.utils.emit('did-frame-navigate')\n        this.utils.emit('did-stop-loading')\n        this.utils.emit('did-finish-load')\n        this.utils.emit('did-frame-finish-load')\n      },\n\n      // Called when the web view’s web content process is terminated.\n      'webViewWebContentProcessDidTerminate:': function () {\n        this.utils.emit('dom-ready')\n      },\n\n      // Decides whether to allow or cancel a navigation.\n      // webView:decidePolicyForNavigationAction:decisionHandler:\n\n      // Decides whether to allow or cancel a navigation after its response is known.\n      // webView:decidePolicyForNavigationResponse:decisionHandler:\n    })\n  }\n\n  if (!WebScriptHandlerClass) {\n    WebScriptHandlerClass = new ObjCClass({\n      utils: null,\n      'userContentController:didReceiveScriptMessage:': function (_, message) {\n        var args = this.utils.parseWebArguments(String(message.body()))\n        if (!args) {\n          return\n        }\n        if (!args[0] || typeof args[0] !== 'string') {\n          return\n        }\n        args[0] = String(args[0])\n\n        this.utils.emit.apply(this, args)\n      },\n    })\n  }\n\n  var themeObserver = ThemeObserverClass.new({\n    utils: {\n      executeJavaScript(script) {\n        webview.evaluateJavaScript_completionHandler(script, null)\n      },\n    },\n  })\n\n  var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n    \"document.addEventListener('DOMContentLoaded', function() { document.body.classList.add('__skpm-\" +\n      (typeof MSTheme !== 'undefined' && MSTheme.sharedTheme().isDark()\n        ? 'dark'\n        : 'light') +\n      \"') }, false)\",\n    0,\n    true\n  )\n  webview.configuration().userContentController().addUserScript(script)\n\n  NSApplication.sharedApplication().addObserver_forKeyPath_options_context(\n    themeObserver,\n    'effectiveAppearance',\n    NSKeyValueObservingOptionNew,\n    null\n  )\n\n  var threadDictionary = NSThread.mainThread().threadDictionary()\n  threadDictionary[browserWindow.id + '.themeObserver'] = themeObserver\n\n  var navigationDelegate = NavigationDelegateClass.new({\n    utils: {\n      setTitle: browserWindow.setTitle.bind(browserWindow),\n      emitBrowserEvent() {\n        try {\n          browserWindow.emit.apply(browserWindow, arguments)\n        } catch (err) {\n          if (\n            typeof process !== 'undefined' &&\n            process.listenerCount &&\n            process.listenerCount('uncaughtException')\n          ) {\n            process.emit('uncaughtException', err, 'uncaughtException')\n          } else {\n            console.error(err)\n            throw err\n          }\n        }\n      },\n      emit() {\n        try {\n          browserWindow.webContents.emit.apply(\n            browserWindow.webContents,\n            arguments\n          )\n        } catch (err) {\n          if (\n            typeof process !== 'undefined' &&\n            process.listenerCount &&\n            process.listenerCount('uncaughtException')\n          ) {\n            process.emit('uncaughtException', err, 'uncaughtException')\n          } else {\n            console.error(err)\n            throw err\n          }\n        }\n      },\n    },\n    state: {\n      wasReady: 0,\n    },\n  })\n\n  webview.setNavigationDelegate(navigationDelegate)\n\n  var webScriptHandler = WebScriptHandlerClass.new({\n    utils: {\n      emit(id, type) {\n        if (!type) {\n          webview.evaluateJavaScript_completionHandler(\n            CONSTANTS.JS_BRIDGE_RESULT_SUCCESS + id + '()',\n            null\n          )\n          return\n        }\n\n        var args = []\n        for (var i = 2; i < arguments.length; i += 1) args.push(arguments[i])\n\n        var listeners = browserWindow.webContents.listeners(type)\n\n        Promise.all(\n          listeners.map(function (l) {\n            return Promise.resolve().then(function () {\n              return l.apply(l, args)\n            })\n          })\n        )\n          .then(function (res) {\n            webview.evaluateJavaScript_completionHandler(\n              CONSTANTS.JS_BRIDGE_RESULT_SUCCESS +\n                id +\n                '(' +\n                JSON.stringify(res) +\n                ')',\n              null\n            )\n          })\n          .catch(function (err) {\n            webview.evaluateJavaScript_completionHandler(\n              CONSTANTS.JS_BRIDGE_RESULT_ERROR +\n                id +\n                '(' +\n                JSON.stringify(err) +\n                ')',\n              null\n            )\n          })\n      },\n      parseWebArguments: parseWebArguments,\n    },\n  })\n\n  webview\n    .configuration()\n    .userContentController()\n    .addScriptMessageHandler_name(webScriptHandler, CONSTANTS.JS_BRIDGE)\n\n  var utils = {\n    emit() {\n      try {\n        browserWindow.emit.apply(browserWindow, arguments)\n      } catch (err) {\n        if (\n          typeof process !== 'undefined' &&\n          process.listenerCount &&\n          process.listenerCount('uncaughtException')\n        ) {\n          process.emit('uncaughtException', err, 'uncaughtException')\n        } else {\n          console.error(err)\n          throw err\n        }\n      }\n    },\n  }\n  if (options.modal) {\n    // find the window of the document\n    var msdocument\n    if (options.parent.type === 'Document') {\n      msdocument = options.parent.sketchObject\n    } else {\n      msdocument = options.parent\n    }\n    if (msdocument && String(msdocument.class()) === 'MSDocumentData') {\n      // we only have an MSDocumentData instead of a MSDocument\n      // let's try to get back to the MSDocument\n      msdocument = msdocument.delegate()\n    }\n    utils.parentWindow = msdocument.windowForSheet()\n  }\n\n  var windowDelegate = WindowDelegateClass.new({\n    utils: utils,\n    panel: panel,\n  })\n\n  panel.setDelegate(windowDelegate)\n}\n","var EventEmitter = require('events')\nvar executeJavaScript = require('./execute-javascript')\n\n// let's try to match https://github.com/electron/electron/blob/master/docs/api/web-contents.md\nmodule.exports = function buildAPI(browserWindow, panel, webview) {\n  var webContents = new EventEmitter()\n\n  webContents.loadURL = browserWindow.loadURL\n\n  webContents.loadFile = function (/* filePath */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.downloadURL = function (/* filePath */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.getURL = function () {\n    return String(webview.URL())\n  }\n\n  webContents.getTitle = function () {\n    return String(webview.title())\n  }\n\n  webContents.isDestroyed = function () {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  webContents.focus = browserWindow.focus\n  webContents.isFocused = browserWindow.isFocused\n\n  webContents.isLoading = function () {\n    return !!webview.loading()\n  }\n\n  webContents.isLoadingMainFrame = function () {\n    // TODO:\n    return !!webview.loading()\n  }\n\n  webContents.isWaitingForResponse = function () {\n    return !webview.loading()\n  }\n\n  webContents.stop = function () {\n    webview.stopLoading()\n  }\n  webContents.reload = function () {\n    webview.reload()\n  }\n  webContents.reloadIgnoringCache = function () {\n    webview.reloadFromOrigin()\n  }\n  webContents.canGoBack = function () {\n    return !!webview.canGoBack()\n  }\n  webContents.canGoForward = function () {\n    return !!webview.canGoForward()\n  }\n  webContents.canGoToOffset = function (offset) {\n    return !!webview.backForwardList().itemAtIndex(offset)\n  }\n  webContents.clearHistory = function () {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.goBack = function () {\n    webview.goBack()\n  }\n  webContents.goForward = function () {\n    webview.goForward()\n  }\n  webContents.goToIndex = function (index) {\n    var backForwardList = webview.backForwardList()\n    var backList = backForwardList.backList()\n    var backListLength = backList.count()\n    if (backListLength > index) {\n      webview.loadRequest(NSURLRequest.requestWithURL(backList[index]))\n      return\n    }\n    var forwardList = backForwardList.forwardList()\n    if (forwardList.count() > index - backListLength) {\n      webview.loadRequest(\n        NSURLRequest.requestWithURL(forwardList[index - backListLength])\n      )\n      return\n    }\n    throw new Error('Cannot go to index ' + index)\n  }\n  webContents.goToOffset = function (offset) {\n    if (!webContents.canGoToOffset(offset)) {\n      throw new Error('Cannot go to offset ' + offset)\n    }\n    webview.loadRequest(\n      NSURLRequest.requestWithURL(webview.backForwardList().itemAtIndex(offset))\n    )\n  }\n  webContents.isCrashed = function () {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setUserAgent = function (/* userAgent */) {\n    // TODO:\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.getUserAgent = function () {\n    const userAgent = webview.customUserAgent()\n    return userAgent ? String(userAgent) : undefined\n  }\n  webContents.insertCSS = function (css) {\n    var source =\n      \"var style = document.createElement('style'); style.innerHTML = \" +\n      css.replace(/\"/, '\\\\\"') +\n      '; document.head.appendChild(style);'\n    var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n      source,\n      0,\n      true\n    )\n    webview.configuration().userContentController().addUserScript(script)\n  }\n  webContents.insertJS = function (source) {\n    var script = WKUserScript.alloc().initWithSource_injectionTime_forMainFrameOnly(\n      source,\n      0,\n      true\n    )\n    webview.configuration().userContentController().addUserScript(script)\n  }\n  webContents.executeJavaScript = executeJavaScript(webview, browserWindow)\n  webContents.setIgnoreMenuShortcuts = function () {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setAudioMuted = function (/* muted */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.isAudioMuted = function () {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setZoomFactor = function (factor) {\n    webview.setMagnification_centeredAtPoint(factor, CGPointMake(0, 0))\n  }\n  webContents.getZoomFactor = function (callback) {\n    callback(Number(webview.magnification()))\n  }\n  webContents.setZoomLevel = function (level) {\n    // eslint-disable-next-line no-restricted-properties\n    webContents.setZoomFactor(Math.pow(1.2, level))\n  }\n  webContents.getZoomLevel = function (callback) {\n    // eslint-disable-next-line no-restricted-properties\n    callback(Math.log(Number(webview.magnification())) / Math.log(1.2))\n  }\n  webContents.setVisualZoomLevelLimits = function (/* minimumLevel, maximumLevel */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n  webContents.setLayoutZoomLevelLimits = function (/* minimumLevel, maximumLevel */) {\n    // TODO:??\n    console.warn(\n      'Not implemented yet, please open a PR on https://github.com/skpm/sketch-module-web-view :)'\n    )\n  }\n\n  // TODO:\n  // webContents.undo = function() {\n  //   webview.undoManager().undo()\n  // }\n  // webContents.redo = function() {\n  //   webview.undoManager().redo()\n  // }\n  // webContents.cut = webview.cut\n  // webContents.copy = webview.copy\n  // webContents.paste = webview.paste\n  // webContents.pasteAndMatchStyle = webview.pasteAsRichText\n  // webContents.delete = webview.delete\n  // webContents.replace = webview.replaceSelectionWithText\n\n  webContents.send = function () {\n    const script =\n      'window.postMessage({' +\n      'isSketchMessage: true,' +\n      \"origin: '\" +\n      String(__command.identifier()) +\n      \"',\" +\n      'args: ' +\n      JSON.stringify([].slice.call(arguments)) +\n      '}, \"*\")'\n    webview.evaluateJavaScript_completionHandler(script, null)\n  }\n\n  webContents.getNativeWebview = function () {\n    return webview\n  }\n\n  browserWindow.webContents = webContents\n}\n","/* globals NSThread */\nvar threadDictionary = NSThread.mainThread().threadDictionary()\n\nmodule.exports.getWebview = function (identifier) {\n  return require('./lib').fromId(identifier) // eslint-disable-line\n}\n\nmodule.exports.isWebviewPresent = function isWebviewPresent(identifier) {\n  return !!threadDictionary[identifier]\n}\n\nmodule.exports.sendToWebview = function sendToWebview(identifier, evalString) {\n  if (!module.exports.isWebviewPresent(identifier)) {\n    return\n  }\n\n  var panel = threadDictionary[identifier]\n  var webview = null\n  var subviews = panel.contentView().subviews()\n  for (var i = 0; i < subviews.length; i += 1) {\n    if (\n      !webview &&\n      !subviews[i].isKindOfClass(WKInspectorWKWebView) &&\n      subviews[i].isKindOfClass(WKWebView)\n    ) {\n      webview = subviews[i]\n    }\n  }\n\n  if (!webview || !webview.evaluateJavaScript_completionHandler) {\n    throw new Error('Webview ' + identifier + ' not found')\n  }\n\n  webview.evaluateJavaScript_completionHandler(evalString, null)\n}\n","module.exports = \"file://\" + String(context.scriptPath).split(\".sketchplugin/Contents/Sketch\")[0] + \".sketchplugin/Contents/Resources/_webpack_resources/d185e74ad4e53236afd37ba858a0bf3b.html\";","// Extend Math //\n\nMath.rad = Math.PI / 180;\n\nMath.degrees = function (deg) {\n\treturn (deg + 360) % 360;\n};\n\nMath.factorial = function (num) {\n\tvar rval=1;\n\tfor (var i = 2; i <= num; i++)\n\t\trval = rval * i;\n\treturn rval;\n};\n\nMath.triangle = function (num) {\n\treturn (num*(num+1))/2;\n};\n\nMath.decimal = function (num, decimal = 0) {\n\treturn Math.round(num * (Math.pow(10, decimal))) / Math.pow(10, decimal);\n};\n// Circulair easing\nMath.ease = function (timing, steps) {\n\tvar transition = {\n\t\tstart: 0,\n\t\tstep: 0,\n\t\tlatter: 0,\n\t\tfactor: 1,\n\t\tpoints: new Array()\n\t}\n\tswitch(timing) {\n\t\tcase \"ease\":\n\t\t\ttransition.step = Math.PI / steps;\n\t\t\ttransition.factor = 2;\n\t\t\tbreak;\n\t\tcase \"ease-in\":\n\t\t\ttransition.start = Math.PI / 2,\n\t\t\ttransition.step = Math.PI / 2 / steps;\n\t\t\tbreak;\n\t\tcase \"ease-out\":\n\t\t\ttransition.step = Math.PI / 2 / steps;\n\t\t\tbreak;\n\t\tdefault:\n\t}\n\tif(transition.step) {\n\t\ttransition.latter = (Math.cos(transition.start) + 1) / transition.factor;\n\t\tfor(var i = 0; i <= steps; i++) {\n\t\t\tvar cos = (Math.cos(transition.start) + 1) / transition.factor;\n\t\t\tvar dif = i == 0 ? 0 : Math.abs(cos - transition.latter);\n\t\t\ttransition.start += transition.step;\n\t\t\ttransition.latter = cos;\n\t\t\tif(i) {\n\t\t\t\ttransition.points.push(dif);\n\t\t\t}\n\t\t}\n\t\ttransition.points.push(0);\n\t\treturn transition.points;\n\t} else {\n\t\treturn false;\n\t}\n}\n// Logarithmic easing\nMath.easePower = function (timing, power, steps) {\n\tif(timing == 'linear') return false;\n\tvar transition = new Array();\n\tvar total = 0;\n\tfor(let x=0; x<=steps; x++) {\n\t\tlet y = timing == 'ease' && x > steps / 2 ? Math.pow( steps + 1 - x, power ) : Math.pow( x, power );\n\t\tif(x) {\n\t\t\ttotal += y;\n\t\t\tif(timing == 'ease-in') {\n\t\t\t\ttransition.unshift(y);\n\t\t\t} else {\n\t\t\t\ttransition.push(y);\n\t\t\t}\n\t\t}\n\t}\n\tfor(let i=0; i<steps; i++) {\n\t\ttransition[i] = Math.decimal(transition[i] /= total, 6);\n\t}\n\ttransition.push(0);\n\treturn transition;\n}\n\n// Vector 2D //\n\nexport default function Vector2d(x,y) {\n\tthis.x = x || 0;\n\tthis.y = y || 0;\n}\n\nVector2d.prototype = {\n\tadd: function(point) {\n\t\tthis.x += point.x;\n\t\tthis.y += point.y;\n\t},\n\tangle: function() {\n\t\treturn Math.degrees(270 - ((Math.atan2(this.y, -this.x) * 180) / Math.PI));\n\t},\n\tmultiplier: function(testAngle) {\n\t\tvar angle = Math.degrees(this.angle() - testAngle);\n\t\tvar radians = Math.rad * angle;\n\n\t\tvar multiplier = Math.decimal(Math.cos(radians), 9);\n\t\treturn multiplier;\n\t},\n\tradius: function() {\n\t\treturn Math.sqrt( ( this.x * this.x ) + ( this.y * this.y) );\n\t},\n\troot: function() {\n\t\tif(Math.abs(this.x) > Math.abs(this.y)) {\n\t\t\tthis.y = this.y / Math.abs(this.x);\n\t\t\tthis.x = this.x / Math.abs(this.x);\n\t\t} else {\n\t\t\tthis.x = this.x / Math.abs(this.y);\n\t\t\tthis.y = this.y / Math.abs(this.y);\n\t\t}\n\t},\n\trotate: function(center, angle) {\n\t\tvar radians = Math.rad * angle,\n\t\t\tcos = Math.cos(radians),\n\t\t\tsin = Math.sin(radians),\n\t\t\tx = this.x,\n\t\t\ty = this.y;\n\t\tthis.x = (cos * (x - center.x)) + (sin * (y - center.y)) + center.x;\n\t\tthis.y = (cos * (y - center.y)) - (sin * (x - center.x)) + center.y;\n\t},\n\tsubstract: function(point) {\n\t\tthis.x -= point.x;\n\t\tthis.y -= point.y;\n\t}\n}","// Init\nconst sketch = require('sketch');\nconst Settings = require('sketch/settings');\nconst UI = require('sketch/ui');\nimport BrowserWindow from 'sketch-module-web-view';\nimport { getWebview, isWebviewPresent, sendToWebview } from 'sketch-module-web-view/remote';\n\nimport Vector2d from './ddMath.js';\nconst uniqueCommIdentifier = 'comm.ddSpiral.webview';\nconst uniqueSettingIdentifier = 'ddSpiralID';\n\nconst _openShapes = ['MSShapePathLayer','MSRectangleShape','MSOvalShape','MSTriangleShape','MSPolygonShape','MSStarShape'];\nconst openShapes = ['Custom','Rectangle','Oval','Triangle','Polygon','Star'];\nconst shapeNames = ['custom shape', 'rectangle', 'oval', 'triangle', 'polygon', 'star'];\n\t\t\nconst settingIdentifiers = ['loops', 'points', 'smooth', 'timing', 'power', 'squeeze', 'mirror', 'clockwise', 'auto'];\nconst appcast = \"https://raw.githubusercontent.com/Design-Dude/ddSpiral/master/.appcast.xml\";\n\n// Not working with skpm BrowserWindow\n// var fiber;\n\nexport default function (context) {\n\n\t// Keep script alive after js finish\n\t// if(!fiber) {\n\t// \tfiber = Async.createFiber();\n\t// \tfiber.onCleanup(() => {\n\t// \t\tUI.cleanup();\n\t// \t});\n\t// }\n\n\t// Webview options\n\tconst options = {\n\t\tidentifier: uniqueCommIdentifier,\n\t\twidth: 240,\n\t\theight: 554,\n\t\tshow: false,\n\t\tbackgroundColor: '#ffffffff',\n\t\talwaysOnTop: true,\n\t\tresizable: false,\n\t\ttitleBarStyle: 'default',\n\t\tmaximizable: false,\n\t\tminimizable: false\n\t}\n\tconst browserWindow = new BrowserWindow(options)\n\n\t// Only show the window when the page has loaded to avoid a white flash\n\tbrowserWindow.once('ready-to-show', () => {\n\t\t// Activate plugin\n\t\tSettings.setSettingForKey(uniqueSettingIdentifier+'window', true);\n\t\t// Show window\n\t\tbrowserWindow.show();\n\t});\n\n\t// Only show the window when the page has loaded to avoid a white flash\n\tbrowserWindow.once('close', () => {\n\t\t// Deactivate plugin\n\t\tSettings.setSettingForKey(uniqueSettingIdentifier+'window', false);\n\t});\n\n\tconst webContents = browserWindow.webContents;\n\n\t// Do something after page load\n\twebContents.on('did-finish-load', () => {\n\t\t// Handle current selection and tell webview \n\t\thandleSelection();\n\t});\n\t\n\t// Listener for link requests from the webview\n\twebContents.on('followLink', url => {\n\t\tNSWorkspace.sharedWorkspace().openURL(NSURL.URLWithString(url));\n\t});\n\n\t// Listener for calls from the webview\n\twebContents.on('internalRequest', requestData => {\n\t\trequestData = JSON.parse(requestData);\n\t\tif(requestData.action) {\n\t\t\tswitch(requestData.action) {\n\t\t\t\tcase \"getSelection\":\n\t\t\t\t\t// The webview may ask for the current selection\n\t\t\t\t\thandleSelection();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"spiralise\":\n\t\t\t\t\t// The webview may ask for the current selection\n\t\t\t\t\tspiral(requestData);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"clear\":\n\t\t\t\t\t// The webview may ask for the current selection\n\t\t\t\t\tclearSelection(requestData);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t});\n\n\t// Load webview\n\tbrowserWindow.loadURL(require('../resources/webview.html'));\n}\n\n// Close webview plugin is shutdown by Sketch\nexport function onShutdown() {\n  const existingWebview = getWebview(uniqueCommIdentifier)\n  if (existingWebview) {\n    existingWebview.close()\n  }\n}\n\n// Return message to the corresponding listener in the webview\nfunction respondToWebview(message, listener = 'internalResponse') {\n  message = JSON.stringify(message);\n  if (isWebviewPresent(uniqueCommIdentifier)) {\n    sendToWebview(uniqueCommIdentifier, `${listener}(${message})`);\n  }\n}\n\n// Listens to Sketch event\nexport function onSelectionChanged(context) {\n\t// Forget about context = oldschool\n\t// Only handle selection changes if plugin is active\n\tif(Settings.settingForKey(uniqueSettingIdentifier+'window')) {\n\t\thandleSelection();\n\t}\n}\n\n// Handle current selection data and send to webview\nfunction handleSelection() {\n\n\t// Get selected document and layers from Sketch API\n\tconst document = sketch.getSelectedDocument();\n\tconst selectedLayers = document.selectedLayers.layers;\n\t\n\t// Reset spiralID\n\tSettings.setSettingForKey(uniqueSettingIdentifier, false);\n\n\t// Local data collection\n\tlet collection = {\n\t\tobjects: 0,\n\t\tshapes: 0,\n\t\trects: 0,\n\t\tpaths: 0,\n\t\tparentObj: false,\n\t\tstartObj: false,\n\t\tendObj: false\n\t}\n\t\n\t// Collect settings for webview\n\tlet selection = {\n\t\ttheme: 'light',\n\t\ttype: 0,\n\t\tshape: '',\n\t\tclear: false,\n\t\tisSpiral: false,\n\t\tstartID: '',\n\t\tendID: '',\n\t\tpathID: '',\n\t\tparentID: ''\n\t}\n\tfor(let i in settingIdentifiers) {\n\t\tlet getSetting = Settings.settingForKey(uniqueSettingIdentifier+settingIdentifiers[i]);\n\t\tselection[settingIdentifiers[i]] = getSetting || getSetting === false ? getSetting : 'undefined';\n\t}\n\tlet start_val = {\n\t\tx:0,\n\t\ty:0,\n\t\tw:0,\n\t\th:0,\n\t\tdeg:0,\n\t\tworldDeg: 0\n\t}\n\tlet end_val = {\n\t\tx:0,\n\t\ty:0,\n\t\tw:0,\n\t\th:0,\n\t\tdeg:0,\n\t\tworldDeg: 0\n\t}\n\n\t// Keep track of first object\n\tvar firstObj = true;\n\t\n\t// Loop through selected layers and collect start and end values\n\tfor (var i=0; i<selectedLayers.length; i++) {\n\t\t// Get the layer\n\t\tlet selectedLayer = selectedLayers[i];\n\t\t// Get layer type\n\t\tlet typeName = selectedLayer.shapeType;\n\t\t\n\t\t// Open shape?\n\t\tif(openShapes.indexOf(typeName) > -1 && !selectedLayer.closed) {\n\t\t\t// Count paths\n\t\t\tcollection.paths ++;\n\t\t\tif(collection.paths == 1) {\n\t\t\t\t// Is shape spiral\n\t\t\t\tselection.isSpiral = Settings.layerSettingForKey(selectedLayer, uniqueSettingIdentifier);\n\t\t\t\t// Store parent\n\t\t\t\tcollection.parentObj = selectedLayer.parent;\n\t\t\t\tselection.parentID = selectedLayer.parent.id;\n\t\t\t\t// Get the native Sketch object\n\t\t\t\tlet nativeLayer = selectedLayer.sketchObject;\n\t\t\t\t// Get the path as CG object\n\t\t\t\tlet path = NSBezierPath.bezierPathWithCGPath(nativeLayer.pathInFrameWithTransforms().CGPath());\n\t\t\t\t// Set default radius based on length\n\t\t\t\tlet defaultRadius = path.length() / 10;\n\t\t\t\tdefaultRadius = defaultRadius > 50 ? 50 : defaultRadius;\n\t\t\t\t// Remember paths layer id\n\t\t\t\tselection.pathID = selectedLayer.id;\n\t\t\t\t// Use \n\t\t\t\tif(firstObj) {\n\t\t\t\t\tstart_val.w = defaultRadius;\n\t\t\t\t\tstart_val.h = defaultRadius;\n\t\t\t\t\tstart_val.deg = Math.degrees( selectedLayer.transform.rotation - 0 );\n\t\t\t\t\tend_val.w = defaultRadius;\n\t\t\t\t\tend_val.h = defaultRadius;\n\t\t\t\t\tend_val.deg = Math.degrees( selectedLayer.transform.rotation - 0 );\n\t\t\t\t}\n\t\t\t}\n\n\t\t} else {\n\t\t\t// Do we have a closed shape?\n\t\t\tif(openShapes.indexOf(typeName) > -1) {\n\t\t\t\tcollection.shapes ++;\n\t\t\t\t// Remember the name of the shape\n\t\t\t\tselection.shape = shapeNames[openShapes.indexOf( typeName )];\n\t\t\t\tif(typeName == 'Rectangle') collection.rects ++;\n\t\t\t} else {\n\t\t\t\t// Some other object\n\t\t\t\tcollection.objects ++;\n\t\t\t}\n\t\t\tif(!collection.paths) {\n\t\t\t\t// Store parent if we don't have a path yet\n\t\t\t\tcollection.parentObj = selectedLayer.parent;\n\t\t\t\tselection.parentID = selectedLayer.parent.id;\n\t\t\t}\n\t\t\tif(firstObj) { // First object is starting point\n\t\t\t\tfirstObj = false;\n\t\t\t\t// Store start object parent\n\t\t\t\tcollection.startObj = selectedLayer.parent;\n\t\t\t\tselection.startID = selectedLayer.id;\n\t\t\t\t// Store start position, sizenand rotation\n\t\t\t\tstart_val.x = selectedLayer.frame.x + (selectedLayer.frame.width / 2);\n\t\t\t\tstart_val.y = selectedLayer.frame.y + (selectedLayer.frame.height / 2);\n\t\t\t\tstart_val.w = selectedLayer.frame.width * 0.5;\n\t\t\t\tstart_val.h = selectedLayer.frame.height * 0.5;\n\t\t\t\tstart_val.deg = Math.degrees( selectedLayer.transform.rotation - 0 );\n\t\t\t\t// Store end position, size and rotation\n\t\t\t\tend_val.x = selectedLayer.frame.x + (selectedLayer.frame.width / 2);\n\t\t\t\tend_val.y = selectedLayer.frame.y + (selectedLayer.frame.height / 2);\n\t\t\t\tend_val.w = 0;\n\t\t\t\tend_val.h = 0;\n\t\t\t\tend_val.deg = Math.degrees( selectedLayer.transform.rotation - 0 );\n\t\t\t\t\n\t\t\t} else { // Last object becomes target\n\t\t\t\t// Store end object parent\n\t\t\t\tcollection.endObj = selectedLayer.parent;\n\t\t\t\tselection.endID = selectedLayer.id;\n\t\t\t\t// Update end position, size and rotation\n\t\t\t\tend_val.x = selectedLayer.frame.x + (selectedLayer.frame.width / 2);\n\t\t\t\tend_val.y = selectedLayer.frame.y + (selectedLayer.frame.height / 2);\n\t\t\t\tend_val.w = selectedLayer.frame.width * 0.5;\n\t\t\t\tend_val.h = selectedLayer.frame.height * 0.5;\n\t\t\t\tend_val.deg = Math.degrees( selectedLayer.transform.rotation - 0 );\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t}\n\t\n\t// Set selection type\n\tlet o = collection.objects;\n\tlet s = collection.shapes;\n\tlet p = collection.paths;\n\tlet r = collection.rects;\n\tselection.type = 0;\n\tif( o==1 && !s && !p ) {\n\t\tselection.type = 1; // single object\n\t} else if( !o && s==1 && !r && !p ) {\n\t\tselection.type = 2; // single shape, no rect\n\t} else if( !o && s==1 && r && !p ) {\n\t\tselection.type = 2; // single shape, rect\n\t\t// always send type 2, change to 3 in webview if squeeze is true\n\t} else if( o+s<2 && p==1 ) {\n\t\tselection.type = 4; // zero or single object + path (center ease allowed)\n\t} else if( o+s==2 && !p ) {\n\t\tselection.type = 5; // two objects\n\t} else if( o+s+p==3 && p==1 ) {\n\t\tselection.type = 4; // two objects + path (is now same as #4)\n\t}\n\t\n\t// Set world coordinates\n\tcollection.parentObj = worldOrientation(collection.parentObj);\n\tcollection.startObj = worldOrientation(collection.startObj);\n\tcollection.endObj = worldOrientation(collection.endObj);\n\t\n\t// Set world rotation for display in webview\n\tstart_val.worldDeg = collection.startObj.r;\n\tend_val.worldDeg = collection.startObj.r;\n\t\n\t// Relocate both objects to document level if parents differ\n\tif(selection.type == 5 && collection.startObj && collection.endObj && collection.startObj.id != collection.endObj.id) {\n\t\tstart_val.x += collection.startObj.x;\n\t\tstart_val.y += collection.startObj.y;\n\t\tstart_val.deg = Math.degrees(start_val.deg + collection.startObj.r);\n\t\tstart_val.worldDeg = 0;\n\t\tend_val.x += collection.endObj.x;\n\t\tend_val.y += collection.endObj.y;\n\t\tend_val.deg = Math.degrees(end_val.deg + collection.endObj.r);\n\t\tend_val.worldDeg = 0;\n\t\tselection.parentID = ''; //collection.endObj.id; // document level\n\t}\n\t// Relocate first objects in combination with path\n\tif(selection.type == 4 && collection.startObj.id && collection.startObj.id != collection.parentObj.id) {\n\t\tstart_val.x += collection.startObj.x - collection.parentObj.x;\n\t\tstart_val.y += collection.startObj.y - collection.parentObj.y;\n\t\tstart_val.deg = Math.degrees(start_val.deg + collection.startObj.r - collection.parentObj.r);\n\t\tstart_val.worldDeg = collection.parentObj.r;\n\t\tif(selection.type == 4 && collection.endObj.id && collection.endObj.id != collection.parentObj.id) {\n\t\t\tend_val.x += collection.endObj.x - collection.parentObj.x;\n\t\t\tend_val.y += collection.endObj.y - collection.parentObj.y;\n\t\t\tend_val.deg = Math.degrees(end_val.deg + collection.endObj.r - collection.parentObj.r);\n\t\t} else {\n\t\t\tend_val.deg = start_val.deg;\n\t\t}\n\t\tend_val.worldDeg = collection.parentObj.r;\n\t}\n\n\t// Pass Sketch theme\n\tselection.theme = UI.getTheme();\n\t\n\t// Set the final message for the webview\n\tlet message = { selection, start_val, end_val };\n\t\n\t// Tell webview about selection\n\trespondToWebview(message, 'setSelection');\n\t\n}\n\n// Set world coordinatates for object in target\nfunction worldOrientation(obj) {\n\tvar coor = {\n\t\tid: obj.id ? obj.id : false,\n\t\tx: 0,\n\t\ty: 0,\n\t\tr: 0\n\t};\n\twhile(obj && obj.name) {\n\t\tcoor.x += obj.frame.x;\n\t\tcoor.y += obj.frame.y;\n\t\tcoor.r += obj.transform.rotation;\n\t\tobj = obj.parent;\n\t};\n\treturn coor;\n}\n\n//////////////////////////////////////////////\n//////////////////////////////////////////////\n// \n// Create actual spiral\n// \n//////////////////////////////////////////////\n//////////////////////////////////////////////\n\nfunction spiral(data) {\n\n\t// Get selected document and layers from Sketch API\n\tlet document = sketch.getSelectedDocument();\n\n\t// Passed data from webview\n\tvar ret_start_val = data.start_val;\n\tvar ret_end_val = data.end_val;\n\tvar ret_settings = data.settings;\n\t\n\t// Save settings to plugin\n\tfor(let i in settingIdentifiers) {\n\t\tSettings.setSettingForKey(uniqueSettingIdentifier+settingIdentifiers[i], ret_settings[settingIdentifiers[i]]);\n\t}\n\t\n\t// Preset radius\n\tvar rad = {\n\t\tlength: new Vector2d(\n\t\t\tret_start_val.w,\n\t\t\tret_start_val.h\n\t\t),\n\t\tstep: new Vector2d(),\n\t\ttarget: new Vector2d(\n\t\t\tret_end_val.w,\n\t\t\tret_end_val.h\n\t\t),\n\t\ttotal: 0,\n\t\tarray: []\n\t}\n\t// Prevent 0 length for divisions\n\tif(rad.length.x == 0 || rad.length.y == 0) {\n\t\trad.length.x = 0.0001;\n\t\trad.length.y = 0.0001;\n\t}\n\tif(rad.target.x == 0 || rad.target.y == 0) {\n\t\trad.target.x = 0.0001;\n\t\trad.target.y = 0.0001;\n\t}\n\t// Preset rotation\n\tvar rot = {\n\t\tangle: Math.degrees( ret_start_val.deg ),\n\t\tstep: 0,\n\t\ttarget: Math.degrees( ret_end_val.deg )\n\t}\n\t// Preset translation\n\tvar trans = {\n\t\tcenter: new Vector2d(\n\t\t\tret_start_val.x,\n\t\t\tret_start_val.y\n\t\t),\n\t\tstep: 0,\n\t\ttarget: new Vector2d(\n\t\t\tret_end_val.x,\n\t\t\tret_end_val.y\n\t\t),\n\t\ttotal: 0,\n\t\tarray: []\n\t}\n\t\n\t// Total steps\n\tvar steps = ret_settings.loops * ret_settings.points;\n\n\t// Ease timing\n\tvar transition = Math.easePower(ret_settings.timing, ret_settings.power * 0.85, steps);\n\n\t// GAP, fix for half paths from rectangles\n\tvar gap = {\n\t\tfirst: false,\n\t\tstart: new Vector2d(),\n\t\tlength: 0\n\t}\n\t\n\t// Squeeze spiral into shape\n\tif(ret_settings.squeeze) {\n\n\t\t// Adjust loop setting\n\t\tret_settings.loops = Math.round(ret_settings.loops) + 0.5;\n\t\tsteps = ret_settings.loops * ret_settings.points;\n\t\ttransition = Math.easePower(ret_settings.timing, ret_settings.power * 0.85, steps);\n\n\t\t\n\t\t// Get the shape as js object\n\t\tconst jsShape = document.getLayerWithID(ret_settings.startID);\n\t\tconst nativeShape = jsShape.sketchObject;\n\t\t// Path from shape object\n\t\tconst pathInFrame = nativeShape.pathInFrameWithTransforms();\n\t\t// Collection of point on path\n\t\tlet outl = {\n\t\t\ttop: false,\n\t\t\tbottom: false,\n\t\t\tarray: []\n\t\t}\n\t\t// Collect all horizontal max and min points on the path\n\t\tfor(var j=0; j<=Math.round(pathInFrame.length()); j++) {\n\t\t\tvar point = pathInFrame.pointOnPathAtLength( j );\n\t\t\tlet x = Math.round(point.x);\n\t\t\tlet y = Math.round(point.y);\n\t\t\t\n\t\t\t//GAP\n\t\t\tif(!gap.first) {\n\t\t\t\tgap.first = new Vector2d( x, y );\n\t\t\t}\n\t\t\tif(x == gap.start.x && y == gap.start.y && j != Math.round(pathInFrame.length())) {\n\t\t\t\tgap.length++;\n\t\t\t} else if(gap.length > 2 || j == Math.round(pathInFrame.length())) {\n\t\t\t\tconst gapDistance = Math.sqrt( (gap.first.x - gap.start.x)*(gap.first.x - gap.start.x) + (gap.first.y - gap.start.y)*(gap.first.y - gap.start.y) );\n\t\t\t\tconst gapStep = new Vector2d(\n\t\t\t\t\t(gap.first.x - gap.start.x) / gapDistance,\n\t\t\t\t\t(gap.first.y - gap.start.y) / gapDistance,\n\t\t\t\t);\n\t\t\t\tfor(let d=0; d<gapDistance; d++) {\n\t\t\t\t\tconst xx = Math.round( gap.start.x + d * gapStep.x );\n\t\t\t\t\tconst yy = Math.round( gap.start.y + d * gapStep.y );\n\t\t\t\t\tconst high = Math.ceil( outl.array[yy] ? xx > outl.array[yy].high ? xx : outl.array[yy].high : xx );\n\t\t\t\t\tconst low = Math.floor( outl.array[yy] ? xx < outl.array[yy].low ? xx : outl.array[yy].low : xx );\n\t\t\t\t\tconst radius = (high - low) / 2;\n\t\t\t\t\tconst center = low + radius;\n\t\t\t\t\toutl.array[yy] = {\n\t\t\t\t\t\thigh: high,\n\t\t\t\t\t\tlow: low,\n\t\t\t\t\t\tcenter: center,\n\t\t\t\t\t\tradius: radius\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tgap.start = new Vector2d( x, y );\n\t\t\t\tgap.length = 0;\n\t\t\t} else {\n\t\t\t\tgap.start = new Vector2d( x, y );\n\t\t\t\tgap.length = 0;\n\t\t\t\tconst high = Math.ceil( outl.array[y] ? x > outl.array[y].high ? x : outl.array[y].high : x );\n\t\t\t\tconst low = Math.floor( outl.array[y] ? x < outl.array[y].low ? x : outl.array[y].low : x );\n\t\t\t\tconst radius = (high - low) / 2;\n\t\t\t\tconst center = low + radius;\n\t\t\t\toutl.top = y < outl.top || outl.top === false ? y : outl.top;\n\t\t\t\toutl.bottom = y > outl.bottom || outl.bottom === false ? y : outl.bottom;\n\t\t\t\toutl.array[y] = {\n\t\t\t\t\thigh: high,\n\t\t\t\t\tlow: low,\n\t\t\t\t\tcenter: center,\n\t\t\t\t\tradius: radius\n\t\t\t\t}\n\t\t\t\n\t\t\t}\n\t\t};\n\t\n\t\t// Rotation\n\t\trot.angle = 0;\n\t\trot.target = 0;\n\t\t\n\t\t// Total distance\n\t\tlet distanceY = rad.length.y;\n\t\tlet radiusY = (distanceY / (ret_settings.loops + 0));\n\n\t\t// Prepare vertical translation\n\t\tconst easeRadius = ret_settings.timing == 'linear' ? false : true;\n\n\t\ttrans = {\n\t\t\tcenter: new Vector2d(\n\t\t\t\toutl.array[outl.top].center,\n\t\t\t\toutl.top + (easeRadius ? (ret_settings.timing == 'ease' || ret_settings.timing == 'ease-out' ? 0 : radiusY) : radiusY)\n\t\t\t),\n\t\t\tstep: 0,\n\t\t\ttarget: new Vector2d(\n\t\t\t\toutl.array[outl.bottom].center,\n\t\t\t\toutl.bottom - (easeRadius ? (ret_settings.timing == 'ease' || ret_settings.timing == 'ease-in' ? 0 : radiusY) : radiusY)\n\t\t\t),\n\t\t\ttotal: 0,\n\t\t\tarray: []\n\t\t}\n\t\ttrans.total = new Vector2d(\n\t\t\ttrans.target.x - trans.center.x,\n\t\t\ttrans.target.y - trans.center.y\n\t\t);\n\t\ttrans.step = new Vector2d(\n\t\t\ttrans.total.x / steps,\n\t\t\ttrans.total.y / steps\n\t\t);\n\t\t\n\t\t// Prepare vertical radius\n\t\trad = {\n\t\t\tlength: new Vector2d(\n\t\t\t\toutl.array[outl.top].radius,\n\t\t\t\teaseRadius ? (ret_settings.timing == 'ease' || ret_settings.timing == 'ease-out' ? 0 : radiusY) : radiusY\n\t\t\t),\n\t\t\tstep: new Vector2d(),\n\t\t\ttarget: new Vector2d(\n\t\t\t\toutl.array[outl.bottom].radius,\n\t\t\t\teaseRadius ? (ret_settings.timing == 'ease' || ret_settings.timing == 'ease-in' ? 0 : radiusY) : radiusY\n\t\t\t),\n\t\t\ttotal: 0,\n\t\t\tarray: []\n\t\t}\n\n\t\t// Fill translation and radial arrays\n\t\tvar transTotal = 0;\n\t\tvar radTotal = 0;\n\t\tvar largestStep = 0;\n\n\t\tfor(var j=0; j<=steps; j++) {\n\t\t\tif(transition) {\n\t\t\t\ttransTotal += transition[j] * trans.total.y;\n\t\t\t\tvar transPoint = new Vector2d(\n\t\t\t\t\tret_start_val.x,\n\t\t\t\t\ttrans.center.y + transTotal\n\t\t\t\t);\n\t\t\t\tradTotal += transition[j];\n\t\t\t\tvar radPoint = new Vector2d(\n\t\t\t\t\trad.length.x,\n\t\t\t\t\tradiusY\n\t\t\t\t);\n\t\t\t\tif(easeRadius) {\n\t\t\t\t\tlargestStep = transition[j] > largestStep ? transition[j] : largestStep;\n\t\t\t\t\tradPoint.y = transition[j];\n\t\t\t\t}\n\t\t\t} else if(j < steps) {\n\t\t\t\tvar transPoint = new Vector2d(\n\t\t\t\t\tret_start_val.x,\n\t\t\t\t\ttrans.center.y + (j+1) * trans.step.y\n\t\t\t\t);\n\t\t\t\tvar radPoint = new Vector2d(\n\t\t\t\t\trad.length.x,\n\t\t\t\t\tradiusY\n\t\t\t\t);\n\t\t\t}\n\t\t\t// Lookup horizontal position and radius\n\t\t\tlet a = Math.cos( Math.rad * Math.degrees((ret_settings.loops * 360 / steps) * j * (ret_settings.clockwise ? 1 : -1)) );\n\t\t\tvar lookup = Math.round(transPoint.y + radPoint.y * -a);\n\t\t\tvar lookupCenter = Math.round(transPoint.y);\n\n\t\t\tif(outl.array[lookupCenter]) {\n\t\t\t\ttransPoint.x = outl.array[lookup].center;\n\t\t\t\tradPoint.x = outl.array[lookup].radius;\n\t\t\t}\n\t\t\t// Put points in arrays\n\t\t\ttrans.array.push( transPoint );\n\t\t\trad.array.push( radPoint );\n\n\t\t};\n\n\t\t// Rescale radius to max\n\t\tif(easeRadius) {\n\t\t\tfor(let i=0; i<rad.array.length; i++) {\n\t\t\t\t// if(i < rad.array.length - 1) {\n\t\t\t\t// \trad.array[i].x = (rad.array[i].x + rad.array[i+1].x) / 2;\n\t\t\t\t// }\n\t\t\t\trad.array[i].y *= (radiusY / largestStep);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t// Adjust step settings to user input\n\tvar angle = (ret_settings.clockwise ? 1 : -1) * ret_settings.loops * 360 / steps; // angle per point\n\n\t// Rotation\n\trot.step = ( Math.degrees(360 + rot.target) - Math.degrees(360 + rot.angle) ); // rotation from first to second object\n\tif( rot.step > 180) {\n\t\trot.step = -(360 - rot.step);\n\t} else if( rot.step < -180) {\n\t\trot.step = 360 + rot.step;\n\t}\n\tif(rot.step > 0 && !ret_settings.clockwise) {\n\t\trot.step -= 360;\n\t}\n\tif(rot.step < 0 && ret_settings.clockwise) {\n\t\trot.step += 360;\n\t}\n\trot.step /= steps;\n\t// Translation\n\ttrans.total = new Vector2d(\n\t\ttrans.target.x - trans.center.x,\n\t\ttrans.target.y - trans.center.y\n\t);\n\ttrans.step = new Vector2d(\n\t\ttrans.total.x / steps,\n\t\ttrans.total.y / steps\n\t);\n\n\t// Get the points on an open path\n\tif(ret_settings.pathID != '') {\n\t\t// Get the path as js object\n\t\tconst jsPath = document.getLayerWithID(ret_settings.pathID);\n\t\tconst nativePath = jsPath.sketchObject;\n\t\t// Path object\n\t\tconst pathInFrame = nativePath.pathInFrameWithTransforms();\n\t\t// Step length on path\n\t\tconst pathStep = pathInFrame.length() / (steps);\n\t\t\n\t\t// First point at start of line\n\t\tpoint = pathInFrame.pointOnPathAtLength( 0 );\n\t\ttrans.center = new Vector2d(\n\t\t\tpoint.x,\n\t\t\tpoint.y\n\t\t);\n\t\tif(transition) {\n\t\t\ttrans.array.push(new Vector2d(\n\t\t\t\tpoint.x,\n\t\t\t\tpoint.y,\n\t\t\t));\n\t\t}\n\n\t\tvar total = 0;\n\t\tfor(var j=0; j<=steps; j++) {\n\n\t\t\tif(transition) {\n\t\t\t\ttotal += transition[j] * pathInFrame.length();\n\t\t\t\tvar point = pathInFrame.pointOnPathAtLength( total );\n\t\t\t} else {\n\t\t\t\tvar point = pathInFrame.pointOnPathAtLength( pathStep * j );\n\n\t\t\t}\n\t\t\ttrans.array.push(new Vector2d(\n\t\t\t\tpoint.x,\n\t\t\t\tpoint.y,\n\t\t\t));\n\t\t};\n\t}\n\n\t// Radius\n\trad.total = new Vector2d(\n\t\trad.target.x - rad.length.x,\n\t\trad.target.y - rad.length.y\n\t);\n\trad.step = new Vector2d(\n\t\trad.total.x / steps,\n\t\trad.total.y / steps\n\t);\n\trad.max = new Vector2d(\n\t\trad.length.x,\n\t\trad.length.y\n\t);\n\n\t// Setup path\n\tvar path = NSBezierPath.bezierPath();\n\n\t// Fill path\n\tfor(var s = 0; s <= steps; s++) {\n\n\t\t// Get current radius and scale factor\n\t\tvar maxRadius = rad.length.x > rad.length.y ? rad.length.x : rad.length.y;\n\t\tvar scale = new Vector2d(\n\t\t\trad.length.x / maxRadius,\n\t\t\trad.length.y / maxRadius\n\t\t);\n\n\t\t// Get degree and vector\n\t\tvar deg = s * angle;\n\t\tvar vec = new Vector2d(\n\t\t\tMath.sin( Math.rad * deg ) * rad.length.x, \n\t\t\tMath.cos( Math.rad * deg ) * -rad.length.y\n\t\t);\n\n\t\t// Translate and rotate\n\t\tvec.add(trans.center);\n\t\tvec.rotate(trans.center, -rot.angle);\n\n\t\t// Tangents\n\t\tif(ret_settings.smooth) {\n\t\t\t// Tangent factor to current point\n\t\t\tconst rotationDelta = rot.step + angle;\n\t\t\tvar tangent = Math.tan( Math.PI / ( 2 * (360 / rotationDelta))) / 3 * 4;\n\t\t\t// Tangent length\n\t\t\tvar vTangent = deg + 90;\n\t\t\tvTangent = Math.degrees( vTangent );\n\t\t\tvar newTangent = new Vector2d(\n\t\t\t\tMath.sin( Math.rad * vTangent ) * (rad.length.x) * tangent,\n\t\t\t\tMath.cos( Math.rad * vTangent ) * (-rad.length.y) * tangent\n\t\t\t);\n\t\t\t// Get step factor from tangent\n\t\t\tconst a = rad.length.x;\n\t\t\tconst b = rad.length.y;\n\t\t\tconst h = ( ((a - b) * (a - b)) / ((a + b) * (a + b)) ) * 3;\n\t\t\tlet circumference = Math.PI * (a + b) * ( 1 + ( h / ( 10 + Math.sqrt( 4 - h ) )) );\n\t\t\tif(isNaN(circumference)) circumference = 0;\n\t\t\tconst tLength = Math.sqrt( (newTangent.x * newTangent.x) + (newTangent.y * newTangent.y) );\n\t\t\tconst degInLoops = ret_settings.loops * ret_settings.clockwise ? 360 : -360;\n\t\t\tconst rotationInDeg = steps * rot.step;\n\t\t\tconst absoluteRotation = degInLoops + rotationInDeg;\n\t\t\tconst rotationFactor = degInLoops / absoluteRotation;\n\t\t\tconst stepFactor = circumference ? tLength / (circumference / ret_settings.points) * rotationFactor : 0;\n\n\t\t\t// Calculate translation vector\n\t\t\tlet vTranslate = new Vector2d(0,0);\n\t\t\tif(trans.array.length) {\n\t\t\t\tif( s != Math.floor(steps) ) {\n\t\t\t\t\tvTranslate = new Vector2d(\n\t\t\t\t\t\t(trans.array[s+1].x - trans.array[s].x) * stepFactor,\n\t\t\t\t\t\t(trans.array[s+1].y - trans.array[s].y) * stepFactor\n\t\t\t\t\t)\n\t\t\t\t} else { // Repeat previous direction for last point\n\t\t\t\t\tvTranslate = new Vector2d(\n\t\t\t\t\t\t(trans.array[s].x - trans.array[s-1].x) * stepFactor,\n\t\t\t\t\t\t(trans.array[s].y - trans.array[s-1].y) * stepFactor\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif(transition) {\n\t\t\t\t\tvTranslate = new Vector2d(\n\t\t\t\t\t\ttransition[s] * trans.total.x * stepFactor,\n\t\t\t\t\t\ttransition[s] * trans.total.y * stepFactor\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tvTranslate = new Vector2d(\n\t\t\t\t\t\ttrans.step.x * stepFactor,\n\t\t\t\t\t\ttrans.step.y * stepFactor\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\tvTranslate.rotate(new Vector2d(), rot.angle);\n\t\t\t// Add translation vector to tangent\n\t\t\tnewTangent.add(vTranslate);\n\n\t\t\t// Calculate radius vector\n\t\t\tvar centerVector2d = new Vector2d(\n\t\t\t\tvec.x,// - trans.center.x,\n\t\t\t\tvec.y// - trans.center.y\n\t\t\t);\n\t\t\tcenterVector2d.substract(trans.center);\n\t\t\tcenterVector2d.rotate(new Vector2d(), rot.angle);\n\t\t\tconst radiusAngle = centerVector2d.angle(); // - deg;\n\t\t\t//const radiusAngle = deg;\n\t\t\tif(rad.array.length) {\n\t\t\t\tif( s != Math.floor(steps) ) {\n\t\t\t\t\tradiusTangent = new Vector2d(\n\t\t\t\t\t\t(rad.array[s].x - rad.array[s].x) * stepFactor,\n\t\t\t\t\t\t(rad.array[s].y - rad.array[s].y) * stepFactor\n\t\t\t\t\t)\n\t\t\t\t} else { // Repeat previous direction for last point\n\t\t\t\t\tradiusTangent = new Vector2d(\n\t\t\t\t\t\t(rad.array[s].x - rad.array[s-1].x) * stepFactor,\n\t\t\t\t\t\t(rad.array[s].y - rad.array[s-1].y) * stepFactor\n\t\t\t\t\t)\n\t\t\t\t}\n\n\t\t\t} else if(transition) {\n\t\t\t\tif(ret_settings.type == 4 && ret_settings.mirror) {\n\t\t\t\t\tif(s < (transition.length) / 2) {\n\t\t\t\t\t\tlet t = transition[s * 2];\n\t\t\t\t\t\tvar radiusTangent = new Vector2d(\n\t\t\t\t\t\t\tMath.sin( Math.rad * radiusAngle ) * t * rad.total.x * 2 * stepFactor, \n\t\t\t\t\t\t\tMath.cos( Math.rad * radiusAngle ) * t * -rad.total.y * 2 * stepFactor\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet t = transition[(transition.length - 1 - s) * 2];\n\t\t\t\t\t\tvar radiusTangent = new Vector2d(\n\t\t\t\t\t\t\tMath.sin( Math.rad * radiusAngle ) * -(t * rad.total.x * 2) * stepFactor, \n\t\t\t\t\t\t\tMath.cos( Math.rad * radiusAngle ) * -(t * -rad.total.y * 2) * stepFactor\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlet t = transition[s];\n\t\t\t\t\tif(!t) t = transition[s-1];\n\t\t\t\t\tvar radiusTangent = new Vector2d(\n\t\t\t\t\t\tMath.sin( Math.rad * radiusAngle ) * t * rad.total.x * stepFactor, \n\t\t\t\t\t\tMath.cos( Math.rad * radiusAngle ) * t * -rad.total.y * stepFactor\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t} else {\n\t\t\t\tif(ret_settings.mirror) {\n\t\t\t\t\tif(s < steps / 2) {\n\t\t\t\t\t\tvar radiusTangent = new Vector2d(\n\t\t\t\t\t\t\tMath.sin( Math.rad * radiusAngle ) * rad.step.x * 2 * stepFactor, \n\t\t\t\t\t\t\tMath.cos( Math.rad * radiusAngle ) * -rad.step.y * 2 * stepFactor\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar radiusTangent = new Vector2d(\n\t\t\t\t\t\t\tMath.sin( Math.rad * radiusAngle ) * rad.step.x * -2 * stepFactor, \n\t\t\t\t\t\t\tMath.cos( Math.rad * radiusAngle ) * -rad.step.y * -2 * stepFactor\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tvar radiusTangent = new Vector2d(\n\t\t\t\t\t\tMath.sin( Math.rad * radiusAngle ) * rad.step.x * stepFactor, \n\t\t\t\t\t\tMath.cos( Math.rad * radiusAngle ) * -rad.step.y * stepFactor\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t}\n\t\t\t// Add radius vector to tangent\n\t\t\tnewTangent.add(radiusTangent);\n\n\t\t\t// Scale according to smoothness\n\t\t\tnewTangent.x *= ret_settings.smooth;\n\t\t\tnewTangent.y *= ret_settings.smooth;\n\n\t\t\t// Temporary store tangent for next loop\n\t\t\tvar tempTangent = new Vector2d(\n\t\t\t\tnewTangent.x,\n\t\t\t\tnewTangent.y\n\t\t\t);\n\n\t\t\t// Translate and rotate\n\t\t\tnewTangent.add(vec);\n\t\t\tnewTangent.rotate(vec, -rot.angle + 180);\n\t\t\n\t\t} else {\n\t\t\toldTangent = vec;\n\t\t\tnewTangent = vec;\n\t\t\ttempTangent = vec;\n\t\t}\n\t\t\n\t\t// Add point to path\n\t\tif(!s) {\n\t\t\t// First point\n\t\t\tpath.moveToPoint(NSMakePoint(vec.x, vec.y));\n\n\t\t} else {\n\t\t\t// Other points\n\t\t\t//[path curveToPoint:NSMakePoint(vec.x,vec.y) controlPoint1:NSMakePoint(oldTangent.x,oldTangent.y) controlPoint2:NSMakePoint(newTangent.x,newTangent.y)];\n\t\t\tpath.curveToPoint_controlPoint1_controlPoint2(NSMakePoint( vec.x, vec.y ), NSMakePoint( oldTangent.x, oldTangent.y ), NSMakePoint( newTangent.x, newTangent.y ));\t\t\n\t\t}\n\n\t\t// store tangent for next loop\n\t\tvar oldTangent = new Vector2d(\n\t\t\ttempTangent.x,\n\t\t\ttempTangent.y\n\t\t);\n\n\t\tif((trans.array.length && !s)) { // Forget about first tangent when array is used\n\t\t\t//oldTangent = new Vector2d();\n\t\t}\n\n\t\toldTangent.add(vec);\n\t\toldTangent.rotate(vec, -rot.angle); // vec + rotation\n\n\t\t// Add steps\n\t\trot.angle += rot.step;\n\t\tif(trans.array.length) {\n\t\t\tif( s != Math.floor(steps) ) {\n\t\t\t\ttrans.center = new Vector2d(\n\t\t\t\t\ttrans.array[s+1].x,\n\t\t\t\t\ttrans.array[s+1].y\n\t\t\t\t)\n\t\t\t}\n\t\t} else {\n\t\t\tif(transition) {\n\t\t\t\tif(ret_settings.type == 4 && ret_settings.mirror) {\n\t\t\t\t\ttrans.center.x += transition[s] * trans.total.x;\n\t\t\t\t\ttrans.center.y += transition[s] * trans.total.y;\n\t\t\t\t} else {\n\t\t\t\t\ttrans.center.x += transition[s] * trans.total.x;\n\t\t\t\t\ttrans.center.y += transition[s] * trans.total.y;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\ttrans.center.add(trans.step);\n\t\t\t}\n\t\t}\n\t\tif(rad.array.length) {\n\t\t\tif( s != Math.floor(steps) ) {\n\t\t\t\trad.length = new Vector2d(\n\t\t\t\t\trad.array[s+1].x,\n\t\t\t\t\trad.array[s+1].y\n\t\t\t\t)\n\t\t\t}\n\t\t} else {\n\t\t\tif(transition) {\n\t\t\t\tif(ret_settings.type == 4 && ret_settings.mirror) {// && ret_settings.timing == 'ease') {\n\t\t\t\t\tif(s < (transition.length) / 2) {\n\t\t\t\t\t\tlet t = transition[s * 2];\n\t\t\t\t\t\trad.length.x += t * rad.total.x * 2;\n\t\t\t\t\t\trad.length.y += t * rad.total.y * 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlet t = transition[(transition.length - 1 - s) * 2];\n\t\t\t\t\t\trad.length.x -= t * rad.total.x * 2;\n\t\t\t\t\t\trad.length.y -= t * rad.total.y * 2;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tlet t = transition[s];\n\t\t\t\t\trad.length.x += t * rad.total.x;\n\t\t\t\t\trad.length.y += t * rad.total.y;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif(ret_settings.mirror) {\n\t\t\t\t\tif(s < steps / 2) {\n\t\t\t\t\t\trad.length.x += rad.step.x * 2;\n\t\t\t\t\t\trad.length.y += rad.step.y * 2;\n\t\t\t\t\t} else {\n\t\t\t\t\t\trad.length.x -= rad.step.x * 2;\n\t\t\t\t\t\trad.length.y -= rad.step.y * 2;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\trad.length.x += rad.step.x;\n\t\t\t\t\trad.length.y += rad.step.y;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(rad.length.x == 0 || rad.length.y == 0) {\n\t\t\trad.length.x = 0.0001;\n\t\t\trad.length.y = 0.0001;\n\t\t}\n\n\t}\n\n\t// Finalise path\n\tvar shape = MSShapePathLayer.layerWithPath(MSPath.pathWithBezierPath(path));\n\tvar border = shape.style().addStylePartOfType(1);\n\t//border.color = MSColor.colorWithRGBADictionary({r: 0.1, g: 0.1, b: 1, a: 1});\n\tborder.thickness = 1;\n\tshape.style().borderOptions().setLineCapStyle(1);\n\t// Set layer as type spiral\n\tSettings.setLayerSettingForKey(shape, uniqueSettingIdentifier, 'spiral');\n\n\t// SEEK layer by id to remove it\n\tvar activeSpiral = Settings.settingForKey(uniqueSettingIdentifier)\n\tif(activeSpiral) {\n\t\tlet spiralLayer = document.getLayerWithID(activeSpiral);\n\t\tspiralLayer.remove();\n\t}\n\n\t// Save new shape id\n\tSettings.setSettingForKey(uniqueSettingIdentifier, shape.objectID());\n\n\tif(ret_settings.parentID != '') {\n\t\t// Get the parent as js object\n\t\tlet parent = document.getLayerWithID(ret_settings.parentID);\n\t\t// Make it native\n\t\tparent = parent.sketchObject;\n\t\tparent.addLayers([shape]);\n\t} else {\n\t\t// Make doc native\n\t\tdocument = document.sketchObject;\n\t\tdocument.currentPage().addLayers([shape]);\n\t}\n}\n\n//////////////////////////////////////////////\n// \n// Clear selected objects on blur\n// \n//////////////////////////////////////////////\n\nfunction clearSelection(data) {\n\n\t// Get selected document and layers from Sketch API\n\tlet document = sketch.getSelectedDocument();\n\n\t// Passed data from webview\n\tvar ret_settings = data.settings;\n\n\t// Clear objects if clear is set\n\tif(ret_settings.pathID != '') {\n\t\tlet pathId = document.getLayerWithID(ret_settings.pathID);\n\t\tpathId.remove();\n\t}\n\tif(ret_settings.startID != '') {\n\t\tlet startID = document.getLayerWithID(ret_settings.startID);\n\t\tstartID.remove();\n\t}\n\tif(ret_settings.endID != '') {\n\t\tlet endID = document.getLayerWithID(ret_settings.endID);\n\t\tendID.remove();\n\t}\n}\n","module.exports = require(\"events\");","module.exports = require(\"sketch\");","module.exports = require(\"sketch/settings\");","module.exports = require(\"sketch/ui\");"],"sourceRoot":""}